<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>NG's Blog</title>
  <meta name="author" content="NG">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="NG's Blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="NG's Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">NG's Blog</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-08T02:02:18.000Z"><a href="/2013/10/08/2013-05-14-1/">10月 8 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/08/2013-05-14-1/">让中国人愤怒的第二代身份证</a></h1>
  

    </header>
    <div class="entry">
      
        <p>随着国家第二代身份证的办理，国内掀起了反对的热潮。不明深意者会问一个小小的身份证为何能引起如此大的争执？<br>一、身份证的收费问题。 </p>
<p>一般的IC卡证件是两元一个，而有关部门首发的身份证成本价却高达20元。身份证是一个巨大的市场，按新的办证条件只要愿意，即使是初生婴儿也可以办。如果全国13亿人口都办一个身份证，首发身份证收入就是260亿元！而实际上，当居民到所在地派出所办理时当地还要收取10元的彩照费！~政府采用这种剥夺人权的剥削方式，跟旧时暴君治国有何不同？？？所以现在很流行一句话：要做中国公民，你得先交30元！~！~！~令人气愤的是身份证还远远不止是30元就能永久的享有。两年前国家就曾要求更换一批新的身份证，当时许多人都去办理了，写的是有效期10年！~现在派出所说作废了！~南不成你明年又印第3代 第4代身份证？？/老百姓一家就得交几百快钱给你们？？？而世界上所有国家的首发身份证都是免费的，在贫富差距日渐加重的今天，政府此举令占中国绝大多数的农民家庭表示不满，许多人表示将不会办理第二代身份证。 </p>
<p>二、身份证印制市场被富士乐施公司独家垄断，民族自豪感何在？ </p>
<p>公安部门表示：对第二代身份证要求很高！~经过左挑右选，终于决定让日本富士乐施公司独家提供印制设备与技术。然而富有戏剧性的是在第二代身份证04年4月26日在北京首发后的一个月，当局破获一起第二代身份证造假团伙，其造假水平竟然丝毫不逊于真身份证！~！~试问一个街头小广告的办证团伙都能办到的，我泱泱中华竟然没有一家印制证卡的企业能作出来吗？？鬼才信！~！~我现在终于知道小日本为什么总看不起我们中国人，如果以前是看不起，那现在就是鄙视了。为什么？？你们中国人的身份证都是我作出来的！据中新网调查显示，中国目前有300多万爱国青年在抵制第二代身份证，我很荣幸的也在这个行列大军中！ </p>
<p>三、政府牛了，老百姓应该辛苦？ </p>
<p>记得前些年办理身份证都是国家派相关部门 到各村委会联合各村干部，让群众在村里照相 然后统一送至派出所办理，现在不用了~！~所有人只要你想办理身份证就得去派出所，政府不给你操这个心，麻烦你劳自己的腿！·~更不知是哪门子规定，照相时还必须穿黑色衣服，许多群众在派出所被告知此项后不得不回家更换衣服！~政府你凭啥剥夺人民穿什么衣服的权利？？？<br>四、办身份证因生僻字被迫改名 是否侵犯公民姓名权？<br>有人口专家保守估算，全国至少超过100万的公民因生僻字被拒在“二代证”之外。一篇“中国人起名该以人为本还是以电脑为本？”的文章在各网站上成为热帖，文章从各个角度对“改名”这一解决之道进行反驳。一时间，对“二代证要人改名”的反思风生水起———<br>电脑是为人服务的，姓名这么神圣的东西怎可以受制于电脑？<br>中华民族取名之事绵延不绝，规范小字库只会让重名更严重！<br>许多汉语言文化正是在一些名字里传承，限制使用生僻字是对历史文化的一种不尊重。<br>改名后，户口簿、工资卡、保险卡、银行存折、房产证、驾驶证、人事档案、学生证、毕业证、学位证、各类技术资格证、水电煤气收费证……要改名吗？谁来解决“后遗症”？<br>更为重要的是，不少法律界人士非常不认同因为“二代证”的办理“逼迫”公民更名的行为。 </p>
<p>数名资深律师接受记者采访时一致指出，我国的《民法通则》非常明确，公民有权决定、使用和依照规定改变自己的名字，禁止他人干涉、盗用、假冒。我国现在并无法律对姓名权作出具体的限制，只要没有使用反动、色情等不符合法律规定的字眼，即使使用了生僻字，名字也应该得到尊重，得到保护。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-08T02:02:18.000Z"><a href="/2013/10/08/2013-07-01-13/">10月 8 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/08/2013-07-01-13/">ISO8583报文</a></h1>
  

    </header>
    <div class="entry">
      
        <p>我刚进入金融行业时，就知道了IS08583报文协议，我想可能我还没进入这个行业都已经听过了，可知ISO8583的影响力有多大了。最初刚接触它时，确实对其中的一些细节概念不是很清晰，对有些地方比较迷惑。鉴于此，我想很多同行也必然会经历同样得阶段，所以我写下本文，以便大家能够少走一些弯路。同时，我在网上写下我要写“全面掌握ISO8583报文”和“符合CEN/XFS（即WOSA/XFS）规范的SP编写”两篇文章时，很多人都询问我什么时候能够写出来，可知许多人是需要了解这方面的知识的，即使我时间不是很多，也得尽量将这两篇文章写出来，给需要的人提供一些参考。<br>    如果单纯的讲IS08583那些字段的定义，我觉得没有什么意思，标准中已经对每个字段解释的非常详细了，如果你觉得理解英文版的ISO8583规范有些困难，网上也有同行为我们翻译好的中文版ISO8583规范，所以我的目的是达到阅读本文后能够对ISO8583知其然，亦知其所以然，使以前基本没有接触它的人也能够达到掌握ISO8583报文规范。<br>    好了，我们该转入正题了。<br>    最开始时，金融系统只有IBM这些大的公司来提供设备，象各种主机与终端等。在各个计算机设备之间，需要交换数据。我们知道数据是通过网络来传送的，而在网络上传送的数据都是基于0或1这样的二进制数据，如果没有对数据进行编码，则这些数据没有人能够理解，属于没有用的数据。起初的X.25、SDLC以及现在流行的TCP/IP网络协议都提供底层的通讯编码协议，它们解决了最底层的通讯问题，能够将一串字符从一个地方传送到另一个地方。但是，仅仅传送字符串是没有太大意义的，怎样来解析字符串代表什么内容是非常重要的，否则传送一些“0123abcd”的字符串也是无用的乱码。<br>    让我们随着时光回到几十年前的某个时刻，假设我们被推到历史的舞台上，由我们来设计一个通用报文协议，来解决金融系统之间的报文交换，暂且称该协议叫做ISO8583协议。此时，技术是在不断的前行，当初IBM一支独秀的局面好像已经不妙了，各种大小不一的公司都进入金融行业以求能有所斩获，呈一片百花齐放的局面。我们怎样来设计一个报文协议，能够将这些如雨后春笋般出现的所有公司都纳入进来，其实也不是一件很简单的事。<br>    我们还是先一步步的来考虑吧。金融行业其实涉及到的数据内容并不是成千上万，无法统计，恰恰相反，是比较少的。我们都可以在心底数得过来，象交易类型、帐号、帐户类型、密码、交易金额、交易手续费、日期时间、商户代码、2磁3磁数据、交易序列号等，把所有能够总结出来的都总结起来不过100个左右的数据。那我们可以首先简单的设计ISO8583，定义128个字段，将所有能够考虑到的类似上面提到的“帐号”等金融数据类型，按照一个顺序排起来，分别对应128个字段中的一个字段。每个数据类型占固定的长度，这个顺序和长度我们都事先定义好。这样就简单了，要发送一个报文时，就将128个字段按照顺序接起来，然后将接起来的整串数据包发送出去。<br>    任何金融软件收到ISO8583包后，直接按照我们定义的规范解包即可，因为整个报文的128个字段从哪一位到哪一位代表什么，大家都知道，只要知道你的数据包是ISO8583包即可，我们都已经定义好了。比如第1个字段是“交易类型”，长度为4位，第2个字段位是“帐号”，为19位等等。接收方就可以先取4位，再取接着的19位，依次类推，直到整个数据包128个字段都解完为止。<br>    其实这种做法真是简单直接，基本上就可以满足需要了。不过我们有几个问题要思考下：<br>1、 我怎么知道每个字段的数据类型呢，是数字还是字符？<br>2、 每个传送的报文都把128个字段都传过去，那网络带宽能够承受得了，有时候我可能只需要其中5个字段，结果多收到了123个无用的字段。<br>3、 如果我某些字段的长度不固定，属于变长怎么办，因为你现在解包是当作数据包每个字段都是固定的，用C语言解包时直接依靠指针取固定长度的一串字符做为一个字段。<br>    我们来一一解决这些问题。<br>    第一个问题简单，我在定义ISO8583时除了定义每个字段表示什么，还规定其内容是数字或是字符等即可。考虑可能出现的类型不过有以下几种：字母、数字、特殊字符、年月日等时间、二进制数据。比如我对128个字段中的“商户类型”字段定义其长度是15，同时定义其类型为字母。再精细点，如果“商户类型”里面的数据同时包括数字和字母呢？那我们就定义其类型为字母也可，为数字也可，即一个字段可以同时属于多个类型。<br>    第二个问题稍微复杂点。其本质就是如果我只传128个字段的5个字段，接收方怎么知道我传了哪几个字段给它了。要是我们把剩下的123全部填成0或其他特殊标识，标明该字段不需要使用？这种处理方法没有半点用处，没有解决网络带宽的本质问题，还是要传128个字段。<br>    换个思路，我在报文前面加上个包头，包头里面包含的信息能够让别人知道只传了5个字段。怎样设计这个包头，可以这样，我们用16个字节，即128个<a href="http://www.itpub.net/pubtree/?node=339" target="_blank">bi</a>t（一个字节等于8bit）来表示128个字段中的某个字段是否存在。每个bit在计算机的二进制里面不是1就是0，如果是1就表示对应的字段在本次报文中存在，如果是0就是不存在。这样好了，如果别人接收到了ISO8583报文，可以先根据最前面的报文头，就知道紧接着报文头后面的报文有哪些字段，没有哪些字段了。比如，我要发送5个字段，分别属于128个字段中的第2、3、6、8、9字段，我就可以将128bit的报文头填成011001011000000000………..，一共128个bit，后面就全是0了。注意其中第2、3、6、8、9位为1，其他都为0。<br>    有了这个128bit的报文头，我们就可以只发送需要的5个字段了。怎样组织报文？先放上这128bit，即16个字节的头，然后在头后面放2、3、6、8、9字段，这些字段紧挨在一起，3和6之间也不需要填上4、5这两个字段了。接收方收到这个报文，它会根据128bit的报文头来解包，它自然知道把第3个字段取出后，就直接在第3字段的后面取第6个字段，每个字段的长度在ISO8583里面都定义好了，很轻松就把数据包解出来了。<br>    这下好了，为了解决上面的第二问题，我们只是在报文中增加了16个字节的数据，就轻松搞定了，我们把这16个字节称为bit map，即位图，用来表示某个位是否存在。不过我们再稍微优化一下，考虑到很多时候报文不需要128个字段这么多，其一半64个字段都不一定能够用完。那我可以将报文头由128bit减到64bit，只有在需要的时候才把剩下的64bit放到报文里面，这样报文长度不又少了8个字节吗？<br>    是个好主意。我们把ISO8583的128个字段中最常见的都放到前64个字段中，那我们可以将处理缩小一倍。这样我一般发送报文时只需发送64bit，即一个字节的报文头，再加上需要的几个字段就可以了。如果有些报文用到64到128之间的字段呢？这个也好办，我把64bit报文头的第一位bit用来代表特殊含义，如果该bit为1，则表示64bit后面跟了剩下的64bit报文头；如果第一位bit为0，则表示64bit后面没有跟剩下的64bit报文头，直接是128个字段中的报文了。那们，接收方会判断一下报头的第一个bit是1还是0，从而知道报文头是64bit还是128bit了，就可以做相应处理。因为报文头第二个64bit属于有时候有，所以我们叫它Extended bit map扩展位图，相应的报文头最开始的64bit我们叫它Primary bit map主位图。我们直接把扩展位图固定放到128个字段的第一个字段，而主位图每个数据包都有，就强制性放在所有128个字段的前面，并不归入128个字段中去。<br>    第三个问题可以考虑这样解决。比如第2个字段是“帐号”，是不定长的，可能有的银行帐号是19位，有的是17位等。我们定ISO8583规范时可以规定第2个字段是25位，这下足够将19和17的情况都包含进来，但是如果以后出现了30位的怎么办？那我们现在将字段定为100位。以后超过100位怎么办，况且如果你只有19位的帐号，我们定义了100位，那81位的数据不是浪费了网络的带宽。看来预先定义一个我们认为比较大的位数是不太好的。</p>
<pre><code>我们这样，对于第<span class="number">2</span>个字段“帐号”，在字段的开头加上“帐号”的长度。比如帐号是<span class="number">0123456789</span>，一共<span class="number">10</span>位，我们变成<span class="number">100123456789</span>，注意前面多了个<span class="number">10</span>，表示后面的<span class="number">10</span>位为帐号。如果你接触过COM里面的BSTR，应该对这种处理比较熟悉了。接收方收到该字段后，它知道ISO8583规定第<span class="number">2</span>个字段“帐号”是变长的，所以会先取前面的<span class="number">2</span>位出来，获取其值，此时为长度，然后根据该长度值知道应该拷贝该字段后面哪几位数据，才是真正的帐号。如果你觉得长度如果只有两位最多只能表示<span class="number">99</span>位长，不太够，我们也定义可以允许前面<span class="number">3</span>位都为长度的变长字段，这样就有<span class="number">999</span>位长，应该够了吧。在规范里面如果我定义某个字段的属性是“LLVAR”，你注意了，其中的LL表示长度，VAR表示后面的数据，两个LL表示两位长，最大是<span class="number">99</span>，如果是三位就是“LLLVAR”，最大是<span class="number">999</span>。这样看我们定义的ISO8583规范文档时直接根据这几个字母就理解某个变长字段的意思了。
该解决的几个问题到这里都解决了，我们来回顾下自己设计的ISO8583规范。其实没有什么，无非是把金融行业可能出现的数据分门别类，排好顺序，接着把它们连接起来，组成一个报文发送出去而已。其中针对该报文的设计进行了一些优化，引入了<span class="typename">bit</span> <span class="keyword">map</span>位图的概念，也算是一个不错的想法。
剩下的工作就简单了，我们就直接收集金融行业可能出现的数据字段类型，分成<span class="number">128</span>个字段类型，如果没有到<span class="number">128</span>个这么多就先保留一些下来，另外考虑到有些人有特殊的要求，我们规定可以将<span class="number">128</span>个字段中的几个字段你自己来定义其内容，也算是一种扩展了。
这样，最后我们就得到了ISO8583规范的那张字段描述表了。想要详细的知道每个字段的含义直接对着表看就可以，比较简单。</code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-08T02:02:18.000Z"><a href="/2013/10/08/2013-06-27-12/">10月 8 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/08/2013-06-27-12/">程序员的十个层次</a></h1>
  

    </header>
    <div class="entry">
      
        <p>自西方文艺复兴以来，中国在自然科学方面落后西方很多，软件领域也不例外。当然现在中国的许多程序员们对此可能有许多不同的意见，有些人认为中国的程序员水平远落后于西方，有些则认为中国的程序员个人能力并不比西方的程序员差，只是整个软件产业落后而已。</p>
<p>那么，到底中国的程序员水平比西方程序员水平差，还是中国有许多优秀的程序员达到或超过了西方程序员同等水平呢？要解决这个问题，必须先知道程序员有多少种技术层级，每个层级需要什么样的技术水平，然后再比较中国和西方在各个技术层级的人数，就可以知道到底有没有差距，差距有多大。</p>
<p>当然，对于如何划分程序员的技术层级，不同公司或不同人会有不同的划分标准，下面的划分仅代表个人的观点，如有不当之处，还请砸板砖予以纠正。</p>
<p>第1层  菜鸟</p>
<p>第1层楼属于地板层，迈进这层楼的门槛是很低的。基本上懂计算机的基本操作，了解计算机专业的一些基础知识，掌握一门基本的编程语言如C/C++，或者Java，或者JavaScript，…，均可入门迈进这层。</p>
<p>在这层上，中国有着绝对的优势，除了从计算机专业毕业的众多人数外，还有大量的通信、自动化、数学等相关专业的人士进入这一行，此外还有众多的其他专业转行的人士，人数绝对比西方多出甚多。并且还有一个优势就是我们这层人员的平均智商比西方肯定高。</p>
<p>没有多少人愿意一辈子做菜鸟，因为做“菜鸟”的滋味实在是不咋的，整天被老大们吆喝着去装装机器，搭建一下测试环境，或者对照着别人写好的测试用例做一些黑盒测试，好一点的可以被安排去写一点测试代码。当然如果运气“好”的话，碰到了国内的一些作坊式的公司，也有机会去写一些正式的代码。</p>
<p>所以，菜鸟们总是在努力学习，希望爬更高的一层楼去。</p>
<p>第2层 大虾</p>
<p>从第1层爬到第2层相对容易一些，以C/C++程序员为例，只要熟练掌握C/C++编程语言，掌握C标准库和常用的各种数据结构算法，掌握STL的基本实现和使用方法，掌握多线程编程基础知识，掌握一种开发环境，再对各种操作系统的API都去使用一下，搞网络编程的当然对socket编程要好好掌握一下，然后再学习一些面向对象的设计知识和设计模式等，学习一些测试、软件工程和质量控制的基本知识，大部分人经过2～3年的努力，都可以爬到第2层，晋升为“大虾”。</p>
<p>中国的“大虾”数量和“菜鸟”数量估计不会少多少，所以这层上仍然远领先于西方。</p>
<p>大虾们通常还是有些自知之明，知道自己只能实现一些简单的功能，做不了大的东西，有时候还会遇到一些疑难问题给卡住，所以他们对那些大牛级的人物通常是非常崇拜的，国外的如Robert C. Martin、Linus Torvalds，国内的如求伯君、王志东等通常是他们崇拜的对象。其中的有些人希望有一天也能达到这些大牛级人物的水平，所以他们继续往楼上爬去。</p>
<p>第3层 牛人</p>
<p>由于“大虾”们经常被一些疑难问题给卡住，所以有了“大虾”们只好继续学习，他们需要将原来所学的知识进一步熟练掌握，比如以熟练掌握C++编程语言为例，除了学一些基础性的C++书籍如《C++ Primer》，《Effective C++》，《Think in C++》，《Exception C++》等之外，更重要的是需要了解C++编译器的原理和实现机制，了解操作系统中的内部机制如内存管理、进程和线程的管理机制，了解处理器的基础知识和代码优化的方法，此外还需要更深入地学习更多的数据结构与算法，掌握更深入的测试和调试知识以及质量管理和控制方法，对各种设计方法有更好的理解等。</p>
<p>学习上面说的这些知识不是一挥而就的，不看个三五十本书并掌握它是做不到的。以数据结构算法来说，至少要看个5～10本这方面的著作；以软件设计来说，光懂结构化设计、面向对象设计和一些设计模式是不够的，还要了解软件架构设计、交互设计、面向方面的设计、面向使用的设计、面向数据结构算法的设计、情感化设计等，否则是很难进到这个楼层的。</p>
<p>当然除了上面说的知识外，大虾们还需要去学习各种经验和技巧。当然这点难不倒他们，现在出版的书籍众多，网络上的技术文章更是不胜数，然后再去各种专业论坛里泡一泡，把这些书籍和文章中的各种经验、技能、技巧掌握下来，再去学习一些知名的开源项目如Apache或Linux操作系统的源代码实现等。此时对付一般的疑难问题通常都不在话下，菜鸟和大虾们会觉得你很“牛”，你也就爬到了第3层，晋升为“牛人”了。</p>
<p>看了上面所讲的要求，可能有些大虾要晕过去了，成为牛人要学这么多东西啊！要求是不是太高了？其实要求一点也不高，这么点东西都掌握不了的话，怎么能让别人觉得你“牛”呢？</p>
<p>需要提一下的是，进入多核时代后，从第2层爬到第3层增加了一道多核编程的门槛。当然要迈过这道门槛并不难，已经有很多前辈高人迈进了这道门槛，只要循着他们的足迹前进就可以了。想迈进这道门槛者不妨去学习一下TBB开源项目的源代码(链接：<a href="http://www.threadingbuildingblocks.org/)，然后上Intel的博客（http://softwareblogs-zho.intel.com/）和多核论坛（http://forum.csdn.net/Intel/IntelMulti-core/）去看看相关文章，再买上几本相关的书籍学习一下。" target="_blank">http://www.threadingbuildingblocks.org/)，然后上Intel的博客（http://softwareblogs-zho.intel.com/）和多核论坛（http://forum.csdn.net/Intel/IntelMulti-core/）去看看相关文章，再买上几本相关的书籍学习一下。</a></p>
<p>在国内， 一旦成为“牛人”，通常可以到许多知名的公司里去，运气好者可以挂上一个架构师的头衔，甚至挂上一个“首席架构师”或者“首席xx学家”的头衔也不足为奇。有不少爬到这层的人就以为到了楼顶了，可以眼睛往天上看了，开始目空一切起来，以为自己什么都可以做了，什么都懂了，经常在网络上乱砸板砖是这个群体的最好写照。由此也看出，国内的牛人数量仍然众多，远多于西方的牛人数量，在这层上仍然是领先的。</p>
<p>也有不少谦虚的“牛人”，知道自己现在还不到半桶水阶段。他们深知爬楼的游戏就像猴子上树一样，往下看是笑脸，往上看是屁股。为了多看笑脸，少看屁股，他们并没有在此停步不前，而是继续寻找到更上一层的楼梯，以便继续往上爬。</p>
<p>第4层 大牛</p>
<p>从第3层爬到第4层可不像上面说过的那几层一样容易，要成为大牛的话，你必须要能做牛人们做不了的事情，解决牛人们解决不了问题。比如牛人们通常都不懂写<a href="http://product.it168.com/list/b/0501_1.shtml" target="_blank">操作系统</a>，不会写编译器，不懂得TCP/IP协议的底层实现，如果你有能力将其中的任何一个实现得象模象样的话，那么你就从牛人升级为“大牛”了。</p>
<p>当然，由于各个专业领域的差别，这里举操作系统、编译器、TCP/IP协议只是作为例子，并不代表成为“大牛”一定需要掌握这些知识，以时下热门的多核编程来说，如果你能比牛人们更深入地掌握其中的各种思想原理，能更加自如的运用，并有能力去实现一个象开源项目TBB库一样的东西，也可以成为“大牛”，又或者你能写出一个类似Apache一样的<a href="http://server.it168.com/" target="_blank">服务器</a>，或者写出一个数据库，都可以成为“大牛”。</p>
<p>要成为“大牛”并不是一件简单的事情，需要付出比牛人们多得多的努力，一般来说，至少要看过200~400本左右的专业书籍并好好掌握它，除此之外，还得经常关注<a href="http://net.it168.com/" target="_blank">网络</a>和期刊杂志上的各种最新信息。</p>
<p>当“牛人”晋升为“大牛”，让“牛人们”发现有比他们更牛的人时，对“牛人”们的心灵的震撼是可想而知的。由于牛人们的数量庞大，并且牛人对大虾和菜鸟阶层有言传身教的影响，所以大牛们通常能获得非常高的社会知名度，几乎可以用“引无数菜鸟、大虾、牛人竞折腰”来形容，看看前面提过的Linus Torvalds等大牛，应该知道此言不虚。</p>
<p>虽然成为“大牛”的条件看起来似乎很高似的，但是这层楼并不是很难爬的一层，只要通过一定的努力，素质不是很差，还是有许多“牛人”可以爬到这一层的。由此可知，“大牛”这个楼层的人数其实并不像想像的那么少，例如比尔·盖茨之类的人好像也是属于这一层的。</p>
<p>由于“大牛”这层的人数不少，所以也很难统计除到底是中国的“大牛”数量多还是西方的大牛数量多？我估计应该是个旗鼓相当的数量，或者中国的“大牛”们会更多一些。</p>
<p>看到这里，可能会有很多人会以为我在这里说瞎话，Linus Torvalds写出了著名的Linux操作系统，我国并没有人写出过类似的东西啊，我国的“大牛”怎么能和西方的比呢? 不知大家注意到没有，Linus Torvalds只是写出了一个“象模象样”的操作系统雏形，Linux后来真正发展成闻名全球的开源操作系统期间，完全是因为许多支持开源的商业公司如IBM等，派出了许多比Linus Torvalds更高楼层的幕后英雄在里面把它开发出来的。</p>
<p>可能有些菜鸟认为Linus Torvalds是程序员中的上帝，不妨说个小故事：</p>
<p>Linus，Richard Stallman和Don Knuth（高德纳）一同参加一个会议。</p>
<p>Linus 说：“上帝说我创造了世界上最优秀的操作系统。”</p>
<p>Richard Stallman自然不甘示弱地说：“上帝说我创造了世界上最好用的编译器。”</p>
<p>Don Knuth一脸疑惑的说：“等等，等等，我什么时候说过这些话？”</p>
<p>由此可以看出，Linus Torvalds的技术水平并不像想像中那么高，只是“牛人”和“大虾”觉得“大牛”比他们更牛吧了。在我国，有一些当时还处于“大虾”层的人物，也能写出介绍如何写操作系统的书，并且书写得非常出色，而且写出了一个有那么一点点象模象样的操作系统来。我想中国的“大牛”们是不会比西方差的，之所以没有人写出类似的商业产品来，完全是社会环境的原因，并不是技术能力达不到的原因。</p>
<p>“大牛”们之所以成为大牛，主要的原因是因为把“牛人”给盖了下去，并不是他们自己觉得如何牛。也许有很多菜鸟、大虾甚至牛人觉得“大牛”这层已经到顶了，但大多数“大牛”估计应该是有自知之明的，他们知道自己现在还没有爬到半山腰，也就勉强能算个半桶水的水平，其中有些爬到这层没有累趴下，仍然能量充沛，并且又有志者，还是会继续往更上一层楼爬的。</p>
<p>看到这里，也许有些菜鸟、大虾、牛人想不明白了，还有比“大牛”们更高的楼层，那会是什么样的楼层？下面就来看看第5层楼的奥妙。</p>
<p><strong>第5层 专家</strong></p>
<p>当大牛们真正动手做一个操作系统或者类似的其他<a href="http://software.it168.com/" target="_blank">软件</a>时，他们就会发现自己的基本功仍然有很多的不足。以<a href="http://product.it168.com/list/b/0205_1.shtml" target="_blank">内存</a>管理为例，如果直接抄袭Linux或者其他开源操作系统的内存管理算法，会被人看不起的，如果自动动手实现一个内存管理算法，他会发现现在有关内存管理方法的算法数量众多，自己并没有全部学过和实践过，不知道到底该用那种内存管理算法。</p>
<p>看到这里，可能有些人已经明白第5层楼的奥妙了，那就是需要做基础研究，当然在计算机里，最重要的就是“计算”二字，程序员要做基础研究，主要的内容就是研究非数值“计算”。</p>
<p>非数值计算可是一个非常庞大的领域，不仅时下热门的“多核计算”与“云计算”属于非数值计算范畴，就是软件需求、设计、测试、调试、评估、质量控制、软件工程等本质上也属于非数值计算的范畴，甚至芯片硬件设计也同样牵涉到非数值计算。如果你还没有真正领悟“计算”二字的含义，那么你就没有机会进到这层楼来。</p>
<p>可能有人仍然没有明白为什么比尔·盖茨被划在了大牛层，没有进到这层来。虽然比尔·盖茨大学未毕业，学历不够，但是家有藏书2万余册，进入软件这个行业比绝大部分人都早，撇开他的商业才能不谈，即使只看他的技术水平，也可以算得上是学富五车，顶上几个普通的计算机软件博士之和是没有问题的，比起Linus Torvalds之类的“大牛”们应该技高一筹才对，怎么还进不了这层楼呢？</p>
<p>非常遗憾的是，从Windows操作系统的实现来看，其对计算的理解是很肤浅的，如果把Google对计算方面的理解比做大学生，比尔·盖茨只能算做一个初中生，所以比尔·盖茨永远只能做个大牛人，成不了“专家”。</p>
<p>看到这里，也许国内的大牛们要高兴起来了，原来比尔·盖茨也只和我等在同一个层次，只要再升一层就可以超越比尔·盖茨了。不过爬到这层可没有从“牛人”升为“大牛”那么简单，人家比尔·盖茨都家有2万多册书，让你看个500~1000本以上的专业书籍并掌握好它应该要求不高吧。当然，这并不是主要的条件，更重要的是，需要到专业的学术站点去学习了，到ACM，IEEE，Elsevier，SpringerLink，SIAM等地方去下载论文应该成为你的定期功课，使用Google搜索引擎中的学术搜索更是应该成为你的日常必修课。此外，你还得经常关注是否有与你研究相关的开源项目冒出来，例如当听到有TBB这样针对多核的开源项目时，你应该第一时间到Google里输入“TBB”搜索一下，将其源代码下载下来好好研究一番，这样也许你的一只脚已经快迈进了这层楼的门槛。</p>
<p>当你象我上面说的那样去做了以后，随着时间的推移，总会有某天，你发现，在很多小的领域里，你已经学不到什么新东西了，所有最新出来的研究成果你几乎都知道。此时你会发现你比在做“牛人”和“大牛”时的水平不知高出了多少，但是你一点也“牛”不起来，因为你学的知识和思想都是别人提出来的，你自己并没有多少自己的知识和思想分享给别人，所以你还得继续往楼上爬才行。</p>
<p>我不知道国内的“专家”到底有多少，不过有一点可以肯定的是，如果把那些专门蒙大家的“砖家”也算上的话，我们的砖家比西方的要多得多。</p>
<p><strong>第6层 学者</strong></p>
<p>当“专家”们想继续往上一层楼爬时，他们几乎一眼就可以看到楼梯的入口，不过令他们吃惊的是，楼梯入口处竖了一道高高的门槛，上面写着“创新”二字。不幸的是，大多数人在爬到第5层楼时已经体能消耗过度，无力翻过这道门槛。</p>
<p>有少数体能充足者，可以轻易翻越这道门槛，但是并不意味着体力消耗过度者就无法翻越，因为你只是暂时还没有掌握恢复体能的方法而已，当掌握了恢复体能的方法，将体能恢复后，你就可以轻易地翻越这道门槛了。</p>
<p>怎么才能将体能恢复呢？我们的老祖宗“孔子”早就教导过我们“温故而知新”，在英文里，研究的单词是“research”，其前缀“re”和“search”分别是什么意思不用我解释吧。或许有些人觉得“温故而知新”和“research”有些抽象，不好理解，我再给打个简单的比方，比如你在爬一座高山，爬了半天，中途体力不支，怎么恢复体力呢？自然是休息一下，重新进食一些食物，体力很快就可以得到恢复。</p>
<p>由此可知，对体能消耗过度者，休息＋重新进食通常是恢复体能的最佳选择。可惜的是，国内的老板们并不懂得这点，他们的公司里不仅连正常国家规定的休息时间都不给足，有些公司甚至有员工“过劳死”出现。所以国内能翻越“创新”这道门槛的人是“少之又少”，和西方比起来估计是数量级的差别。</p>
<p>再说说重新进食的问题，这个重新进食是有讲究的，需要进食一些基础性易消化的简单食物，不能进食山珍海味级的复杂食物，否则很难快速吸收。以查找为例，并不是去天天盯着那些复杂的查找结构和算法进行研究，你需要做的是将二分查找、哈希查找、普通二叉树查找等基础性的知识好好地复习几遍。</p>
<p>以哈希查找为例，首先你需要去将各种冲突解决方法如链式结构、二次哈希等编写一遍，再试试不同种类的哈希函数，然后还需要试试在<a href="http://product.it168.com/list/b/0218_1.shtml" target="_blank">硬盘</a>中如何实现哈希查找，并考虑数据从硬盘读到内存后，如何组织硬盘中的数据才能快速地在内存中构建出哈希表来，…，这样你可能需要将一个哈希表写上十几个不同的版本，并比较各个版本的性能、功能方面的区别和适用范围。</p>
<p>总之，对任何一种简单的东西，你需要考虑各种各样的需求，以需求来<a href="http://driver.it168.com/" target="_blank">驱动</a>研究。最后你将各种最基础性的查找结构和算法都了然于胸后，或许某天你再看其他更复杂的查找算法，或者你在散步时，脑袋里灵光一现，突然间就发现了更好的方法，也就从专家晋升为“学者”了。</p>
<p>学者所做的事情，通常都是在前人的基础上，进行一些小的优化和改进，例如别人发明了链式基数排序的方法，你第1个发现使用一定的方法，可以用数组替代链表进行基数排序，性能还能得到进一步提高。</p>
<p>由于学者需要的只是一些小的优化改进，因此中国还是有一定数量的学者。不过和国外的数量比起来，估计少了一个数量级而已。</p>
<p>也许有人会觉得现在中国许多公司申请专利的数量达到甚至超过西方发达国家了，我们的学者数量应该不会比他们少多少。因此，有必要把专利和这里说的创新的区别解释一下。</p>
<p>所谓专利者，只要是以前没有的，新的东西，都可以申请专利；甚至是以前有的东西，你把他用到了一个新的领域的产品里去，也可以申请专利。比如你在房子里造一个水泥柱子，只要以前没有人就这件事申请专利，那么你就可以申请专利，并且下次你把水泥柱子挪一个位置，又可以申请一个新的专利；或者你在一个柜子上打上几个孔，下次又把孔的位置改一改，…，均可申请专利。</p>
<p>这层楼里所说的创新，是指学术层面的创新，是基础研究方面的创新，和专利的概念是完全不同的，难度也是完全不同的。你即使申请了一万个象那种打孔一类的专利，加起来也够不到这层楼里的一个创新。</p>
<p>当你爬到第6层楼时，你也许会有一种突破极限的快感，因为你终于把那道高高的写着“创新”二字的门槛给翻过去了，实现了“0”的突破。这时，你也许有一种“独上高楼，欲望尽天涯路”的感觉，但是很快你会发现看到的都是比较近的路，远处的路根本看不清楚。如果你还有足够的体力的话，你会想爬到更高一层的楼层去。</p>
<p>第7层 大师</p>
<p>从第6层楼爬到第7层楼，并没有多少捷径可走，主要看你有没有足够的能量。你如果能象Hoare一样设计出一个快速排序的算法；或者象Eugene W. Myers一样设计出了一个用编辑图的最短路径模型来解决diff问题的算法；或者象M.J.D. Powell一样提出了一个能够处理非线性规划问题的SQP方法；或者你发现基于比较的排序算法，它的复杂度下界为O(NLogN)；或者你发现用栈可以将递归的算法变成非递归的；或者你设计出一个红黑树或者AVL树之类的查找结构；或者你设计出一个象C++或Java一样的语言；或者你发明了UML；…，你就爬到了第7层，晋升为“大师”了。</p>
<p>上面举的这些例子中，其中有些人站的楼层比这层高，这里只是为了形象说明而举例他们的某个成就。从上面列出的一些大师的贡献可以看出，成为大师必须要有较大的贡献。首先解决问题必须是比较重要的，其次你要比前辈们在某方面有一个较大的提高，或者你解决的是一个全新的以前没有解决过的问题；最重要的是，主要的思路和方法必须是你自己提供的，不再是在别人的思路基础上进行的优化和改进。</p>
<p>看了上面这些要求，如果能量不够的话，你也许会觉得有些困难，所以不是每个人都能成为“大师”的。中国<a href="http://software.it168.com/" target="_blank">软件</a>业里能称得上是“大师”的人，用屈指可数来形容，估计是绰绰有余。值得一提得是，国外的“大师”就象我们的“大牛”一样满天飞的多。</p>
<p>我把我猜测本国有可能进到这层楼的大师列一下，以起个抛砖引玉的作用。汉王的“手写识别”技术由于是完全保密的，不知道它里面用了什么思想，原创思想占的比重有多少，因此不知道该把它划到这层楼还是更高一层楼去。原山东大学王小云教授破解DES和MD5算法时，用到的方法不知道是不是完全原创的，如果是的话也可进到这层楼来。</p>
<p>陈景润虽然没有彻底解决哥德巴赫猜想，但他在解决问题时所用的方法是创新的，因此也可以进到这层楼来。当然，如果能彻底解决哥德巴赫猜想，那么可以算到更高的楼层去。</p>
<p>求伯君和王志东等大牛们，他们在做WPS和表格处理之类的软件时，不知是否有较大的原创算法在里面，如果有的话就算我错把他们划到了大牛层。由于所学有限，不知道国内还有那些人能够得上“大师”的级别，或许有少量做研究的教授、院士们，可以达到这个级别，有知道的不妨回个帖子晾一晾。</p>
<p>鉴于“大师”这个称号的光环效应，相信有不少人梦想着成为“大师”。或许你看了前面举的一些大师的例子，你会觉得要成为大师非常困难。不妨说一下，现在有一条通往“大师”之路的捷径打开了，那就是多核计算领域，有大量的处女地等待大家去挖掘。</p>
<p>以前在单核时代开发的各种算法，现在都需要改写成并行的。数据结构与算法、图像处理、数值计算、<a href="http://product.it168.com/list/b/0501_1.shtml" target="_blank">操作系统</a>、编译器、测试调试等各个领域，都存在大量的机会，可以让你进到这层楼来，甚至有可能让你进到更高一层楼去。</p>
<p><strong>第8层 科学家</strong></p>
<p>科学家向来都是一个神圣的称号，因此我把他放在了“大师”之上。要成为科学家，你的贡献必须超越大师，不妨随便举一些例子。</p>
<p>如果你象Dijkstra一样设计了ALGOL语言，提出了程序设计的三种基本结构：顺序、选择、循环，那么你可以爬到第8层楼来。顺便说一下，即使抛开这个成果，Dijkstra凭他的PV操作和信号量概念的提出，同样可以进到这层楼。</p>
<p>如果你象Don Knuth一样，是数据结构与算法这门学科的重要奠基者，你也可以进到这层楼来。当然，数据结构和算法这门学科不是某个人开创的，是许多大师和科学家集体开创的。</p>
<p>如果你象巴科斯一样发明了Fortran语言，并提出了巴科斯范式，对高级程序语言的发展起了重要作用，你也可以进到这层楼来。</p>
<p>或者你象Ken Thompson、Dennis Ritchie一样发明了Unix操作系统和功能强大、高效、灵活、表达力强的C语言，对操作系统理论和高级编程语言均作出重大贡献，那么你也可以进到这层楼来。</p>
<p>或者你有Frederick P. Brooks一样机会，可以去领导开发IBM的大型计算机System/360和OS/360操作系统，并在失败后反思总结，写出《人月神话》，对软件工程作出里程碑式的贡献，你也可以进到这层来。</p>
<p>或者你提出了面向对象设计的基本思想，或者你设计了互联网的TCP/IP协议，或者你象Steven A.Cook一样奠定NP完全性的理论基础，或者你象Frances Allen一样专注于并行计算来实现编译技术，在编译优化理论和技术取得基础性的成就，…，均可进入这层。</p>
<p>当然，如果你发明了C++语言或者Java语言，你进不到这层来，因为你用到的主要思想都是这层楼中的科学家提出的，你自己并没有没有多少原创思想在里面。</p>
<p>看了上面列出的科学家的成就，你会发现，要成为“科学家”，通常要开创一门分支学科，或者是这个分支学科的奠基者，或者在某个分支学科里作出里程碑式的重大贡献。如果做不到这些的话，那么你能象Andrew C. Yao（姚期智）一样在对计算理论的多个方向如伪随机数生成，密码学与<a href="http://tele.it168.com/" target="_blank">通信</a>复杂度等各个方向上作出重要贡献，成为集大成者，也可以进入这层楼。</p>
<p>成为“科学家”后，如果你有幸象Dijkstra一样，出现在一个非常重视科学的国度。当你去世时，你家乡满城的人都会自动地去为你送葬。不过如果不幸生错地方的话，能不挨“板砖”估计就算万幸了。</p>
<p>从上面随便举的一些例子中，你可能能猜到，西方科学家的数量是非常多的，于是你会想中国应该也有少量的科学家吧？我可以很负责任地告诉你一个不幸的结果，中国本土产生的科学家的数量为0。目前在国内，软件领域的唯一的科学家就是上面提过的姚期智，还是国外请回来的，并不是本土产生的。</p>
<p>可能你不同意我说的本土科学家数量为0的结论，因为你经常看到有许多公司里都有所谓“首席XX科学家”的头衔。我想说的是，这些所谓的“首席XX科学家”都是远远够不到这层楼的级别的，有些人的水平估计也就是一个“牛人”或“大牛”的级别，好一点的最多也就一个“学者”的级别。尤其是那些被称作“首席经X学家”的，基本上可以把称号改为“首席坑大家”。</p>
<p>虽然我国没有人能爬到这层楼上来，但是西方国家仍然有许多人爬到了比这层更高的楼上。如果要问我们比西方落后多少？那么可以简单地回答为：“落后了三层楼”。下面就来看看我们做梦都没有到过的更高一层楼的秘密。</p>
<p><strong>第9层 大科学家</strong></p>
<p>进入这层楼的门槛通常需要一些运气，比如某天有个苹果砸到你头上时，你碰巧发现了万有引力，那么你可以进到这层楼来。当然，万有引力几百年前就被人发现了，如果你现在到处嚷嚷着说你发现了万有引力，恐怕马上会有人打110，然后警察会把你送到不正常人类的聚集地去。因此，这里举万有引力的例子，只是说你要有类似的成就才能进到这层楼来。</p>
<p>牛顿发现万有引力定律开创了经典物理运动力学这门学科，如果你也能开创一门大的学科，那么你就从科学家晋升为“大科学家”。比如爱因斯坦创建了相对论，从一个小职员变成了大科学家。当然大科学家可远不止这两人，数学界里比物理学界更是多得多，如欧几里得创建了平面几何，笛卡尔开创解析几何，还有欧拉、高斯、莱布尼茨等数不清的人物，跟计算相关的大科学家则有图灵等人。</p>
<p>从上面列出的一些大科学家可以发现，他们的成就不仅是开创了一个大的学科，更重要的是他们的成就上升到了“公理”的层面。发现公理通常是需要一点运气的，如果你的运气不够好的话，另外还有一个笨办法也可以进到这层楼来，那就是成为集大成者。例如冯·诺伊曼，对数学的所有分支都非常了解，许多领域都有较大的贡献，即使撇开他对计算机的开创贡献，成为大科学家照样绰绰有余。</p>
<p>当然，程序员们最关心的是自己有没有机会变成大科学家。既然计算机这门大学科的开创性成果早就被冯·诺伊曼、图灵等人摘走了，那么程序员们是不是没有机会变成大科学家了呢？我们的古人说得好：“江山代有才人出，各领风骚数百年”，现在在计算机这门学科下面诞生了许多非常重要的大的分支，所以你还是有足够的机会进到这层楼的。</p>
<p>如果你能够彻底解决自然语言理解（机器翻译）这门学科中的核心问题， 或者你在人工智能或者机器视觉（图像识别）方面有突破性的发现，那么你同样可以轻易地晋升为“大科学家”。这样当某天你老了去世时，或许那天国人已经觉醒，你也能享受到如Dijkstra一样的待遇，有满城甚至全国的人去为你送葬。</p>
<p>现在还剩下另外一个大家感兴趣的问题没有讨论，那就是这层中已经出现了牛顿、爱因斯坦、高斯等我们平常人都认为是顶级的科学家，是不是这层已经是楼顶了呢？相信还记得本文标题的人应该知道现在仅仅是第9层，还有第10层没有到达呢。可能不少人现在要感到困惑了，难道还有人站在比牛顿、爱因斯坦、高斯等人更高的楼层上？</p>
<p>这个世界上确实存在可以用一只手的手指数得清的那么几个人，他们爬到了第10层楼上。因此，第10层楼不是虚构的，而是确实存在的。如果对此有疑惑或者认为我在胡诌一番的话，那么不妨继续往下看下去，窥一下第10层楼的秘密。</p>
<p>第10层 大哲</p>
<p>看了这层楼的名字“大哲”，可能不少人已经猜到了这层楼的秘密，那就是你的成果必须要上升到哲学的高度，你才有机会能进到这层来。</p>
<p>当然，上升到哲学高度只是一个必要条件，牛顿的万有引力似乎也上升到了哲学的高度，因为不知道引力到底是怎么来的，但是牛顿没有被划到这一层，因为进到这层还有另外的条件，那就是你的成果必须引起了哲学上的深度思考，并能让人们的世界观向前跨进一大步。窃以为牛顿、爱因斯坦等人的成就还达不到让人们世界观向前跨进一大步的程度。</p>
<p>所以，这层楼中的人的成就对我们普通人认识世界非常重要，你可以不学相对论，但是你不可以不对这层楼的人所作出的成就不了解，否则你的世界观就是极其不完整的，会犯许多认识上的错误。不幸的是，中国的科普知识普及还不够到位，知道这层楼成就的人好像并不多，程序员中恐怕更少。下面就来看看这些用一只手的手指数得清的大哲们，到底有什么成就，能比万有引力定律和相对论还重要。</p>
<p>1、希尔伯特 (1862～1943)</p>
<p>第1位进到此楼层是一位名叫“希尔伯特”的大数学家，如果你学过《泛函分析》，那么你在学习希尔伯特空间时可能已经对这位大数学家有所了解；如果你不是学数学出身的，又对数学史不感兴趣的话，恐怕你从来没有听说过这个名字。不过如果我问一下，知不知道二次世界大战前世界数学中心在那里，你肯定会有兴趣想知道。</p>
<p>不妨说一下，二战前整个世界的数学中心就在德国的哥廷根，而我们这位大数学家希尔伯特便是它的统帅和灵魂人物。即使在二战期间，希特勒和丘吉尔也有协定，德国不轰炸牛津和剑桥，作为回报，英国不轰炸海德堡和哥廷根。</p>
<p>整个二十世纪上半期的超一流数学家，几乎都出自其门下。这里不妨举几个我们熟悉的人物，例如冯·诺伊曼就曾受到他和他的学生施密特和外尔的思想影响，还到哥廷根大学任过希尔伯特的助手，钱学森的老师冯·卡门是在哥廷根取得博士学位的。顺便提一下，这位大数学家发现当时物理学上出了很多大的成果如相对论和量子力学，但是这些物理学家的数学功力明显不足，因此有一段时间带领他的学生们研究过物理学，并独立发现了广义相对论，只是不好意思和物理学家争功劳，将广义相对论的功劳全部让给了爱因斯坦。</p>
<p>广义相对论相对于这位大数学家在数学上的贡献，其实是算不了什么的，只是由此可看出这位大数学家品格的高尚之处。如果再去看看牛顿之流的人物的品行，整天和莱布尼茨、虎克等人争功劳，利用自己的优势地位打压他人，甚至闹得上法庭，和这位希尔伯特先生比起来，简直就是个小丑。</p>
<p>说到这里，你可能对这位大数学家“希尔伯特”有了一些初步映象，感觉到了他的重要性，不过他在数学上的主要成就可不是几句话说得清楚的。首先，他是一位集大成者，精通当时数学所有分支领域，在数学的各个领域都有较大的贡献，当然这些成就只能让他成为一个大科学家，不能带他进入这层楼。事实上这位“希尔伯特”解决的任何一个数学问题都够不到这层楼的高度，那么他怎么混到这层楼来了呢？</p>
<p>话得从1900年说起，当时还很年轻的希尔伯特在当时的世界数学大会上做了一个报告，高屋建瓯地提出了著名的23个未解决的数学问题，然后整个二十世纪上半期，全世界的数学家们都在这23个问题的指导下展开研究，直到现在仍然有许多数学家受这23个问题的指导在进行研究。例如我们熟知的哥德巴赫猜想，就属于其中第8个问题素数分布的一个子问题。</p>
<p>如果用“高瞻远瞩”来形容这位大数学家的话，那么这个世界上恐怕没有第二个人再配得上“高瞻远瞩”这四个字，不论是欧拉、高斯、牛顿、爱因斯坦还是被誉为最有才华的数学家伽罗华，概不例外。</p>
<p>虽然那23个问题是归纳总结出来的，并不全是原创，但是其中有不少问题是可以上升到哲学的高度，引起深度思考的。可能大多数人都会觉得希尔伯特是进不到这层楼的，我们知道提出问题的人和解决问题的人是一样伟大的，何况他提出的问题是如此之多，基于这点，个人觉得应该让希尔伯特跨进这层楼的门槛里。</p>
<p>看完这位希尔伯特的成就，你可能会觉得对你的世界观并没有产生任何影响。确实如此，他提出的问题不是用来影响你的，而是用来影响其他大科学家和大哲的，下面再来说说另一位对他提出的23个问题中的第2个问题有杰出贡献的大哲，你就会感觉到大哲们的成果的威力了。</p>
<p>2、哥德尔 (1906~1978)</p>
<p>这位大哲的名字叫“哥德尔 (G?del) ”，你可能从来也没有听说过这个名字，即使你读了一个数学系的博士学位，如果你的研究方向不和这位大哲对口的话，你也不一定了解这位大哲的成就，更不知道他的成果对我们这个世界有何意义。</p>
<p>简单地说，这位大哲20多岁时就证明了两个定理，一个叫做“哥德尔完全性定理”，另一个更重要的叫做“哥德尔不完全性定理”。你也许会觉得奇怪，第9层楼的成就就已经上升到了公理的高度，这种证明定理的事情不是学者和大师们做的事情吗？怎么能比第9层楼的成就还高呢？下面就来简单说一下这两个定理的含义，你就会明白这属于系统级的定理，绝不是普通的定理和公理所能比拟的。</p>
<p>“哥德尔完全性定理”证明了逻辑学的几条公理是完备的，即任何一个由这些公理所产生出的问题，在这个公理系统内可以判定它是真的还是假的，这个结论表明了我们人类所拥有的逻辑思维能力是完备的。这条定理并不能将其带入这层楼来，带其进入这层楼的是另一条定理。</p>
<p>“哥德尔不完全性定理”是在1930年证明的，它证明了现有数学的几条公理（ZF公理系统）是不完备的，即由这些公理产生出的问题，无法由这几条公理判断它是真的还是假的。例如希尔伯特23个问题中的第1个问题，也就是著名的康托尔连续统假设，哥德尔在1938年证明了现有公理系统中不能证明它是“假”的，科恩（Cohen，或许也可以称得上是“半”个大哲）在1963年证明了现有公理系统不能证明它是“真”的。最有趣的是，即使你将某个不可判定的问题，作为一条新的公理加入进去，所组成的新的公理系统仍然是不完备的，即你无法构造一个有限条公理的系统，让这个公理系统是完备的。</p>
<p>也许你仍然无法理解上面这段话的含义，不妨先说一下它对我们现实世界的影响。你可能知道1936年出现的图灵机是现代计算机的理论模型，如果没有哥德尔不完全性定理的思想，图灵机什么时候能出来是很难说的，所以这位哥德尔可以算作计算机理论的奠基者的奠基者。计算机对我们这个世界产生的影响比原子弹大了多少，我想不用我说大家也都清楚。当然，对现实世界的影响只能把哥德尔同图灵等人一样划到大科学家那一层去，能进入这层乃是另有原因。</p>
<p>可能你看过《未来战士》、《黑客帝国》、《I，Robot》之类的科幻电影，于是你产生制造一个和人一样或者比人更高一级的智能机器人的想法，这就引入了一个达到哲学高度的问题，“人到底能不能制造出具有和人一样的思维能力的机器来？”。</p>
<p>我只能告诉你，“你的愿望是良好的，但现实是残酷的”。如果你仔细思考一下不完全性定理的含义，并结合现代计算机所具有的能力分析一下，你会发现这个问题的答案暂时是否定的。如果你想造出和人一样思维能力的机器，那么你需要去好好学习这位大哲及其后续研究者的成果，并在他们的基础上有新的突破才行。</p>
<p>为了说明这位大哲所研究领域的重要性，这里顺便再讨论一个我们日常争议不休的问题，那就是孔夫子的“人之初、性本善”以及西方认为“人之初、性本恶”的观点孰优孰劣的问题。可能有许多人发现西方社会现在领先我们，于是就认为“性本恶”是对的，“性本善”是错的，中国应该抛弃以前的旧思想，改用西方的思想。当然也有一些老学究们，认为中国的人文思想是领先于西方的，自然而然地认为“性本善”是对的，“性本恶”是错的。</p>
<p>如果你学过大哲用过的公理化的分析方法，你就知道一套系统的多条公理间只要不会推导出矛盾的地方，即可以自圆其说，那么它可以看作是对的。这样你可以很轻易地给这个问题下一个结论，即“性本善”和“性本恶”是对等的，不存在孰优孰劣的问题，更不存在谁对谁错的问题。只要你不同时将“性本善”和“性本恶”放入一个系统内，那么是不会有问题的，甚至你也可以认为“人之初、既无善、亦无恶”，或者认为“人之初、部分善、部分恶”，都是可以自圆其说的，所以我们的老祖宗提出的思想并没有问题，之所以落后乃是其他原因造成的。这个问题其实在高斯所处的时代就有了结论，那时有人提出了非欧几何，即平行线公理问题，有人认为过一点可以作多条平行线，还有人认为平行线在无穷远点是相交的，和欧氏几何关于过一点只能作一条平行线的公理都是矛盾的，但是他们各自的系统内推导出的结论都是正确的。</p>
<p>上面说的只是对哥德尔不完全性定理的一些粗浅解析，实际上如果深入思考一下它的含义的话，你会发现它对物理学等许多学科有重大影响，包含的道理实在是深刻，远非一般的思想所能比拟，有兴趣者不妨“google”或“百度”一下“哥德尔”。或许只有我们的老祖宗“老子”提出的哲学思想，深度可以有得一比。</p>
<p>哥德尔不完全性定理也给那些认为科学是严谨的人当头一棒，原来连数学这样的纯理论学科都是不严谨的，其他学科就更不用说了。</p>
<p>至此，已经说完数学上的大哲，下面不妨再看看物理学上的大哲，物理学上好像只出过一位叫“海森堡”的大哲（注：由于本人对物理学不甚了解，不知道“霍金”够不够得上大哲的称号）。</p>
<p>3、海森堡 (1901~1976)</p>
<p>海森堡这个名字相信没有几个人不知道的，大部分人在学习物理时都学过他的“测不准关系”，也就是因为这个“测不准关系”，海森堡爬到了第十层楼。</p>
<p>如果你看过《时间简史》和《霍金讲演录－黑洞、婴儿宇宙及其他》，你也许已经了解测不准关系的威力，所以这里不想做过多的讨论，只谈一些和本土产生的哲学思想相关的东西。</p>
<p>首先看看争论了几千年，并且现在仍然有人在争论不休的“宿命论”问题。霍金认为，只要这个宇宙有一个初始状态，粒子的运动是按照一定物理定律进行的（比如相对论、量子力学属于这些物理定律的一部分），那么所有的粒子运动轨迹将是确定的，然后只要你承认唯物论，即精神是由物质决定的，那么宿命论就是“对”的。当然由于测不准关系的存在，对人而言，又是无法准确预测的，因此也可以将其看作是“不对”的。简单的说，可以认为宿命论是“对”的是绝对的，宿命论是“不对”的是相对的。</p>
<p>可能上面这段话你现在仍然难以理解，或许你又觉得你的命运并不是上天注定的，而是可以通过自己的努力可以改变的。我要告诉你的是，你在想什么也是事先已注定的，包括你在预测本身也是事先注定的，因为大脑思考问题最终是基本粒子运动的结果，而这些粒子的运动必然要遵循物理定律进行，所以你会不会努力，想不想努力，包括你在想你该不该努力这件事本身也是事先注定的。顺便说一下，你现在正在看这篇文章，可能正在想这个宿命论问题值得怀疑，或者觉得写得不够好，准备砸个板砖上来；或者你在想这篇问题写得有点意思，准备看完后转给朋友看一看；又或者你看到这里，觉得很累了，准备休息一下；…；这些都是上天事先就注定的。从你自身的相对角度看，因为你事先不知道后来会发生什么，也可以认为不是事先注定的，可能这句话有些不好理解，不妨好好理解前面说过的公理化思想。</p>
<p>如果你没看过《霍金讲演录－黑洞、婴儿宇宙及其他》，你可能会觉得很惊讶，宿命论历来不都被认为是唯心论吗，怎么由唯物论推导出了宿命论呢？现实就是这样和你开了一个大的玩笑，不过这个玩笑也是事先注定的。如果你再仔细用公理化的方法思考一下唯物论和唯心论的矛盾性，就像前面分析性善论和性恶论一样，你会发现唯物论、唯心论不一定就是冲突的，矛盾的双方是可以统一的，只要你不要同时将唯物和唯心放进同一个系统中就行。</p>
<p>当然也有聪明者仍然会怀疑宿命论问题的正确性，因为这里有一个前提条件，即宇宙要有一个初始状态。宇宙有没有初始状态，我们并不知道啊，虽然有大爆炸学说，但那也只是假说而已，并没有得到确证，有些人就认为宇宙是一直都存在的。这样看来似乎你又有合理的理由在怀疑宿命论了，不过我仍然要告诉你，你现在在怀疑宿命论仍然是事先注定的，不相信的话就来看看下面的分析。</p>
<p>虽然宇宙的初始状态值得怀疑，但是这个宇宙至少已经存在了一段时间，这点我想是毋庸置疑的。我们可以在我们已知的宇宙存在的这段时间内，任意取一个时间点t0，那么在这个时间点t0上，所有的粒子都有一个运动状态。在时间点t0之后的时间里，由于粒子运动是按照物理定律进行的，因此粒子运动轨迹由时间点t0的状态决定。说白一点，如果取100年前的一个时间点作为t0，那么现在的所有粒子运动状态100年前就已经确定了，如果取10000年前一个时间点作为t0，那么最近10000年内所有粒子运动的轨迹在10000年前就确定了，当然，你可以取更早的时间，比如100亿年前的时间点。</p>
<p>总之，现在你会发现宇宙有没有初始状态并不会影响宿命论的正确性，所以这个世界的一切都是注定的。只不过由于粒子间相互影响过于复杂，我们无法知道这些粒子的运动轨迹而已。当然，如果将测不准关系用上的话，那么就是这个运动轨迹对人来说是无法准确预测的，所以不妨开个玩笑：“算命先生经常算得不准大概是测不准关系的缘故吧”。</p>
<p>如果你再深入思考一下测不准关系，你会发现这是一个测量系统的问题。由于宿命论的存在，这个世界本身实际上是确定的，是“准“的，之所以测不准乃是我们人类所具有的测量能力依赖于基本粒子造成的。所以我在前面说宿命论是“不对”的是相对的，它是相对于我们人类的测量能力而言的。根岑（Gentzen，曾任希尔伯特的助手）在一个更强的系统内证明了ZF系统内的问题都是可判定的，从一个侧面说明这个世界本身是确定的。（注：它和哥德尔不完全性定理并不矛盾，由于数学上的复杂性，这里就不详细解释了）</p>
<p>不妨再想想我们老祖宗提出的“是庄周梦见了蝴蝶？还是蝴蝶梦见了庄周？”，“风动？幡动？还是心动？”之类的问题，当然以前你都认为这是纯粹的唯心主义，甚至认为是封建糟粕，但是如果结合测不准关系的内涵，再结合前面所说的公理化分析方法进行分析，估计你现在不敢轻易地下结论。</p>
<p>也许到现在你仍然无法理解为什么把大哲们划在了大科学家的上一层，你可能仍然觉得万有引力、相对论等成果是最伟大的。下面就来谈谈为什么大哲比大科学家高一层。</p>
<p>如果把人类在现有能力情况下，将来所能够拥有的知识总集看成是一个集合A，人类现在已有的知识总集看成是集合B，显然，集合B只是集合A的一个子集，并且是很小的一个子集。牛顿力学、相对论这些理论只能算作集合B里的一个子集，相对于集合A，只能算作是沧海一粟。 换句话说，在人类现有能力可做的事情集合中，牛顿力学和相对论等理论给出了详细的办法让你可以做其中的一些事情，当然剩下的更多的事情是牛顿力学和相对论所无法解决的。</p>
<p>哥德尔不完全性定理和测不准关系的意义在于，它指出集合A的范围，即将人类现有能力发挥到极限的情况下，那些事情是你能做到的，那些是你不能做到的。当然，它并没有给出具体的方法让你去做你能做到的事情，它只是告诉我们我们人类现在发现的能力所能达到的极限。或许将来发现人类有其他新的未发现的能力，那么这个极限就被打破了。比如将来能发现不依赖于基本粒子的其他测量方法，并且测量过程中不会改变其他粒子的状态，那么测不准关系就被打破了。</p>
<p>看到这里，估计你已经发现了一些秘密，科学兜了一大圈，最终还是回到了哲学，也就是我们所认为的玄学上。同时你也会发现，我们老祖宗提出的所谓玄学，原来和现代科学是相通的，并非象某些人想像的那样全是糟粕。如果有人认为西方现代暂时领先我们，进而就认为西方古代就已经超越我们，我们老祖宗就已经落后西方，他们的思想都是糟粕的话，那么我认为他可能犯了崇洋媚外的毛病。我不得不化用一句周杰伦在春晚上的歌词送给他：“你不妨抓一副我们祖传的中医良方，治一治你那崇洋媚外的内伤”。顺便告诉他一下，中医用的阴阳五行理论，它的前提假设就是宿命论。</p>
<p>上面说的这几位大哲的成果，可能对你的世界观会有很大的影响，于是你可能会羡慕起这些大哲们的成果来。如果你有大志的话，你会希望有朝一日你也能变成大哲，但是你发现上面的大哲是研究数学和物理学的，而你是学计算机的程序员，那么是不是没有机会变成大哲呢？</p>
<p>如果你能将NP难题给彻底解决掉，意味着计算机内的计算的奥秘基本被揭开，或许你可以进到这层楼来；或者你能发现另外一套计算机可以理解的数学公理系统，并且这个公理系统是完备的，那么计算机取代人类进行思维的一个必要条件就满足了，计算机将具有真正意义上的“逻辑思维和推理能力”，你可以轻松地进到这层楼来。如果你发现了新的方法可以打破测不准关系，同样你也可以轻松地进到这层楼来。</p>
<p>如果你能彻底揭开人类抽象思维的奥妙，并让计算机懂得了如何创建抽象，具备抽象思维能力，那么也就具备了“设计能力”，可以取代人类进行各种设计了，你也可以轻松地进到这层楼来。顺便说一下，如果你对<a href="http://software.it168.com/" target="_blank">软件</a>设计有真正深刻理解的话，就会明白这不是在写科幻小说。对此感兴趣者，不妨好好地研究一下程序切片方面的技术，会让你对软件设计和测试等方面的理解有质的提高，或许有一天你能打开这扇大门。</p>
<p>当然，计算机要完全取代人还有其他必要条件，后面还会提及。</p>
<p>值得一提的是，虽然第10层楼是本文中所写的最高层，但是大哲们并没有觉得他们到了顶层，他们通常都还会努力寻找通往更高一层的楼梯。如果你也有成为天下第一的想法，那么你或许会想要做什么事情才能超越大哲们的成就，当然，这都得依赖于找到更高一层楼的楼梯。</p>
<p>个人认为，再往上一层楼的楼梯是通往天堂的道路，也就是说第11层楼的名字叫“天堂”，是“上帝”住的地方，而不是人住的地方。如果将来某天有人能爬到天堂的话，那么他已经不是人了，而是由人变成了“上帝”。</p>
<p>你也许会怀疑这个世界到底有没有“天堂”，“上帝”是否根本就不存在，我也很有同感。因此有必要再写上一段文字，讨论一下“上帝”的问题。如果你想了解天堂的奥妙，有没有办法让你变成“上帝”，不妨看看继续往下看看第11层楼的玄妙。注意我这里用的是“玄妙”二字，因为上帝在大部分人眼里估计都是“玄之又玄”的东西。</p>
<p>第11层 上帝</p>
<p>看了上面的小标题，你可能会觉得奇怪，这篇文章不是讲“程序员的十层楼”吗？怎么冒出了第11层来了？</p>
<p>其实这并不矛盾，程序员确实只有十层楼，因为爬到第11层时，已经变成上帝，不再是程序员了；所以超出10层楼本身并不重要，关键的问题是看你有没有能力变成上帝。</p>
<p>1、谁是上帝？</p>
<p>菜鸟们认为Linus Torvalds是程序员中的上帝，看完了前面各层楼的介绍，此时再看到这句话，相信你要忍不住在心里笑起来。当然，你会不会笑起来是事先注定的。Don Knuth也不是上帝，他离上帝还有三层楼的距离。即使是大哲们，他们离天堂也还差一层楼，因此这个世界上有史以来还没有任何一个人变成过上帝。</p>
<p>我们感兴趣的是，将来会不会有人爬到比大哲们更高的楼层上，变成了上帝。</p>
<p>要变成上帝，你得有上帝一样的能力，上帝会造人，你会吗？</p>
<p>你也许会怯生生地问：“我可以和爱人生小孩，算不算造人？”，你可能还会理直气壮地说：“现在生物学上都可以克隆人了，早就有人掌握了造人的方法”。</p>
<p>事实上克隆人需要有人的体细胞，必须要先有人才会有体细胞。上帝造人时，这个世界上并没有人，是从无生命的物质“尘土”中创造出的人。因此，用最原始的方法生人和克隆人都是从有生命信息的物质中生人，不能算作造人。</p>
<p>这样看来，你根本不会造人，不过我可以告诉你一个“玄方”，让你有机会学会如何造人。</p>
<p>如果你揭开了人类情感的奥秘，让计算机也可以拥有和人类一样的情感，那么计算机将可以理解人类的需求，具有了“情商”，将具有完整的和人一样的能力。此时，人类进化到了机器人，科幻小说将变成现实，也就是说你已经掌握了真正的造人能力，晋升为“上帝”了。</p>
<p>未来到底有没有人能变成“上帝”，人能不能进化到机器人，这是宿命论中事先注定了的。说到这里，不妨再告诉你一个打破宿命论的方法，这个方法就是你要爬到比上帝还要高的楼层。</p>
<p>“还有比上帝还高的楼层？”，你可能会第1时间内冒出这个问题，其实我也有同样的怀疑。因此在写第12层楼前，有必要弄清楚它到底存不存在，即你可不可以骑到上帝的头上的问题。</p>
<p>​2. 骑到上帝的头上？</p>
<p>为了解决是否可以骑到上帝的头上这个问题，不妨先假设存在比上帝高的楼层，也就是存在打破宿命论的方法。</p>
<p>宿命论的本质原因是因为时间是单向运行，不可逆转造成的。如果你找到一种可以使时间逆转的方法，那么你就打破了宿命论，爬到了比上帝还高的楼层。</p>
<p>看到这里，你也许会摆脱刚才陷于宿命论的困惑情绪，变得充满希望般高兴起来。不过，如果你的逻辑思维能力足够好，仔细思考一下，会发现存在一个逻辑上的悖论。</p>
<p>在你找到时间逆转的方法之前，显然这个世界仍然是需要服从宿命论的，也就是说你能不能找到打破宿命论的方法是事先注定的。假设你在某个时间点t0处找到了打破宿命论的方法，你在打破宿命论后，想利用时间逆转的方法回到某个时间点t2。下面来看看你到底能不能回到时间点t2。</p>
<p>取位于t0和t2之间的任意一个时间点t1，你在回到时间点t2之前，必须先经过时间点t1，考虑你到达t1的那一时刻，由于t1比t0要早，这个时间点上你还没有找到时间逆转的方法，所以到了时间t1点后，你无法再使用时间逆转的能力回到时间点t2去，所以你永远也回不到时间点t2，由于时间点t2是任意取的，因此，你永远也无法使时间逆转，或者说你根本就没打破过宿命论，这与你在时间点t0打破了宿命论产生了矛盾。</p>
<p>上面这段话看起来似乎有点像“人永远迈不出一步”的诡辩一样，你可能会想返回到时间点t1时，仍然可以拥有时间逆转能力啊。不过你又会发现一个新的问题，时间点t1本来是没有时间逆转能力的，现在又认为时间点t1又有时间逆转能力，那时间点t1到底是有还是没有时间逆转能力呢？或者说在时间点t0前，宿命论注定了时间点t1是没有时间逆转能力的，现在你又认为时间点t1具有时间逆转能力，那么这两个时间点t1究竟是不是同一个时间点？如果不是同一个时间点，说明你没有回到过去；如果是同一个时间点的话，岂不是自相矛盾吗？</p>
<p>为了说得更形象一些，不妨假设你坐一艘超光速飞船，准备从时间点t0回到时间点t2去，假设你回到t2后，随着时间的流逝，又达到了时间点t0，如果这时你又再次坐超光速飞船返回时间点t2，那么一个值得思考的问题就出现了，“你在时间点t2能不能看到上次返回时间点t2的飞船？”</p>
<p>如果回答不能看到飞船，那么上次返回的飞船那里去了呢？显然很难解释通。如果回答能看到飞船，那么你可以到达时间点t2后，下次时间到达t0时，你又坐飞船返回t2，这次你将可以看到上两次的两艘飞船。如果这样一直循环下去，最后你会发现你可以在时间点t2看到无穷多的飞船。用程序员的术语说，叫做“程序陷入了死循环”，最后系统必然会出现“Out of Memory”现象而崩溃。</p>
<p>当然，你也可以认为有其他的方法，不需要飞船，可以一次性从时间点t0直接跳跃到时间点t2，并不需要经过时间点t1。下面不妨来分析一下这个方法是否可行。</p>
<p>既然是直接跳跃到时间点t2，那么你必然是在一个无穷小的时间里出现在时间点t2的某个空间里，例如你要在时间点t2回到某个广场上。首先说明一下为什么是无穷小的时间里出现的，因为如果不是无穷小的时间里出现的话，那么必然可以取到一个时间点t1，会导致前面所说的时间点t1上出现悖论。</p>
<p>你在广场上出现的时，广场上的空气必然要为你让开空间，而这是在无穷小的时间里完成的，那么很容易推导出你周围的空气获得的加速度和速度都是无穷大，因而它具有的动能也是无穷大，无穷大的能量和无穷大的速度意味着什么？一只鸟都可以将飞机撞下来，如果宇宙是有限大的话，它可以让这个宇宙炸毁无穷次；即使宇宙是无限大，它也足以让宇宙炸毁一次。宇宙都毁灭了，又何来的时间？还能说你回到了时间点t2吗？</p>
<p>也许上面说的这些你仍然难以相信，不妨再说得更现实一些，假设你要回到100年前的一个时间点，这100年中，天上有多少流星湮灭了？有多少新星生成了？宇宙膨胀了多少？你有能力让湮灭的流星复原、生成的新星重新返回未生成前的状态，膨胀的宇宙收缩回去吗？如果这些东西的状态没有回复到100年前，又怎么能说明你回到的是100年前的时间点呢?</p>
<p>根据上面的推导和分析，个人认为使时间逆转的方法是不存在的，所以第12层楼是不存在的，自然没有人可以骑到“上帝”的头上。</p>
<p>宿命论将在有时间的时间里永远统治这个世界。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-08T02:02:18.000Z"><a href="/2013/10/08/2013-06-14-10/">10月 8 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/08/2013-06-14-10/">SIM卡原理</a></h1>
  

    </header>
    <div class="entry">
      
        <p>一、概述<br>移动电话机与SIM 卡共同构成移动通信终端设备。无论是GSM 系统还是CDMA 系统，数字<br>移动电话机用户在“入网”时会得到一张SIM 卡（SubscriberIdentityModule）或UIM 卡<br>（UserIdentity Module）。SIM 卡是一张符合GSM 规范的“智慧卡”，可以插入任何一部符合<br>GSM 规范的移动电话中，实现“电话号码随卡不随机的功能”，而且通话费用自动计入持卡<br>用户的账单上，与手机无关。<br>二、SIM 卡硬件特性<br>1、外部特征<br>在实际使用中有两种功能相同而形式不同的SIM 卡：<br>卡片式(俗称大卡)SIM 卡，这种形式的SIM 卡符合有关IC 卡的ISO7816 标准，类似IC 卡。<br>嵌入式(俗称小卡)SIM 卡，其大小只有25mm×15mm，是半永久性地装入到移动台设备中的<br>卡。<br>“大卡”上真正起作用的是它上面的那张“小卡”，而“小卡”上起作用的部分则是卡面上的铜制<br>接口及其内部胶封的卡内逻辑电路。目前国内流行样式是“小卡”，小卡也可以换成“大卡”（需<br>加装一卡托）。“大卡”和“小卡”分别适用于不同类型的GSM 移动电话，早期机型如摩托罗拉<br>GC87C、308C 等手机用的是“大卡”，而目前新出的机型基本上都使用“小卡”。<br>2、 SIM 卡接口<br>SIM 卡是通过卡面上铜制接口来连接卡内逻辑电路与移动终端的，SIM 卡芯片有八个触点，<br>通常与移动设备连接需要六个触点，具体接口定义如下图所示：<br>3、内部结构<br>SIM 卡是一个装有微处理器的芯片卡，它的内部有5 个模块，并且每个模块都对应一个功<br>能：微处理器CPU（8 位）、程序存储器ROM（3—8kbit）、工作存储器RAM（6—16kbit）数据<br>存储器EEPROM（128—256kbit）和串行通信单元。这5 个模块被胶封在SIM 卡铜制接口后与<br>普通IC 卡封装方式相同。这五个模块必须集成在一块集成电路中，否则其安全性会受到威胁。<br>因为，芯片间的连线可能成为非法存取和盗用SIM 卡的重要线索。<br>SIM 卡同手机连接时至少需要5 条连接线（通常编程口未定义）<br>数据I/O 口（Data）<br>复位（RST）<br>接地端（GND）<br>电源（Vcc）<br>时钟（CLK）如上图所示。<br>SIM 卡的供电分为5V（1998 年前发行）、5V 与3V 兼容、3V、1.8V 等，当然这些卡必须与相应<br>的移动电话机配合使用，即移动电话机产生的SIM 卡供电电压与该SIM 卡所需的电压相匹<br>配。卡电路中的电源VCC、地GND 是卡电路工作的必要条件。卡电源用万用表就可以检测到。<br>SIM 卡插入移动电话机后，电源端口提供电源给SIM 卡内各模块。<br>检测SIM 卡存在与否的信号只在开机瞬时产生，当开机检测不到SIM 卡存在时，将提示<br>“InsertCard（插入卡）”；如果检测SIM 卡已存在，但机卡之间的通信不能实现，会显示<br>“CheckCard（检查卡）”；当SIM 卡对开机检测信号没有响应时，移动电话也会提示“InsertCard<br>（插入卡）”；当SIM 卡在开机使用过程中掉电、由于松动接触不良或使用报废卡时，移动电<br>话会提示“Bad Card/SIM Error”。<br>对于卡电路中的SIM_I/O、SIM_CLK、SIM_RST，全部是由CPU 的控制来实现的。虽然基站与网<br>络之间的数据沟通随时随地进行着，但确定哪个时刻数据沟通往往很难。有一点可以肯定，<br>当移动电话机开机时刻与网络进行鉴权时必有数据沟通，这时尽管时间很短，但测量一定有<br>数据，所以我们在判定卡电路故障时，在这个时隙上进行监测为最佳监测时间。正常开机的<br>移动电话机，在SIM 卡座上用示波器可以测量到SIM_I/O、SIM_CLK、SIM_RST 信号，它们一<br>般是一个3V 左右的脉冲。若检测不到，说明SIM 卡座供电开关管周边电阻、电容元件脱焊、SIM<br>卡卡座脱焊，也有可能是卡座接触不良，SIM 卡表面氧化或是报废卡。<br>当手机开机时，手机需要与SIM 卡进行数据交换，用示波器可以在SIM 卡卡座上检测到一<br>些数据信号，没插卡时，这些信号不会送出。可谓“瞬间即逝”，但可以用示波器捕捉到，以此<br>判别SIM 卡电路有无故障。SIM 卡触点电性能表示触点低电平高电平Vcc-U=+5V±10%，<br>I=10mA RST -0.3≤U≤+0.6V，I=200uA 4V≤U≤Vcc，I=20uA CLK -0.3≤U≤+0.6V，I=200uA<br>-2.4V≤U≤Vcc，I=200uA GND - - Vpp - +5V±10% I/O 输入 0V≤U≤0.4V，I=1mA 0.7V≤U≤Vcc，<br>I=20uA I/O 输出 0V≤U≤0.8V，I=1mA 3.8V≤U≤Vcc，I=20uA<br>电源开关时，SIM 卡电气性能为：当开启电源期间，按以下次序激活各触点：RST 低电平<br>状态；Vcc 加电；I/O 口处于接收状态；Vpp 加电；提供稳定的时钟信号。当关闭电源时，按<br>如下次序工作：RST 低电平状态；CLK 低电平状态；Vpp 去电；I/O 口低电平状态；Vcc 去<br>电。<br>SIM 卡的存储容量有3kB、8kB、16kB、32kB、64kB 等。目前多为16KB 和32KB，STK 卡(SIM<br>application Tool Kit)是SIM 卡的一种，它能为移动电话机提供增值服务，如移动梦网业务等。<br>（将在后章节具体介绍）SIM 卡能够储存多少电话号码取决于卡内数据存储器EEPROM 的<br>容量（有2K、3K、8K 容量），若有8KB 的存储容量，可供储存以下信息：<br>*100 组电话号码及其对应的性名文字；<br>*15 组短信息（ShortMessage）；<br>*25 组以上最近拨出的号码；<br>*4 位SIM 卡密码（PIN）。<br>几种主要的SIM 卡的结构数据<br>三、SIM 卡软件特性<br>SIM 卡采用新的单片机及存储器管理结构，因此处理功能大大增强。其智能特性的逻辑结构<br>是树型结构。全部特性参数信息都是用数据字段方式表达，SIM 卡中存有三类数据信息：<br>(1)与持卡者相关的信息以及SIM 卡将来准备提供的所有业务信息，这种类型的数据存储在<br>根目录下。<br>(2)GSM 应用中特有的信息，这种类型的数据存储在GSM 目录下。<br>(3)GSM 应用所使用的信息，此信息可与其它电信应用或业务共享，位于电信目录下。<br>即在根目录下有三个应用目录，一个属于行政主管部门应用目录，两个属于技术管理的应<br>用目录，分别是GSM 应用目录和电信应用目录。所有的目录下均为数据字段，有二进制的和<br>格式化的数据字段。数据字段中的信息有的是永存性的即不能更新的，有的是暂存的，需要<br>更新的。每个数据字段都要表达出它的用途、更新程度、数据字段的特性(如识别符)、类型是二进<br>制的还是格式化的等。<br>下面按GSM 的Phasel（阶段1）和Phase2（阶段2）两种情况对SIM 卡的数据格式进行说<br>明：<br>(1) Phasel<br>\<1\> GSM 系统参数<br>在阶段l 时，所选GSM 系统参数数据项目如图所示。其中6F38 业务表中选有五项开放业务：<br>GSM 阶段1 系统参数数据所选项<br>标识符 名称 长度<br>6FAD 管理(Administrative) 3<br>6F38 业务表(Service Table) 4<br>6F07 IMSI 9<br>6F7B 禁止PLMN(Forbidden PLMN) 12<br>6F7E TMSI LAI 11<br>6F20 Kc, n 9<br>6F30 PLMN 选择(PLMN Selector) 24<br>6F74 BCCH 信息(BCCH Information) 16<br>6F78 接入控制(Access Control) 2<br>业务1(Servicel)：PIN 码取消(PINDisabling)<br>业务2(Service 2)：缩位拨号(Abbreviated Dialing Numbers)<br>业务4(Service 4)：短消息存储(Short Message Storage)<br>业务6(Service 6)：容量配置参数(Capability Configuration Parameters)<br>业务7(Service 7)：PLMN 选择(PLMN Selector)<br>业务3、业务5 和业务8 在Phase 1 中不开放，6F78 接入控制采用低级等级。<br>\<2\> 电信业务参数<br>GSM 阶段1 电信业务所选项<br>标识符 名称 长度<br>6F3A 缩位拨号(Abbreviated Dialing Numbers) 50 × 22<br>6F3D 容量配置参数(Capability Config<br>Parameters)<br>1 × 14<br>6F3C 短消息存储(Short Message Storage) 5 ×176<br>6F39 话费计数(Charging Counter) 2<br>(2) Phase 2<br>\<1\> GSM 系统参数<br>在阶段2 时，GSM 系统参数数据所选项目如图所示。其中6F38 业务表在Phasel 的基础上增<br>加的业务有：<br>GSM 阶段2 系统参数数据所选项<br>标识符 名称 长度<br>6F05 语种选择(Language Preference) 4<br>6F07 IMSI 9<br>6F20 Kc, n 9<br>6F30 PLMN 选择(PLMN Selector) 42<br>6F31 HPLMN 搜索(HPLMN Search) 1<br>6F38 业务表(Service Table) 4<br>6F45 小区广播消息标识(Cell Broad Message<br>ID)<br>8<br>6F74 BCCH 消息(BCCH Information) 16<br>6F78 接入控制(Access Control) 2<br>6F7B 禁止PLMN(Forbidden PLMN) 12<br>6F7E TMSI LAI 11<br>6FAD 管理数据(Admin Data) 3<br>6FAE Phase 识别(Phase Identify) 2<br>业务9 (Service 9)：MSISDN<br>业务10 (Service l0)：扩展1 文件(Extension l file)<br>业务12 (service l2)：短消息参数(short Message Parameters)<br>业务13 (Service l3)：最后拨号存储(Last Number Dialed)<br>业务14 (service l4)：小区广播消息识别(cell Broadcasting Message Identifier fi1e)<br>业务3、业务5、业务8 和业务11 在Phase2 中不开放，6F78 接入控制采用低级等级。<br>\<2\> 电信业务参数<br>GSM 阶段2 电信业务所选项<br>标识符 名称<br>6F3A 缩位拨号(Abbreviated Dialing)<br>6F3C 短消息存储(Short Message Storage)<br>6F3D 容量配置参数(Capability Config)<br>6D40 MSISDN<br>6F42 短消息存储参数(SMS Parameters)<br>6F43 短消息存储状态(SMS Status)<br>6F44 最后拨号存储(Last Number Dialed)<br>6F4A 扩展1 文件(Extension 1 file)<br>四、SIM 卡应用<br>1、SIM 卡编号<br>SIM 卡背面的20 位数字所代表的含义如下：<br>前6 位（898600）：中国的代号；<br>第7 位：业务接入号，对应于135、136、137、138、139 中的5、6、7、8、9；<br>第8 位：SIM 卡的功能位：暂定为0；<br>第9、10 位：各省的编码；<br>第11、12 位：年号；<br>第13 位：供应商代码；<br>第14—19 位：用户识别码；<br>第20 位：校验位。<br>2、 SIM 卡密码<br>（1）、PIN 码<br>PIN 码（PersonalIdentityNumber）：个人识别码，也叫PIN1 码，长4 位，由用户自己设定（初<br>始值为1234 或0000），属于SIM 卡的密码，用来保护SIM 卡的安全，防止SIM 卡未经授<br>权而被使用。初始状态是不激活的。启动该功能后，每次用户重新开机，GSM 系统就要和手机<br>之间进行自动鉴权，判断SIM 卡的合法性，只有在系统认可后，才为该用户提供服务。<br>用户在启动PIN 码保护功能后不慎将PIN 码忘记，在错误的输入三次PIN 码后SIM 自动上<br>锁，手机无法接入网络，提示要求输入PUK 码。此时若您不知道PUK 码，那么请不要再尝<br>试输入PIN 码了，请携带有关凭证和手机到当地运营商的营业厅去解开，也可拨打服务电<br>话获得。若您输入10 次错误的PIN 码，那么SIM 卡的自毁程序将自动启动，将SIM 烧毁，<br>使用户得不偿失。<br>（2）、PIN2 码<br>PIN2 码：PIN2 码也是SIM 卡的密码，它跟网络计费和SIM 卡内部资料的修改有关。手机上<br>的“计费”功能需要PIN2 码支持。GSM协议支持手机随时查询已通话的支出，目前国内运营商<br>在部分地区开通此项业务，用户可以得到自己的PIN2 码。<br>（3）、PUK 码<br>PUK 码（PINUnblockingKey）：PUK 码是解PIN 码的万能锁，每张SIM 卡有各自对应的PUK<br>码，长8 位，可以交由用户自己管理，也可以由网络运营商控制。目前国内运营商基本都已<br>开通查询PUK 码的业务，用户可以自己管理PUK 码。<br>（4）、PUK2 码<br>PUK2 码（PIN2 Unblocking key）：PUK 码是解PIN2 码的万能锁，每张SIM 卡有各自对应<br>的PUK2 码，长8 位，可以交由用户自己管理，也可以由网络运营商控制。目前国内部分地<br>区的运营商开通了PUK2 码的业务，用户可以自己管理PUK2 码。<br>3、SIM 卡使用<br>SIM 卡在日常使用中一是请勿将卡弯曲，卡上的金属芯片更应小心保护，保持金属芯片清<br>洁（可用酒精棉球轻擦），避免沾染尘埃及化学物品；二是为保护金属芯片，请避免经常将<br>SIM 卡从手机中抽出；请勿将SIM 卡置于超过85 度或低于-35 度的环境中；在取出或放入<br>SIM 卡前，请先关闭手机电源；三是最好不要用手去触摸那些触点，以防止静电损坏。<br>SIM 卡的使用是有一定年限的。一般来说，它的物理寿命是取决于客户的插拔次数，约在1<br>万次左右；而集成电路芯片的寿命取决于数据存储器的写入次数，不同厂家其指标有所不同，<br>就Motorola 生产的SIM 卡经试验室试验约为5 万次。SIM 卡的平均寿命约为4 年。<br>4、SIM 卡知识进阶<br>（1）、SIM 卡内保存的数据可以归纳为以下四种类型：<br>\<1\>由SIM 卡生产厂商存入的系统原始数据。<br>\<2\>由GSM 网络运营部门或者其他经营部门在将卡发放给用户时注入的网络参数和用户数<br>据。包括：<br>*鉴权和加密信息Ki（Kc 算法输入参数之一密匙号）；<br>*国际移动用户识别码（IMSI）；<br>*A3：IMSI 认证算法；<br>*A5：加密密匙生成算法；<br>*A8：密匙（Kc）生成前，用户密匙（Kc）生成算法；(这三种算法均为128 位)<br>\<3\>用户自己存入的数据。如短消息、固定拨号、缩位拨号、性能参数、话费记数等。<br>\<4\>用户在用卡过程中自动存入和更新的网络接续和用户信息类数据。包括最近一次位置登<br>记时的手机所在位置区识别号（LAI），设置的周期性位置更新间隔时间，临时移动用户号<br>（TMSI）等。<br>这些数据都存放在各自的目录项内，第一类数据放在根目录，当电源开启后首先进入根目<br>录，再根据指令进入相关的子目录，每种目录极其内部的数据域均有各自的识别码保护，只<br>有经过核对判别以后才能对数据域中的数据进行查询，读出和更新。上面第一类数据通常属<br>永久性的数据，由SIM 卡生产厂商注入以后无法更改，第二类数据只有网络运行部门的专<br>门机构才允许查阅和更新，再第三、四类数据中的大部分允许用户利用任何手机对其进行读/<br>写操作。<br>(2)、在下一章节中需要用到国际移动设备识别码IMEI 和国际移动用户识别码IMSI，这里先<br>做一简单介绍。<br>国际移动设备识别码IMEI(InternationalMobileEquipment Identification Number)是区别移动<br>台设备的标志，储存在移动设备中，可用于监控被窃或无效的移动设备。IMEI 组成如图所示，<br>移动终端通过键入*#06#可以查得。其总长为15 位，每位数字仅使用0—9 的数字。<br>TAC：型号装配码，由欧洲型号标准中心分配。<br>FAC：装配厂家号码。<br>SNR：产品序号，用于区别同一个TAC 和FAC 中的每台移动设备。<br>SP：备用。<br>国际移动用户识别码IMSI(InternationalMobileSubscriberIdentification Number)是区别移动用<br>户的标志，储存在SIM 卡中，可用于区别移动用户的有效信息。IMSI 组成如图所示，其总长<br>度不超过15 位，每位数字仅使用0—9 的数字。<br>MCC：移动用户所属国家代号，占3 位数字，中国的MCC 规定为460。<br>MNC：移动网号码，最多由两位数字组成。用于识别移动用户所归属的移动通信网。<br>MSIN：移动用户识别码，用以识别某一移动通信网中的移动用户。<br>四、安全缺陷分析<br>1、安全分析<br>（1）、SIM 卡<br>SIM 卡中最敏感的数据是保密算法A3、A8 算法、密钥Ki、PIN、PUK和Kc。A3、A8 算法是在生产<br>SIM 卡的同时写入的，一般人无法读取A3、A8 算法；HN 码可由客户在手机上自行设定；PUK<br>码由运营者持有；Kc 是在加密过程中由Ki 导出；Ki 需要根据客户的IMSI 和写卡时用的母<br>钥(Kki)，由运营部门提供的一种高级算法DES，即Ki＝DES(IMSI，Kki)，经写卡机产生并<br>写入SIM 卡中，同时要将IMSI、Ki 这一对数据送入GSM 网路单元AUC 鉴权中心。<br>如何保证Ki 在传送过程中安全保密是一件非常重要的事情。Ki 在写卡时生成，同时加密，然<br>后进入HLR／AUC 后再解密，那么连写卡和HLR／AUC 的操作人员也不知道Ki 的真实数<br>据。<br>一般流行的做法是用一高级方程DES 对Ki 进行加密，DES 方程需要一把密钥Kdes，加密<br>和解密都用同一把密钥。由运营部门提供DES 方程给HLR／AUC 设备供应商，运营部门制<br>定严格的保密制度，管理好密钥Kdes 就能保证Ki 传递的安全性，此过程如图所示。<br>SIM 卡写卡流程<br>由此可见，SIM 卡自身的加密措施是十分完备的。<br>（2）、空中接口<br>GSM 系统为了保证通信安全，尤其是空中接口不受侵犯，采取了特别的鉴权与加密措施，<br>来确保移动台的合法性以及防止第三者对通话进行窃听。所使用的加解密算法以及安全措施<br>从理论上来说是不可逆的。这里主要介绍SIM 卡，对GSM 系统对于空中接口的控制与管理就<br>不详细叙述了。<br>2、 SIM 卡整体复制<br>目前出现了许多MAGICSIM、SUPERSIM 等手机智能卡，配合专用的SIM 卡读写卡起便可实<br>现在1 张空白的卡上同时“烧”进不同地区的16 个手机卡号，可供用户使用手机STK 功能*<br>随时切换使用其中任何一个号码使用，也可将一个号码“烧”进多张手机SIM 卡。设备如图所<br>示<br>上图是这类SIM 卡内部简单电路，是使用单片机PIC16F84 和一片扩展存储器24LC16（2K）<br>构成的。<br>下面，从理论层来进行分析：<br>下图为GSM 系统设备识别程序，通过IMEI 对用户设备的合法性进行验证。<br>在EIR 中只用三种设备清单：<br>白名单：合法的移动设备号；<br>灰名单：是否允许使用由运营商决定；<br>黑名单：禁止使用的移动设备号；<br>目前，移动运营商在用户入网时并没有对移动电话机的国际移动设备识别码（IMEI 码）实<br>行验证，其次，GSM 系统为了防止非法监听进而盗用IMSI，在无线链路上需要传送IMSI<br>时，均使用临时移动用户识别码TMSI 来代替IMSI。仅在位置更新失败或MS 得不到TMSI<br>时才使用IMSI。因此，这就对SIM 卡整体复制以及SIM 卡的非法盗用提供了先决条件。同时，<br>也使得GSM 系统对移动台的鉴权形同虚设。<br>实验证明：使用两部手机，一部使用原SIM 卡，另一部使用superSIM16 复制卡，在一部机<br>拔出的时候,另一部无法工作；一部机在发短息的时候，另一部无法同时发信息；两机同时<br>待机,短信息和电话一般会到后开机的那一部手机上；如果关闭掉其中一部手机,有可能会出<br>现暂时收不到短信息(信息延时)的情况,或者网络出现机主关机的情况；如两机均设置了自动<br>选网，同号待机时等同于轮流待机（感觉为随机）。<br>*STK<br>STK（SIMTOOLKIT），简称“用户识别应用发展工具”，可以理解为一组开发增值业务的命<br>令，一种小型编程语言，它允许基于智能卡的用户身份识别模块SIM 运行自己的应用件。<br>STK 卡不是一般的通常使用的SIM 卡，而是基于Java 语言平台的Simera32K 卡片。STK 是<br>一种小型编程语言的软件，可以固化在SIM 卡中。它能够接收和发送GSM 的短消息数据，起<br>到SIM 卡与短消息之间的接口的作用，同时它还允许SIM 卡运行自己的应用软件。这些功能<br>经常被用于在可通过软件激活的电话显示屏上，用友好的文本菜单代替机械的“拨号-收听-<br>应答”方式，从而允许用户通过按键轻松进行复杂的信息检索操作或交易。<br>“移动梦网卡”就是是在普通STK 功能上联合ICP 应用服务的多功能STK 应用SIM 卡。该产<br>品将ICP 短信应用服务以菜单的形式移植到STK 卡中，增强了手机的通信能力，使手机不<br>仅仅是一个孤立的通信工具，而且成为了一种综合的信息终端，让用户可以在手机上方便地<br>使用移动互联网业务。目前，“移动梦网卡”提供的功能有传情服务、IP 电话、股票助理、新闻信息、<br>定位服务、娱乐休闲、实用工具、生活服务、全球通话费查询等，并根据需要不断在开发新的服务<br>项目。<br>3、SIM 卡模拟器<br>由于SIM 卡内部属于单片机范畴，早在1998 年，国外就出现了使用TurboPascal 编写的SIM<br>卡模拟程序以及相应的外部接口电路。它跳过了SIM 卡，将手机与计算机结合到了一起。通过<br>外部电路将手机与计算机RS-232 接口相连，在计算机上运行SIM 卡模拟程序，模拟SIM 卡<br>处理的全过程。<br>SIM 卡模拟器不同于SIM 卡整体复制，它将卡内数据读出，并以数据格式保存在计算机上。<br>运行模拟程序时，这些以数据格式保存的卡内数据就相当与一张张实实在在的SIM 卡。所不<br>同的是，对照SIM 卡内部的数据格式说明，能实现对SIM 卡内部数据的修改和SIM 卡复制<br>等功能。这样一来，就使得SIM 卡的安全性完全丧失，并对GSM 系统的安全性造成一定的威<br>胁。<br>五、总结<br>虽然SIM 卡同样存在安全隐患，但比起早期模拟通信系统来说已经有了长足的发展。SIM 卡<br>技术的引入，使得GSM 系统在安全方面得到了极大改进。并使得无线电通信从不保密的禁区<br>中解放出来。<br>参考：1、《移动通信》西安电子科技大学出版社</p>
<h2>2、部分资料来源与互联网</h2>
<p>《通信世界》</p>
<p>Related link: <a href="http://www.nowsms.com/discus/messages/12/60056.html" target="_blank"><a href="http://www.nowsms.com/discus/messages/12/60056.html">http://www.nowsms.com/discus/messages/12/60056.html</a></a></p>
<pre><code>          [http://www-phare<span class="preprocessor">.lip</span>6<span class="preprocessor">.fr</span>/\~langar/RTEL\_courses/SmartSIM<span class="preprocessor">.pdf</span>](http://www-phare<span class="preprocessor">.lip</span>6<span class="preprocessor">.fr</span>/~langar/RTEL_courses/SmartSIM<span class="preprocessor">.pdf</span>)</code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-08T02:02:18.000Z"><a href="/2013/10/08/2013-06-14-9/">10月 8 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/08/2013-06-14-9/">手机SIM卡破解原理</a></h1>
  

    </header>
    <div class="entry">
      
        <p>我们一般用的手机sim卡里面有三组数值是关键的：IMSI、ICCID和ki，有了这三组数值，你的sim卡就能被复制。市面上卖的一卡多号其实就是通过读取sim卡这三组数值，将他们写到一张特殊的卡上，从而达到复制的目的。IMSI和ICCID可以直接读取，ki却是加密的。下面简单讲讲GSM加密：</p>
<p>GSM的加密系统里面大致涉及三种算法，A3、A5、A8，这些并不特定指代什么算法，只是给出算法的输入和输出规范，以及对算法的要求，GSM对于每种算法各有一个范例实现，理论上并没有限制大家使用哪种算法。但是世界上的设备商和运营商都是懒得沟通的，看到既然有了范例已经实现，就都拿来用了，于是全世界的SIM卡的破解方法都一样。</p>
<p>说到这里就不能不简单介绍一下SIM卡，SIM卡是一种智能卡片，里面有个非常简单的CPU和一点NVRAM，可以存储和读出数据，还可以进行一些运算。卡里面有很多内容，不过只介绍和加密相关的。每张SIM卡里面一般都存着一个全球唯一的标志号，叫做IMSI，这个是用来唯一标识你SIM卡的，手机在开机时候会从卡里面读出这个号发给移动网络，移动那里有一个很大的数据库，描述了IMSI和手机号的对应关系，于是网络就知道你的手机号是多少了（如果你手机卡丢了去补，新补来的卡IMSI和原有的不同，而移动数据库那里将你原来的手机号指向新的IMSI，旧的卡就再也不能用了）除了IMSI，还有16个字节的密钥数据，这个数据是无法通过 SIM 卡的接口读出的，通常称为Ki，Ki在移动网络那边也保存了一份。</p>
<p>在手机登录移动网络的时候，移动网络会产生一个16字节的随机数据（通常称为RAND）发给手机，手机将这个数据发给SIM卡，SIM卡用自己的密钥Ki和RAND做运算以后，生成一个4字节的应答（SRES）发回给手机，并转发给移动网络，与此同时，移动网络也进行了相同算法的运算，移动网络会比较一下这两个结果是否相同，相同就表明这个卡是我发出来的，允许其登录。这个验证算法在GSM规范里面叫做A3，m=128 bit，k=128 bit，c=32 bit，很显然，这个算法要求已知m和k可以很简单的算出c，但是已知m和c却很难算出k 。A3算法是做在SIM卡里面的，因此如果运营商想更换加密算法，他只要发行自己的SIM卡，让自己的基站和SIM卡都使用相同的算法就可以了，手机完全不用换。</p>
<p>在移动网络发送RAND过来的时候，手机还会让SIM卡对RAND和Ki计算出另一个密钥以供全程通信加密使用，这个密钥的长度是64 bits， 通常叫做Kc，生成Kc的算法是A8，因为A3和A8接受的输入完全相同，所以实现者偷了个懒，用一个算法同时生成SRES和Kc。</p>
<p>在通信过程中的加密就是用Kc了，这个算法叫做A5，因为A5的加密量很巨大，而且SIM卡的速度很慢，因此所有通信过程中的加密都是在手机上面完成的，这样一来，除非天下所有GSM手机都至少支持一种相同的A5算法，否则就没法漫游了，这时候运营商和设备商的懒惰又体现出来了，全世界目前只有一种通用的A5算法，没有其他的，这个算法就是和Kc 的8字节序列进行简单的循环XOR，再和报文序号做个减法。</p>
<p>现在说说为啥手机卡可以被复制。从前面的介绍里面我们知道，要完成一次登录过程，IMSI和Ki是必不可少的，A3算法也需要知道，这其中IMSI是直接可读的，但是A3算法和存在你的卡里面的数据，都是不知道的，手机只是简单的把RAND给SIM卡，SIM卡把算好的数据返回。实际设备中使用的A3算法被作为高级商业机密保护起来。但是世界上没有不透风的墙，在1998还是1999年的时候，有人从哪里偷到了几页纸的相关文档，然后把这文档输入了电脑。后来这个文档落到了加州伯克力几个教授手里面。这个文档里面缺少一些东西，而且还有写错的地方，这几个教授们拿一个SIM卡比对了一阵子，把缺的补上了，错的也给修正了，于是这个算法就成为了世人皆知的秘密。这个算法又被叫做Comp128，他同时生成SRES和Kc。</p>
<p>光有了算法还是不能够得到在SIM卡里面保存的Ki，理论上面是可以把SIM卡拆了，然后把芯片接到特殊设备上面来读出Ki，但是这个听起来就像用小刀在硬盘上面刻操作系统一样不靠谱。于是很多有志之士就开始了对Comp128 算法的攻击，在一开始大家想到的肯定是穷举，不过这个GSM的设计者也想到了，SIM 卡里面有个逻辑是一共只能查询2\^16次左右，之后卡会自杀，让破解者啥都得不到。因此研究者们试图在可以接受的次数之内通过构造特定明文和分析输出秘文来分析出Ki的值，结果还真被大家发现出来了一些。IBM的一个小组甚至用6次查询就可以彻底解出Ki，当然现在外面卖的那种机器肯定没有这么牛。</p>
<p>随着时间的推移，针对Comp128的破解算法越来越成熟，SIM复制设备也越来越多，运营商们终于坐不住了。很多运营商都开始发行Comp128 v2加密算法的卡了。Comp128 v2算法是GSM协会在v1被攻破以后，迅速在v1上面修改得来的结果，据说比较好的解决了v1算法中的弱点，当然，这个算法像v1一样，还是不公布于众的，而且到现在也没有人公布出来。这样一来，基本就没法解了。</p>
<p>中国的运营商同样也遇到了SIM卡被复制问题，这里我主要讲讲中国移动。大约从2005年下半年发行的卡开始，已经不能直接用simscan等软件读出ki，但是，这并不是真正v2卡。有消息指出，v2卡虽然解决了能被复制的漏洞，但是兼容性和稳定性方面不尽人意。聪明的中国移动当然不会不管这个问题，它在成熟的v1卡基础上，自己做了小小的修改，巧妙的躲避了simscan等软件的扫描，达到不被复制的目的。这种卡我们暂时称作v0卡。v0卡是中国移动自己设计出来，据说是改变了原来ki的配对规律，使常规的扫描无法读出ki。本文的核心内容，就是讲述如何读出v0卡的ki。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-08T02:02:18.000Z"><a href="/2013/10/08/2013-05-29-8/">10月 8 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/08/2013-05-29-8/">清华梦的粉碎</a></h1>
  

    </header>
    <div class="entry">
      
        <p>小时候，妈妈给我一个梦。她指着一个大哥哥的照片对我说，这是爸爸的学生，他考上了清华大学，他是我们中学的骄傲。长大后，你也要进入清华大学读书，为我们家争光。我不知道清华是什么样子，但是我知道爱迪生和牛顿的故事。清华，大概就是可以把我造就成他们这种人的地方吧。我幼小的脑海里就想象出我能在清华做的事情……我的脸上浮现出笑容。我说我要实现这个“清华梦”。这就是清华梦的诞生。 </p>
<pre><code><span class="comment">小小科学家</span> 

<span class="comment">我相信每个人在小时候都跟我差不多，对这个世界充满了好奇。</span> 

<span class="comment">鲁迅有他的百草园，我也有我自己的"实验田"。如果说小时候的鲁迅是一个艺术家，那么小时候的我就是一个科学家。这么说可能有人要说我口气太大，张口闭口就是这家那家。然而在我的字典里，"艺术家"和"科学家"并不是什么了不起的人，它们只是贴在人内心的一个标签。如果一个小孩专注于内心对世界的感觉，那么他就是一个艺术家。而我不是。我的大部分兴趣是在了解世界是怎样运转，甚至不惜代价。也许大部分男孩子都是这样。</span> 

<span class="comment">我小时候住在父母执教的中学里。两间平房，门口有一小块地，妈妈在里面种了一些菜。我们一家三口虽然穷，但是过着宁静舒适的生活。我们在这个地方一直住到上初中的时候。这些房屋记录着一个年幼的科学家的探索和实验，直到它们被夷为平地。</span> 

<span class="comment">妈妈拒绝让我养猫狗，她说凡是会拉屎的都不养</span>-<span class="literal">-</span><span class="literal">-</span><span class="comment">除了我。所以我小时候就喜欢与蚂蚁作伴。我总是试图用各种各样的办法去了解蚂蚁的生活习性。我可以一整天的观察我家屋檐下的蚂蚁来来去去。看见他们用触须碰一碰，然后各自分头走开，我就会想它们到底说了什么。我在想，能不能用一种方法解开蚂蚁语言的密码。我从书中得知蚂蚁洞里有蚁后，她有很大的肚子。为了一睹芳容，我开始试图水漫金山，把水往蚂蚁洞里灌。我有时一个下午就干这种事情，却没有一次成功看到蚁后。后来才知道蚂蚁是如此精明的下水道工程师，水大部分都渗到地底下去了。可是我不甘心，我开始试用别的办法。比如在洞口放一块糖。可是蚁后架子太大，终究不肯出来，让别人帮她送饭进去。</span> 

<span class="comment">有人说，这个世界最后不是毁在疯子手上，就是毁在科学家手上。世界上如果只有科学家是很可怕的，比如他们会发明高效的杀人武器。我发现疏松的棉絮可以迅速的燃烧，就想出一种惨绝蚁寰的大屠杀实验。我先把糖水滴在地上，等蚂蚁把那个地方围个水泄不通的时候，铺上棉花，点火……现在想起那些勤劳的小黑头都变成灰烬，我仍然心惊肉跳。他们的灵魂会来找我报复吗？后来这个实验有一个升级的版本用的是浸泡过一种化学药品溶液的纸，文火燃烧，由于燃烧速度慢，杀伤力不大，这个实验可以测试蚂蚁的逃跑路线。我还用活蚂蚁进行过心理实验。首先用破袜子摩擦塑料尺产生静电，然后放在一只正在行走的蚂蚁身后不远处。蚂蚁走不动了，我就开始推测它在想什么，它感觉到什么。它可能会觉得有外星人？但是由于尺子拿开以后，它若无其事继续走，我猜它只是有点纳闷，而不惊慌。但是反反复复几次之后，它明显有罢工的意思，似乎忘了自己要去干什么。后来我又发现蚂蚁被吸到塑料尺上之后会由于带上相同的电荷而被"发射"出去，就像人间大炮一样。注："人间大炮"是日本电视剧《恐龙特急克塞号》里的一种可以把人当作炮弹发射的威力很大的电磁装置。</span> 

<span class="comment">一点微小的发现，就可以引发大量的探索和实验。这就是我在那个年代的特点。虽然妈妈也逼着我练习毛笔书法，绘画，还多次获奖，但我不喜欢这些东西。我似乎生下来就是科学家，不是搞艺术的，不过也许只是妈妈的强迫让我反感了艺术而已。物理是我最喜欢的，因为它让我了解到世界的奥秘。我一般开学前几天就会把物理书上的实验都挑出来，费尽辛苦找到材料实践一番，心里美滋滋的。上学真是快乐！</span> 

<span class="comment">失之交臂</span> 

<span class="comment">上了高中，由于课业的压力，我的生活逐渐改变了。为了考上清华大学，我努力的学习。抛下我的毛笔书法，抛下我用来做实验的蚂蚁，电池和线圈，抛下除了考试科目的一切。在老师眼里我是一个听话的好学生，在妈妈眼里我是一个听话的好孩子。每天早上按时起床，吃一大碗妈妈做的面（为了补充一上午学习需要的体力），然后冲进教室，按照预设的程序开始读书，做练习题。似乎一切都有条不紊，顺利进行。可是……</span> 

<span class="comment">忽然有一天我发现，我的一切活动都是在纸上进行的，看书，做习题。试卷和复习书让我变得变得麻木。我想这样下去我就不再像爱迪生和牛顿了。于是我开始调皮起来。我不但要做考试的题目，还要做更难的题目。做了物理奥林匹克的题目，接着就想看大学的物理书，接着就想恢复我小时候的实验的爱好。老师辅导自习时经常被我缠住问一些不着边际的问题，那其实是我在实验中发现的问题。终于有一天，在我要求他跟我合作制造一个磁悬浮陀螺的时候，他显示出了不耐烦：“王垠，你让我先回答别的同学的问题好不好？你的问题对考试没有好处。”</span> <span class="comment">我呆住了，启发我让我爱上物理的人，尽然对我说出这样的话。后来想一想，他也是无奈啊，不过我从此再也不想问他任何“超纲”的问题。</span> 

<span class="comment">高二的时候妈妈就拿回一份前一届的高考题让我做，我随手一做就得了一个当时可以考上清华的成绩。我的心里想，清华我来了。明年的这个时候，我就会拿到录取通知书了！从此我就不再把高考放在眼里。我开始钻研越来越难的题目，进行越来越离谱的实验。我想，清华里面应该都是我这样的学生吧，我会有很多志同道合的朋友，不用再跟这群只会做题的呆子在一起了。</span> 

<span class="comment">可是我的行为总是受到老师的压制，他们要把我们变成考试的机器。他们告诉我，沉下心来做习题，考试才能有把握。妈妈也帮着老师劝导我。看，一班的某某某这次模拟考试数学成绩比你高，多努力一下吧。我哪里听得进去，我才不在乎这点分数，我能解决更难的问题，老师都没法解决的问题。我开始有了逆反心理，开始早上懒床，装病请假不去上课。班主任，校长多次找我谈话，说我要沉下心来准备考试云云。但是我根本就听不进去，我鄙视高考，觉得他们没有资格出题来考我。然后我就有了心理疾病，大概是强迫症。高考语文的时候我居然怀疑监考老师认为自己在作弊，接着好像真的怕被抓住了一样，手发抖，头冒汗。然后我又想要是考不好，以前的优秀会不会也被人怀疑？他们会不会以为我以前的成绩全都是作弊得来的？手就抖得更厉害了。这时候，监考老师可能发现了我的情况，真的走了过来，站在我身后。害得我好几分钟不敢写一个字，因为手已经完全不听使唤。不过他还是走开了，这可怕的高考终于结束了。</span> 

<span class="comment">我们是考试前填的志愿，我根本不考虑其他学校就只填了清华。后来妈妈研究了一下，帮我添了一个天津大学在第二志愿。以下的志愿全部空白。大家觉得我真够大胆，可是我的心理状态让我发挥完全失常，比清华的最低分数线还差两分。特别是语文，才96分。天津大学第一志愿收满不要我。昔日的好学生，居然到了落榜的下场。我真的那么好吗？我问自己。我太骄傲，才落到如此地步吧。我开始怀疑自己是否应该那样瞧不起高考。看着爸爸的愁眉苦脸，妈妈的唠唠叨叨，真是生不如死。复读吗？那会是噩梦的继续。我不能再在这个学校待下去。再面对题海，我的心理疾病会让我自杀的。碰巧四川大学来招收高分落榜的学生，还给了我随便选择专业的机会。妈妈说，计算机现在很火热，出来好找工作。我虽然对工作不感兴趣，但是我比较喜欢写程序，于是就进了川大计算机系。</span> 

<span class="comment">两度退学失败</span> 

<span class="comment">不能不说进川大是个没有选择中的好选择。大学生活自由一些，我至少不会走上自杀的道路。可是我的毛病仍然在继续，我永远不满足学校里能学到的那么点东西。老师基本是照本宣科，我逐渐不再满足这种知识灌输式的教育。我觉得完全没必要上这个大学。</span> 

<span class="comment">川大的环境我实在无法忍受。军训的时候受够了同学和教官的委屈，我就想退学。我们的军训是在一个戒备森严的炮兵基地里，心里的苦向谁说啊！有一天我们正在路上齐步走的时候，我忽然看到一个女人挽着一个军官走了过来。那个军官的老婆怎么长的这么像我妈妈！要是妈妈来到我身边该多好！没想到回到营地，团长（原来是连长，我们来军训他就升一级做团长了）说有人来探访。我走过去，居然发现是妈妈！因为听说我想退学，她急忙向学校打听了军训的地点，几经周折跑过来，是那个军官带着她混进来的。我想我妈妈要是转行当间谍一定是个好料子。她说已经帮我办了退学，学校同意了，回去好好复习，准备考上清华……</span> <span class="comment">“好好复习，好好复习”……我的脑海里又浮现出高三的情景，这次我要跟一群更没用的复读的人在一起。脑子一阵疼痛之后，我说：“妈妈，我不想退学了。”</span> 

<span class="comment">可是军训回到学校，发现宿舍如此差劲，我又想退学。妈妈又来帮我办理手续，可是结果我还是由于懦弱反悔了。害得学校办事的老师都骂我：“你这个人简直神经病！”</span> <span class="comment">对啊，我确实是有病，不过我的是精神病，不是神经病。我恨我的高中，我恨我的大学，我恨高考，我恨中国的教育！是你们让我生病的。可是妈妈，她为了我已经费尽了辛苦。我不能再这样周折下去。我自己在学校里好好努力，准备考上清华的研究生吧。</span> 

<span class="comment">学校住宿环境很差劲，又经过好多麻烦事，我终于决定在校外去租房子住。后来我开始玩滑板，它让我变得勇敢。我心里逐渐平静下来，可以用心看书了。大二以后，我的学习生活才逐渐进入正常，自信开始恢复。</span> 

<span class="comment">梦的复苏</span> 

<span class="comment">记得川大教Pascal语言的老师第一堂课就对我们说：“我们学校就是落后啊。外面公司里都用C</span>, <span class="comment">C</span>+<span class="literal">+</span><span class="comment">了，我们还在教Pascal。你们以后要出去工作恐怕还是得学学VC什么的。”</span> <span class="comment">于是有的同学开始抱起一本本像“XXX圣经”之类的书开始学习，上数学课也在看这些东西。我当时自愧不如啊。自己就是小学的时候玩过一下学习机，可以说没有任何计算机基础。辅导员也经常夸他们几个动手能力强，以后公司就需要这样的人。他们出口就是Bill</span> <span class="comment">Gates</span>, <span class="comment">世界首富云云。军训的时候听着他们说什么DOS</span>, <span class="comment">温95，我就只有张着嘴崇拜的份了。才想起我高中计算机竞赛的时候一道有关DOS命令的题没有做出来，现在听他们说才知道原来DOS是个“操作系统"。那操作系统又是什么，他们说每个电脑上都必须有一个操作系统……我真是愧不如人</span> <span class="literal">-</span><span class="comment">\_</span>-<span class="comment">!</span> 

<span class="comment">正在我决定鼓起勇气后来跟上，准备拿起一本DOS大全从头啃起的时候，一次偶然的机会我接触到了Linux。后来又因为The</span> <span class="comment">Art</span> <span class="comment">of</span> <span class="comment">Computer</span> <span class="comment">Programming，接触到了Knuth。我才发现，课堂上讲的那些东西原来如此低级，有些东西学了就过时，学它干吗？我并不比别人落后多少。我一再的思考，什么是计算机科学？是什么让我们计算机系的人不同于其他系的。我有时候认为有了答案，但是后来答案又被我自己推翻。在思想的混乱中，我发现我逐渐摆脱了旁人的标准。我不再想像别人那样去考计算机等级考试，对微软的认证也不屑一顾。我自己学会了Linux，还会很多种当时别人听都没听说过的计算机语言。我学会了LaTeX，还因为找出Knuth书里的错误得到两张支票。上课要不就逃掉，背地里拿着大部头的“龙书”之类的原版英语书啃。要不就看我打印出来的GNU的一些资料，完全不听老师讲。期末划重点的时候也不去，考试却总能考个八九十分，总有几个女生排名在我上面。不过我不在乎这点分数，考试和分数不再能评价我。同学们大概都觉得我是一个怪人，后来毕业了我才听他们说，他们管我叫“怪才”。我如此努力的学习着，对别的事情充耳不闻。我只有一个目的，就是毕业就离开这个鬼地方，进入清华大学上研究生。虽然大家不理解我在干什么，清华的老师应该挺在乎我学的东西吧。</span> 

<span class="comment">可是我没有想到，在我死啃书本的时候，我的创造力正在离我远去。在我盲目接受我认为高深的材料的时候，我失去了自己的创造。我成了比别人稍微好一点的技术工人，不再跟爱迪生和牛顿是一类人了。我高中的时候拼命想保存的创造力已经在苦读之下消失殆尽。我看书的方式变得顺序化，总想从头看到尾。我的高中老师们的目的，中国教育的目的，终于快达到了。</span> 

<span class="comment">清华，我来了</span> 

<span class="comment">大三的暑假，我来到清华想拿一些考研的资料。这是我梦中的地方呀，美丽的校园，比川大要大上好多倍吧，脚都走痛了才走到招待所。去系办，一个办事员态度很不好的给我一份资料。哎，学校好，人脾气就该大啊。忍了吧，要是真能考进来就好了。</span> 

<span class="comment">后来听一个老师说清华有一种学生叫“直博”，可以硕博连读，五年拿到博士学位。只要面试通过就可以进来学习。我心想这种方式好啊，我平生最讨厌的就是考试了。出高考题的那帮人，他们有什么资格考我！考研资料也是遍地飞。写了几本复习材料就自称什么“一代名师”，我最看不起这种人了，就会赚钱。我如果可以获得“直博”的名额，就可以永远摆脱他们了。想一想，要是硕士三年，博士三年，就要六年。现在五年就可以拿到博士学位，还不用考试，真是太好了。可是我又有什么资格获得清华的直博？我在川大从来没听说过这种东西。</span> 

<span class="comment">于是我就开始打电话联系老师，跟他们谈谈。面对他们的眉头，面对他们的笑脸却无可奈何的说“没有名额”，我都感觉没什么希望了。一个院士甚至对我说：“你们四川大学是什么学校？二流都算不上，最多算个三流大学。你怎么能来我这里！”</span> <span class="comment">我深受打击，可是我还是没有放弃。最后我找到了一个老师，我们一开始就谈的挺投机。他听说我跟Knuth有联系，挺高兴的说，哦我知道他，好多年前来我们这里做过报告呢。我终于觉得找到了知音，于是决定就跟着他学习。老师找好了之后还有一个面试，是别的老师参加的，我说什么他们似乎没有认真听，就一个劲看我的考试成绩这种我不屑一顾的东西。我面试时特意穿上了Knuth送我的MMIX</span> <span class="comment">T</span>-<span class="comment">shirt，他们大概根本不知道是什么，我也没有提起。</span> 

<span class="comment">不过老师只对我的体育成绩提出了疑问，说你怎么才80多分？你的身体能不能胜任繁重的学习任务啊？我笑着回答，我每天还跑5000米呢，我们学校打分比较严，难道清华的学生体育都考90？面试就这样通过了。</span> 

<span class="comment">推荐信与散伙饭</span> 

<span class="comment">面试通过后回到学校还要办一些手续。成绩单，推荐信等等，跟申请外国大学研究生院差不多，让我感觉挺正规的。院长对我挺好的，同意帮我签推荐信。可是签完字之后他对我说：“你别以为他们觉得你是个人才。他们是根本招不到人！他们那里像你这样的学生都出国了，剩下的是最差的。谁想读博士啊？你别太高兴了。”</span> <span class="comment">我笑着应付这突如其来的打击，在心里却不断为自己的选择辩护。清华一定是好样的，不会让我失望。它是我的梦啊。</span> 

<span class="comment">很多麻烦的手续之后，终于拿到了我梦想的大学的录取通知书，可以离开川大这个鬼地方了。毕业的散伙饭上，看着大家喝得酩酊大醉，还有人在咆哮说居然连川大的文凭都没拿到，我一个人默默地想象着即将到来的清华的快乐生活，暗自庆幸。</span> 

<span class="comment">散伙饭到了尾声的时候，我诧异的看到一个平时不太熟悉的同学拿着一杯啤酒走过来。我挺紧张，我最不喜欢别人给我敬酒了，说是客气，其实很虚伪。没想到他说：“我敬你一杯，大牛人。听说你被清华大学录取作了博士。我干了，你随意。”</span> <span class="comment">我不知如何回答，我一向不知如何应付别人的恭维。还好他没有让我也干杯，倒是够尊重人。没想到喝完他接着说：“我知道你是怎样的人。我很仰慕你，你是真正喜欢研究的人。可是我要告诉你，清华的人并不会比我们好多少。大部分人也只是想混一个学位，将来找个好工作。没有多少人可以跟你一起研究的，你去了必定很孤独。我就很奇怪你这样的人怎么不出国呢！你会后悔的。”</span> 

<span class="comment">我有点不高兴了。一个人说你的选择是错误的，你的反应是什么呢？反正我当时为我的“清华梦”作了一番辩护，说我进去自己好好研究，应该还是能够很好的，毕竟这是我从小的梦啊。可是没想到，他说的居然是对的，我现在开始感谢他了。</span> 

<span class="comment">计算几何，创造力的复苏</span> 

<span class="comment">清华还是一样的上课方式，大部分课也是很多人一起上，一起打瞌睡。老师也是照本宣科，我居然发现他们其实跟川大的老师没什么区别。清华的不同之处就是，一到考试的时候原来进行的一切娱乐活动都不见了人影。原本每天晚上都有人一起玩轮滑，考试的时候就只剩下我孤零零的一个人。因为大家都怕考试，开始熬夜复习了。还有就是上课不容易逃课了，有些老师会突然点名，缺席会严重影响最后的成绩。</span> 

<span class="comment">对于博士生，传说还有一个规定，那就是后10%淘汰。也就是说，不管你成绩如何，如果成绩排名在课程的后10%，那么就要重修。而如果两门功课重修，就会被开除。面对如此残酷的规定，很多同学都惶惶不可终日。我就是在隔壁同学的唠叨声中度过了第一期。不过我还是没有把考试当回事，所以我也没有去验证这个说法的官方真实性。我仍然不去听老师划重点，我仍然不觉得老师出的题目有什么好，我仍然讨厌有人让我们用手算矩阵。可能觉得太残酷，还是觉得要是开除了博士生谁来干活，这条规定后来改成了如果博士生上了80分就可以不重修。我也不知道为什么我觉得考砸的科目也上的了80，故意放我过去的吗？</span> 

<span class="comment">但是我的生命中出现了这样一门课程。它改变了我对老师的看法，让我觉得上课原来也可以如此有趣。这就是计算几何。上课的人很少，只有十来个人。因为听说这门课很难，很多同学都没有选。但是我就是那种知难而进的人。老师上课的方式跟别的课程很不一样，大家坐在一个小教室里，老师有精美的幻灯片，有动画，不时还插入一段大科学家，大哲学家的名言。上课时老师会停下来很多次让学生提问题，下课大家都积极踊跃的讨论新奇的问题。课程的评分方法也很特别，平时成绩占到30%的分量，作业分为几种分值，可以自己选择做不做，作业的总分数乘以30%，加上最后大作业的分数乘以70%，就是最后的得分。说真的，这门课太有趣了，我就只逃过一次课。但是还是有时候人数不到一半，因为其他课程压力太大，有人都去复习别的课程了。但是邓老师从来不点名，还对逃课的同学表示同情。还问我们在座的有没有其他课特别紧张的，下次课可以不来。真是让人感动。</span> 

<span class="comment">我就是在这门课上认识了王益，我们亲密无间的合作，让我领略到了什么叫做研究。大作业的时候我们在一个小组，其实是三人一组，但是那第三个人其实什么也没干。我和王益决定写一个3D的Voronoi图扫描算法演示程序。王益的3D图形编程能力很强，所以他做界面，由我负责算法生成数据作为后端。我们分别在自己的机器上编写程序，不时的打电话讨论接口的设计问题。我找到了Bell</span> <span class="comment">labs</span> <span class="comment">的</span> <span class="comment">Steven</span> <span class="comment">Fortune</span> <span class="comment">的算法程序，决定看懂它，然后改造成演示需要的分部运行的算法。但是</span> <span class="comment">Fortune</span> <span class="comment">的程序几乎没有注释，而且使用了一种奇怪的数据结构，很难理解。Fortune</span> <span class="comment">还在程序里说到，这个算法虽然有效，但是对于程序员来说是一个挑战。所以我email请他给我一份算法论文的拷贝，他同意了。但是一个月之后，信才到我手里，那时我们已经完成了作业。因为我花了一个星期看懂了他的程序，还换掉了他的麻烦又低效的数据结构。随后成功的把后端与王益的前端设计好接口联合。等我看到</span> <span class="comment">Fortune</span> <span class="comment">的论文，发现程序里面其实已经改进了论文的核心内容。我深深体会到实践的重要性，也许有了他的论文我反而会被误导，写不出实际可以运行的程序。</span>    

<span class="comment">由于我们的团结努力，老师对我们的大作业非常满意，他给了我们最高的分数</span> <span class="comment">100。由于我们两个都在课下超额完成作业，所以总的分数我们两个都是满分。这是我阔别已久的100分。只有在小学我才拿到过这种分数啊！对于一个对考试成绩满不在乎的人，100</span> <span class="comment">又意味着什么？如果是别的课程我会毫不在乎，就像我得了80分一样。可是这个100分是我们团结研究而来的，它包含了对我们的合作意识，对我们的友谊，对我们的热情的肯定。虽然我觉得我们的东西还有改进的余地，但是我接受这个100分！也只有这样的课程，我才可能得100分。</span> 

<span class="comment">从此我感觉到了什么叫做研究。这跟我小时候干的那些事情没有什么两样。你在身边发现一个问题，想知道为什么。然后你就想去获得解决这个问题的知识。你去看书，你去问专家，你上网去搜索。如果没有发现答案，那么好啦，你就可以自己试图去发现为什么，这是最有趣的部分。知道了为什么，就想让这个东西有用处，对人们的生活产生好处。这就是研究。</span> 

<span class="comment">《完全用Linux工作》与TeX的推广</span> 

<span class="comment">这么说来我还是对清华有些好感。遇到一个好老师让我从呆头呆脑的技术工人的状态恢复过来，开始追求自己的梦想。可是第一年把所有的课程上完之后，我就发现原来清华所谓的“研究”是如此混沌。其实清华大部分人进行的所谓的“研究”是什么呢？其实就是写作，不是科学研究。这一点以后我会详细叙述。</span> 

<span class="comment">远远看去外观华丽的有着先进的工作站的实验室，却没有可以安心看书的地方。机器挨着机器人挨着人，书都没地方放。师兄师姐们都在忙着用word写论文，不时有两个人隔着几行机器大声谈话。实验室通风不好，还有一个大型工作站在嗡嗡作响，我进去一会儿就觉得头晕，所以后来就不想去了。PC机以前都是公用的，每次都会用不同的机器，却没有我想用的软件，麻烦死了。好不容易实验室买了新机器分配给个人，装上一个</span> <span class="comment">Linux</span> <span class="comment">系统开始写程序，还在Sun工作站上安装了多达1G的GNU程序。却被一个师兄嘲笑说那种跟DOS一样落后的东西你居然也用。于是我写了一篇文章叫做《完全用Linux工作》，放在主页上驳斥这种观点，引起网上linux界轩然大波。后来我又发现几乎全校的论文都是word排版的，我本科毕业论文就用LaTeX了，清华居然这么土！我对word排版的论文质量恨之入骨，所以又写了文章宣传</span> <span class="comment">TeX，打击</span> <span class="comment">word</span> <span class="comment">在论文排版的市场。这下子我出名了，真没想到，出名不是因为我的研究成果，而是因为这些业余的东西。我起初其实不希望我因此出名，但是看到旁边的人都用上了</span> <span class="comment">TeX，我觉得我还是做了一件好事，至少让论文看起来漂亮了一些。</span> 

<span class="comment">可是论文的内容，却是我永远的痛！</span> 

<span class="comment">培养计划</span> 

<span class="comment">我在第一年就把功课全部上完了。本来我想多选几门课，比如法语，可是清华的博士要选课需要提交一个“培养计划”给导师签字。导师同意之后才能修改。导师看到我选了法语，就说这个第二外语还是自己学学就行了吧，旁听也行啊，我主要是怕你课太多了考试不通过就麻烦了。我当时没有说什么，就把法语去掉了，只留下刚够学分的课程。其实我还想选很多的，体育，音乐什么的，都不好意思跟导师说。后来才知道宿舍对门的硕士生选了钢琴课他们导师都不管。为什么我们就受到如此待遇？</span> 

<span class="comment">可是没有把法语加到培养计划却成了我的遗憾。有一个新学期我去旁听了第一节法语课之后老师就说，我知道很多同学是来旁听的，这样教室里人太多了，效果不好。这对自己对大家都不好，下次请旁听的同学不要来了。我脸皮薄，下次就没有去了。后来自己想自学却又没有老师教，看了十集Reflet之后就此作罢。</span> 

<span class="comment">后来我终于明白了，清华不需要全面发展的博士生，而其实导师还会在某种程度上削弱学生的能力。导师并不是真的为我们好，而是不喜欢我们上课，因为上课不但会花掉研究（或者干活）的时间，而且让他们眼界太开阔，这样学生会很容易有别的选择而走掉。所有的活动：助教，实习，都必须有导师签字。而大部分导师就会找借口不让学生干这些事情。不给他们助教和实习的机会，让他们以后不好找工作，只能为自己服务，或者为自己的熟人服务。甚至这次我去西藏，要办边境证都要有导师签字。办事的老师说，没有导师签字，你跑出去了不回来怎么办？大妈，我跑那种鬼地方干吗？</span> 

<span class="comment">除了这些，还有两大法宝就是博士学位和违约金。清华的博士学位有多值钱知道吗？不知道？那么博士退学要交30000块钱的违约金，这下大部分穷苦学生怕了吧。这就是你们的卖身契。清华就是这样把研究生牢牢地控制在自己的掌握之下。我对一个如此害怕学生跑掉的不自信的学校还能说些什么？如果你是好样的，就不会害怕我们跑掉！该跑掉的最后终究会跑掉。</span> 

<span class="comment">我的自我培养</span> 

<span class="comment">在学习上，我永远是个吃不饱的人。选不了课，我就去旁听。旁听后觉得老师讲的不好，我就自学。在我有空的时候，我就会去图书馆借书看。在我本科的时候，我就已经发现自己的一个特点，我会很快发现新的东西，并且学会使用它。虽然这些东西并不是创新，但是它们丰富了我的技能，让我有更大的能力去进行创新。</span> 

<span class="comment">计算几何课的一次作业，我为了写一个算法的演示程序，花了3天时间学了一点Java语言，正好能够完成那个程序。我开始接触到TeX的底层细节，看完了The</span> <span class="comment">TeXbook，并且找出一道练习题答案的错误。开始移植gbkfonts程序，作为我的CWEB语言的练习。看完了几乎所有</span> <span class="comment">Xlib</span> <span class="comment">的手册，深入了解了</span> <span class="comment">XWindow</span> <span class="comment">的工作原理。我接触到</span> <span class="comment">Scheme，并且做完了</span> <span class="comment">SICP</span> <span class="comment">的大部分习题。我领会到</span> <span class="comment">LISP</span> <span class="comment">的强大，改变了我们多年以来对这种古老语言的误解。接着我又学会了</span> <span class="comment">Common</span> <span class="comment">LISP，并且开始用它设计用来研究计算几何的一个函数库。另外还找了一些希奇古怪的程序来玩，写了一些心得体会放在网上给别人看。</span> 

<span class="comment">我意识到自己数学还不够强，就开始看一些数学方面的书。Concrete</span> <span class="comment">Mathemtatics</span>, <span class="comment">What</span> <span class="comment">is</span> <span class="comment">Mathematics?</span>, <span class="comment">Science</span> <span class="comment">and</span> <span class="comment">Hypothesis</span>, <span class="comment">GEB</span>, <span class="string">.</span><span class="string">.</span><span class="string">.</span> <span class="comment">虽然每一本都没有看完，但是我逐渐相信自己的数学能力，发现数学原来如此简单。我开始对哲学感兴趣……</span> 

<span class="comment">我们也有讨论，原来是这个样子</span> 

<span class="comment">上完课，就该开始搞研究啦。可是研究什么呢？老师给我几篇论文看，意思是让我看看有没有什么想法。</span> 

<span class="comment">我开始感觉没有头绪，就跟导师说能不能找师兄师姐跟我讨论讨论，还有别的人在做这个吗？他说，就你一个人做这个，每个人做一个题目，独立思考，这就是研究。我觉得是啊，我应该独立思考。可是过了一段时间发现不行啊，我想实现一个想法，但是我不知道是不是已经有人试过失败了。实验的时间开销会比较多，所以我想知道那么多厉害的人，为什么都不用这种明摆在那的方法？当我再次提出需要讨论的时候，他似乎有点生气的说：”你为什么总是想有人跟你做一样的东西啊？你不是想抄袭别人的论文吧？”</span> <span class="comment">我不发话了。继续做我的实验，结果确实不理想。虽然自己实践很重要，可是要是能利用别人的经验，何乐而不为呢？这并不是偷懒。如果有人讨论，很多时候一个人提出一个问题，另外的人就会告诉他这个问题是不是有人做过，有什么重要性，凭直觉告诉他有什么难度。可是如果没有讨论，连问问“有没有人做过”的机会都没有！</span> 

<span class="comment">后来我就经常上网看看国外的大学怎么搞研究，发现他们都有</span> <span class="comment">seminar，讨论组。后来又买了一本</span> <span class="comment">A</span> <span class="comment">Beautiful</span> <span class="comment">Mind，看到Princeton以前的天才们每天都在一个地方喝茶，讨论问题，争得面红耳赤，回家分头思考，做实验，第二天喝茶时再讨论。那就是我从小梦寐以求的生活啊！计算几何课已经让我爱上了与人合作和讨论的方式，现在却孤零零一个人了。我必须告诉导师，合作和讨论是非常重要的。在我据理陈述之后，他说：“好吧。反正师兄师姐各自有自己的事，你要讨论什么就跟我和你副导师讨论吧。”</span> <span class="comment">于是我就开始了跟他们两个星期一次的见面讨论。每次讨论都感觉他们不知道我在说什么，他们心里想的都只是这个能比别人的好多少呢？能不能投到这个会议呢？如此宏观。我觉得跟他们讨论完全是浪费时间。</span> 

<span class="comment">后来课题逐渐有了新的同学加入，导师决定跟中科院数学所的人一起申请一个项目来研究。于是我们两个星期一次去中科院讨论。不过感觉他们那边也差不多。中科院的老师觉得他们的研究太理论，期望我们能给他们带去一点实际的东西。可是我们也没有什么实际的东西，所有的问题都是从别人的paper里看到的。副导师就开始跟他们说这个问题有多么多么重要……</span> <span class="comment">他们也借此机会开始研究以前放下的一些问题。总之讨论的感觉就是没有目的，没有主题。有时有人说他在想一个什么问题，说了一会儿就被否决了。有时候就是一个人看了一篇paper之后做一个感想。我坐在那里就在想，我们到底在干什么？我们甚至都不知道什么东西值得研究，还研究什么？后来师弟师妹们就开始考虑把问题变一变，看看能不能产生新的问题。他们的做法照我的话说就是“有问题也要解决；没有问题，制造问题也要解决！”</span> 

<span class="comment">博士生论坛的时候，同学们都觉得有类似的问题，讨论不足，交流不足。所以我提议成立一个类似国外大学的</span> <span class="comment">Common</span> <span class="comment">Room，用来讨论问题。可是大部分老师说：“这样一个房间，天天都要有那么多人在里面待着。谁来出这个钱？”</span> <span class="comment">是啊，老师自己的办公室都要钱，哪里可能有什么</span> <span class="comment">Common</span> <span class="comment">Room？就算有了</span> <span class="comment">Common</span> <span class="comment">Room，在里面讨论的无非还是文章发到哪里的问题。制度决定了行为，我的设想太理想化了。</span> 

<span class="comment">分析一下，为什么老师不提倡讨论呢？因为问题是有限的。老师辛辛苦苦这么多年搞来搞去都在搞这些问题，分配给你们每人一个，互不冲突。要是两个人都搞一个问题，这下好了。出了成果论文归谁？学校要求必须第一作者才算论文数。要是两个人都写论文，那么投到同一个会议肯定有一个要被reject。这样对集体发展不利嘛，大家不就是发几篇论文混毕业吗？何苦？</span> 

<span class="comment">paper</span>, <span class="comment">paper</span>, <span class="comment">还是paper</span> 

<span class="comment">但是我更关心的是论文的内容。说到论文我就痛心。我的方向上我至今还没有看到几篇我觉得像样的文章。我主要进行集成电路布线算法的研究。看起来高深，其实是很简单的问题，一个平面上有一些点是电路里的电极，现在需要用铜线把它们连起来，怎么样让连线的长度或者时延最短？这个问题跟几何上一个有名的问题</span> <span class="comment">Steiner</span> <span class="comment">tree</span> <span class="comment">问题有关系。我的导师就是以前写了一篇这样的paper发到IEEE</span> <span class="comment">transactions。</span> 

<span class="comment">已经毕业的一个师兄就在他研究的基础上修改来修改去，发了好几篇paper。英文的不够还翻译成中文，投到国内的期刊。后来一个师姐又在这个师兄的基础上进行修改，又发了好多篇。可是在我看来，他们的论文纯粹就是炒冷饭，没有什么创新。一个问题解决了，那么解决问题的人显示了他们的聪明，至于这个问题对人有什么用，他可以暂时不管（虽然我也严重反对这种做法）。后来又有人来搞这个问题，多半是被老师分配来的。他也小修改一下，修改想法其实不费工夫，主要是你怎样把你的</span> <span class="comment">Introduction</span> <span class="comment">写好？可以让别人觉得你的工作有意义？这就是功夫。作家的功夫。我有一次面见INRIA的头目</span> <span class="comment">Jean</span>-<span class="comment">Claude</span> <span class="comment">Paul</span> <span class="comment">时，他就对我说：“Tsinghua</span> <span class="comment">students</span> <span class="comment">are</span> <span class="comment">all</span> <span class="comment">writers</span>, <span class="comment">not</span> <span class="comment">scientists</span>.<span class="comment">”</span> 

<span class="comment">现在清华研究生做的事情无非就是，写好paper，然后找个地方投出去。SCI</span> <span class="comment">的最好，EI的其次。偏僻的没人看的杂志也没关系，交钱也没关系。我就知道日本的一个SCI索引的期刊收1000美元的版面费。导师出钱，不投白不投，投了好毕业呵！</span> 

<span class="comment">现在我也被“分配”来做这个问题。虽然说是一个有名的问题，但是这个有名的问题已经被研究了好几十年了。有很多牛人做出了很重要的贡献，这里面不乏</span> <span class="comment">D</span>.<span class="comment">Z</span>.<span class="comment">Du</span> <span class="comment">之类的传奇人物。但是我们为什么研究这个问题？我至今没有搞懂。</span> 

<span class="comment">开头导师只是给了我两篇paper，据说是以前他一个得意门生写的，美国某大学的副教授。其中有一篇说是如何在不构造</span> <span class="comment">Delaunay</span> <span class="comment">triangulation的情况下生成</span> <span class="comment">MST</span> <span class="comment">（最小生成树）。看到这篇文章开头说在</span> <span class="comment">rectilinear</span> <span class="comment">metric下</span>, <span class="comment">Delaunay</span> <span class="comment">triangulation</span> <span class="comment">就不能用来构造</span> <span class="comment">MST</span> <span class="comment">了，所以他设计了一个新的算法。这个算法比起</span> <span class="comment">Leo</span> <span class="comment">Guibas</span> <span class="comment">的算法更加简单。文章里还提到一次</span> <span class="comment">Matroid，让初出茅庐的我觉得高深莫测。可是我对“Delaunay</span> <span class="comment">triangulation</span> <span class="comment">不能用来构造</span> <span class="comment">RMST”</span> <span class="comment">这个说法产生了怀疑。经过理论分析我觉得即使在</span> <span class="comment">rectilinear</span> <span class="comment">metric下，Delaunay</span> <span class="comment">triangulation</span> <span class="comment">也可以用来构造</span> <span class="comment">MST</span> <span class="comment">的，我决定实践我的想法，写一个程序从Delaunay</span> <span class="comment">triangulation</span> <span class="comment">构造出一个</span> <span class="comment">RMST。这本身不是什么创新的工作，可是我却在想，这样一个东西能不能用来构造</span> <span class="comment">Steiner</span> <span class="comment">tree</span> <span class="comment">呢？后来我真的就想出一个办法。实验表明我的算法比以前的算法要快几倍。</span> 

<span class="comment">这是不是说我的算法是一个值得写paper的东西呢？导师说我应该写一篇，但是我认为我只是在挑别人的毛病时意外想出了一个改进的算法，并不会对将来的研究有什么改进。虽然程序快了一些，但是很少有那么大的线网需要这么快的算法，而且几倍的提高在我眼里不算是一个理论上的改进。所以我内心觉得这个结果不令我兴奋，不想写论文。但是在老师的一再要求下，我居然把这个研究写成了两篇paper。按照他的说法：“应该分阶段总结你的成果。”</span> <span class="comment">起初投出去的时候评委总是说这个东西不实用，导师说这是评委的问题，他们觉得不实用我们就投到理论一点的会议。经过几次投稿，还是失败了。我终于忍不住了，对导师说出我的想法，我说：“看一个作家的水平，是看他扔在垃圾筐里的纸。就让我把这篇paper永远藏在我的垃圾筐里吧。”</span> <span class="comment">但是他不甘心，说你要相信自己的实力，然后把我的算法胡乱夸奖了一番。我说我不管了，随便你怎么办。我就开始研究我自己喜欢的东西去了。之后他居然真的投中一个欧洲的会议，还是被</span> <span class="comment">LNCS</span> <span class="comment">收录的，LNCS</span> <span class="comment">是</span> <span class="comment">SCI</span> <span class="comment">索引的，所以我居然有了一篇</span> <span class="comment">SCI</span> <span class="comment">文章！我自己不喜欢的文章也是</span> <span class="comment">SCI</span> <span class="comment">了！</span> 

<span class="comment">第二篇论文就更传奇了。几投不中，就其原因，评委说是没有和现在最先进的算法程序实验比较。而我没有比较的程序，就是那个让我鄙视的人的程序。没办法，求他给我代码，只给</span> <span class="comment">binary，也不给源代码。比了一下，确实比他快。不过我估计他程序写的有毛病，老是</span> <span class="comment">core</span> <span class="comment">dump。不过还是记录下数据，添到论文上。一投就中，得了一个最佳论文奖。然后就有一篇校内新闻宣传：“我校王垠同学获得XXX会议最佳论文奖。这是大陆学者首次在如此高级别的会议上获得如此高的奖项。”</span> <span class="comment">这个“高级别”的会议，在我看来就是个垃圾。美国人都把最差的论文投到这里，就是为了来旅游一圈而已。</span> 

<span class="comment">我见过的这种低级别的会议，低质量的论文几乎都是从</span> <span class="comment">IEEE</span> <span class="comment">那里出来的。道理很简单，IEEE</span> <span class="comment">会议多，会议论文集都像两块砖头那么厚，还是双列小字排版，当然能容纳下这么多的垃圾了。所以我对</span> <span class="comment">IEEE</span> <span class="comment">也没有好感。</span> 

<span class="comment">火山小规模爆发</span> 

<span class="comment">第一篇投中了会议之后，副导师很高兴的说“代替我去开会”，到希腊Santorini岛玩了一圈。回来还跟我说希腊不好玩，好苦啊，幸好你没去。然后就继续要我为算法申请一个专利。</span> 

<span class="comment">写这个论文我都已经焦头烂额了，一点都不感兴趣。现在还要写专利，“要像教小学生做这件事一样，一步一步的把算法写清楚，举出实例”。我觉得快不行了，再这样折腾下去，我到博士毕业也许也就只搞出这些小儿科东西吧！我终于小规模爆发了一次。我坦荡的告诉了副导师我的想法，我觉得做学问应该是什么样，我觉得这么点东西不值得申请专利。我还告诉他我对国内的研究环境很失望。</span> 

<span class="comment">他慌了，可能以为我想要退学，赶忙找我谈谈。对我说，我知道你心中有很大抱负。所以这次就不写专利了。我知道你想有更好的研究环境，但是不踏踏实实做好现在的工作，又怎么能有大的创造呢？然后就开始举爱因斯坦，居里夫人的例子……</span> <span class="comment">然后说，其实你在这里好好努力，将来出国的机会多的是，你想去Harvard也行，你想去Princeton，都行啊！</span> 

<span class="comment">你说行就行？你去去给我看看？我们实验室从来就没有去这些地方的。</span> 

<span class="comment">全面发展</span> 

<span class="comment">在对清华的研究完全失望了之后。我就准备考GRE，TOEFL出国了。我去上了一个新东方的班，没学到什么英语方面的东西，倒是接触了很多新的思想。老罗的言论特别有趣，虽然我不是完全赞同他的意见。写GRE作文特别培养思维能力。我为了写GRE作文，常常为了一个不明白的问题到图书馆翻阅英文的哲学书籍，有关教育的书籍……</span> <span class="comment">对于很多问题我得到了完全不同的观点。大学的目的是什么？人的价值观是由理性决定的吗？等等等等。我读到了亚里士多德，柏拉图，康德等人的言论。甚至有个哲学家说</span> <span class="comment">"All</span> <span class="comment">Animals</span> <span class="comment">Are</span> <span class="comment">Equal"</span>. <span class="comment">我看了他的文章觉得有很多可以批驳的观点。我看到迪卡尔的文章，说“要掌握科学就要掌握它的全部”，这句话真合我心意，我就是想做一个懂很多东西的人啊。我想结合艺术与科学。虽然我这个观点得到了某位图灵奖得主的批判，但是我仍然相信迪卡尔。</span> 

<span class="comment">从这些互相矛盾的观点中，我有了自己的判断力。我开始能够揭开从小蒙在我眼睛上的有色眼镜看问题。我开始检查我自己的思维，我以前的观点。看看它们是否是未经判断就盲目放进去的。我检查到很多很多的错误。我的待人接物，我对他人的理解上，都有不足之处。我还检查到妈妈传递给我的一些有色眼镜。我开始学会用自己新的方式对待他人，看待事物。我不再盲目相信权威，哪怕他是诺贝尔奖得主，图灵奖得主。我有了自己的自由思维。</span> 

<span class="comment">在那段时间，我感觉我的心智大门被开启了。我开始尝试从来没有做过的事情，以及从来不认为我能做好的事情。我一次又一次的相信我能。我能学会画画，我能打好太极拳，我能理解古典音乐……</span> <span class="comment">世界还有那么多美好的事情等着我去学习去开发啊！</span> 

<span class="comment">可是，我们却像囚犯一样被判了5年在清华。博士学位就是我们的枷锁。</span> 

<span class="comment">醒悟，paper的奥秘</span> 

<span class="comment">清华研究生谈论的重点是什么？是</span> <span class="comment">paper。吃饭的时候谈，喝茶的时候谈，睡觉的时候也谈。隔壁的同学在进校第一年就为paper惶惶不可终日，说：“你知道吗，他们要求我们发SCI，怎么办呢？我几个师兄都是因为没有paper延期毕业的。”</span> <span class="comment">这恰好就是那个为后10%淘汰惶惶不可终日的同学。他的老师是个院士，可是他在手下就干一些写word文档之类的杂活还忙得要命，根本没有时间思考问题。</span> 

<span class="comment">后来听说学校有规定，博士生必须发4篇paper才能毕业，其中必须有一篇是SCI索引，或者两篇EI索引。看上去冠冕堂皇的SCI</span>, <span class="comment">EI，不就是跟</span> <span class="comment">google</span> <span class="comment">差不多的东西吗？被它索引了怎么样了？特别是对文章的篇数作要求，而对质量没有判断。我其实读了两年都还不知道学校是这样规定毕业标准的。当我知道的时候，已经有人告诉我SCI=Silly</span> <span class="comment">Chinese</span> <span class="comment">Index。真是让人啼笑皆非。</span> 

<span class="comment">学校没有能力评价学生的水平，就拿文章数来衡量。这样的毕业标准造就的是怎样的学生，怎样的实验室呢？难道导师真的没有能力判断paper的好坏吗？有些是，但是有些不是。即使他知道你的论文没什么价值，也会叫你发表。我发现paper数量的背后，是某些人的如意算盘。想一想是怎么回事吧。国家看什么来拨款研究？看paper。看什么来评价一个学校的水平，也是paper。国家没有能力评价你的能力，当然只有看你有多少paper。所以有了paper就有了钱。只要你能写paper，培不培养你，你将来的发展，关我们什么相干？你写的paper别人能不能看懂，能不能转化成生产力，管我们什么相干？怪不得有的院士想尽办法也要多收学生，宁愿自己帮学生出学费也要他进来。因为学生就是财源。paper可以带来基金，可以在美国买小车洋房，没有基金就让学生干活吧。一个月几百块钱吊着一条命在那里为你拼命，谁叫他们想要那个博士学位呢！</span> 

<span class="comment">该清醒了，博士无产阶级！</span> 

<span class="comment">告别清华的博士学位</span> 

<span class="comment">现在我已经厌烦了国内所谓的“学术”。我准备放弃清华的博士学位，出国找个好老师，进行真正的研究。博士第4年了，做出这样的决定真是不容易。有人告诉我不要放弃，你知道有多少人正在羡慕你？你知道一个清华的博士学位有多么值钱吗？但是我不能这么沉默下去了！</span> 

<span class="comment">博士学位，累坏了多少年轻的中国人！我不再为它浪费我的青春。如果国外也找不到好的老师，我就找一个简单的工作，和我心爱的人一起生活。有人说这是浪费人才？在清华混沌的过日子才是浪费呢！当一个侍者至少也让我感到对社会有贡献，看着顾客满意，我会露出笑容。可是做一个博士却没有。我感觉自己是个没用的人。</span> 

<span class="comment">我已经完全看透了中国教育的失败。我高中的时候就受到它的伤害，这种伤害延续到现在。中国教育已经成为埋没人才的祸首。留在这个圈子里就是屈服，我不出声，大家都不出声，这个世界就会继续这样郁闷的运转下去。我今天要对这个系统大声地说一声“不！”</span> 

<span class="comment">我离开了。可是中国永远也不缺少为清华拼命的人！因为他们的妈妈会告诉他们，清华是全中国最好的学校。你要考上清华，为我们光宗耀祖……</span> 

<span class="comment">行动</span> 

<span class="comment">2005年9月22日下午3点，我在东主楼导师的办公室里跟导师和副导师再次重申了我的想法。包括以上的一切，和我退学的打算。导师经过一番举例爱因斯坦，居里夫人，叫我踏踏实实的说教无效之后，严厉的批评了我只顾自己，不顾及教研组为我付出的心血。然后说：“要是你不能再为实验室作研究，我们就不能支持你了。前两个月实验室发的钱我收回，你如果决定可以马上写退学申请。我们实验室没有什么损失，我们有的是人干你的事情。不过我要警告你，你一旦退学，连学校的住宿都要被收回！”</span> 

<span class="comment">接着是副导师尖声的咆哮：“是啊，你瞧不起我们。我们是没有你聪明，可是我们勤勤恳恳……你知道你得的那个best</span> <span class="comment">paper</span> <span class="comment">award，我们付出了多少努力吗？你认为这么容易拿到吗？那是多少国外专家鉴定……”</span> 

<span class="comment">真像是一场闹剧，一场梦。他平息下来之后，我说了一声“再见”，然后默默地走出了办公室。</span> 

<span class="comment">你们要退学申请？这就是我的退学申请。</span> 

<span class="comment">尾声</span> 

<span class="comment">晚上收到副导师的email说：“还有一件事需要向你说一下：你在学校学习期间所取得的成绩包含你的努力、导师的指导帮助、同学们的帮助，还有学校和国家的支持。你作为博士生学习阶段取得的成果属于教研组、学校和国家。正如同我们作为职务发明的专利属于学校一样。</span> 

<span class="comment">你在MST、SMT等方面取得了结果，它属于教研组、学校和国家。单位有责任进行合理的应用，为国家建设、国家荣誉服务。有责任进行进一步的整理丰富、向高水平的刊物投送。这里我们想说明一下上述的情况，同时，也告诉你一下：你若愿意将这些成果进行进一步的整理、我们已经给你提出了具体的修改意见，欢迎你按照进行修改。你若放弃，我们将进行具体的改进、投递。我们将尊重你的意见。谢谢。”</span> 

<span class="comment">最后还是没有忘了paper的剩余价值。进一步验证了我的判断，他们在乎我吗？不。他们只在乎paper。至于我流离失所，又有何相干？我不知道有多少无知的弟弟妹妹又会把他们的研究建立在我不屑一顾的paper之上。</span> </code></pre>
<p>后记：我写本文的目的</p>
<p>Repair what you can — but when you must fail, fail noisily and as soon as possible. </p>
<pre><code>                                                    —<span class="variable">Basics</span> <span class="keyword">of</span> <span class="variable">The</span> <span class="variable">UNIX</span> <span class="variable">Philosophy</span></code></pre>
<p>修复你能修好的—但是如果你必须失败，那就尽快喧闹的退出。—UNIX基本哲学</p>
<p>我不是一个中国教育操作系统下优良的程序。我在系统里运行了将近20年，快到最后的时候才喧闹的退出，Dump出这么大一个core file。我知道有的程序很早就退出了，我自愧不如他们。但是有的程序一声不响就退出了，还有很多的程序成为了zombie，永远的驻留在系统中成了系统的负担，在这一点上我又比他们好一些。至少我让程序员有机会用调试器检查core文件，调查这个程序运行中哪里出了问题。</p>
<p>“你退学就退学，干吗大惊小怪，牢骚满腹的？” 如果只是有牢骚，我就把隔壁同学拉过来一起发发牢骚就完事了。可是我虽然不是优秀的程序，我觉得应该为修复这个系统，修复自己做点什么。我希望国家的教育和研究环境好起来，这样大家就安心的生活，不用出国搞得奔波流离。有多少恋人由于一个人出国了而痛苦的分手，有多少父母在盼望海外游子的归来？我不能像很 多人那样申请了国外的学校，拍拍屁股就走人。我一年前就考GRE想出国，可是我总是自欺欺人的幻想国内的境况会好起来，有时我觉得看到希望，可是马上希望 又破灭了。一个个大师来了，让我一次次燃起希望，可是发现他们对环境的作用也不大。一些大师不满意，又走了。我自己也想尽力改造环境，结果经过多次努力无效，自认能力不够，终于放弃了。</p>
<p>在发现大家都忙着发表paper而没有讨论时，我曾经建议设立一个清华的THU-Technical Report。我的想法是：最差的草稿扔在垃圾堆里；可能有用但是还不值得向所有人公开的东西发到THU-TR，供系内查阅；如果发现THU-TR的东西 会有用，再好好修改了转投会议或者期刊。系学术助理王磊很高兴的采纳了我的建议，并且自愿维护一个THU-TR的编号。可是根本没有人愿意把自己好不容易 写出来的但是确实又不值得发表的东西投到这里，因为世界上总有地方可以把这个东西投出去，还是SCI和EI，而这个THU-TR连正式刊物都不算。后来有人告诉我，如果学生都把东西投到我们这里，不知道有多少导师会跟我们急。所以THU-TR的计划就这么告罢。</p>
<p>我一年前写信给Knuth，这个我相信是真正的大师。我说我想退学，想请他推荐一些真正的研究者给我做老师。他回信说“你先找精通中国文化 的长者谈谈”。我意识到他可能觉得这是一个文化的问题。我于是想知道中国的科技为什么搞不好，就开始看一些有关文化的东西。后来居然跑到中国社会科学院去听新竹清华大学人文学院的院长讲座，后来又在清华参加了人文学院的研讨会。会上一个老师说的好，当一个制度没法衡量学术水平本身，它就会用一个似乎等价的 标准，比如paper数或者高考分数。但是一旦这个标准被确立，人们就会向着这个标准努力，而不是向学术水平本身。他们总会发现制度的很多问题，找出破绽，去达到这个标准，而不是提高自己的学术水平。最后，这个标准已经完全不能反映水平本身。我就在想，这个问题大了，这不仅是环境，制度，而且还是长久以 来的文化造成的。从新竹清华大学院长的讲座里，我发现英国人是怎样用科学技术打开了中国的大门，而乾隆皇帝是如何对科学不感兴趣。中国似乎从古到今就不重视科学技术的，中国有自己的优势，自己的文化。对啊，科学技术是个双刃剑，如果照美国那样发展下去也不知道会怎么样。我们中国的文化是瑰宝，但是它已经被外国的坚船大炮打得遍体鳞伤。这不是我们的错，但是我们要努力恢复自己的文化，不能总是怨天尤人。我就开始看道德经之类的东西，还去西麓学社参加古代文化讨论活动，后来又开始打太极拳。</p>
<p>我觉得再没有从实际出发的目标，我的研究就会完全变成纸张了，就像我高中感觉到的一样。所以后来我就自己设立了一个研究方向，我把自己称为“研究博士生”，我要去了解博士生都是怎么样生活的。我就想知道有多少学生有跟我类似的困境。我跟很多朋友谈过，去了解他们的苦衷，研究生也有，本科的也有。我觉得我还应该了解更多的人，就试图到研究生通讯社做记者，心想挂一个记者证，就好跟人套磁问一些问题了。结果他们说我口才不好，所以做了一个秘书。后来记者们告诉我，他们是由上级分配任务的，根本不可能让你去报道学生真正的想法。我为了多多接触外国文化，比较中西文化的不同，又加入了学生对外交流协会 (ASIC)，我在ASIC有了很多好朋友。博士生论坛的时候也有很多同学跟我反映研究上的问题。讨论成立特别兴趣小组（SIGs）的时候，我就提议成立 一个Common Room，一个同学说她去Stanford 的时候那里就有很好的 Common Room，很多人在一起讨论，这是国外大学斯通见惯的东西。我告诉Oxford的朋友我的想法，他很惊奇地说：“你们居然没有 Common Room？” 后来吃饭时我又找一些老师谈话，发现他们也对这个事情无可奈何。老师自己的办公室都要自己出钱，谁还能支持你们有这么大一个房间？而且即使有了房间，谁来讨论？还不就是拿着别人的paper，试图找点可以改进的地方，或者就讨论哪个会议好发paper。Common Room只是一个形式，只要有人感兴趣，随便找个茶馆也能讨论。问题就在于没有人有精力有心情进行真正的讨论，制度决定一切。我们无能为力。我觉得自己一个学生力量太小，曾经试图找大师帮忙。我找到Andy Yao，述说我的苦衷。结果他对我说：“别试图去改造环境！你没有这个能力，连我都没有！改造好你自己就不错了。&quot; 改造好我自己，可是怎么改？所以我决定先换一个环境，到一个真正搞研究的地方去体会，去学习。</p>
<p>其实我不后悔进入川大，不后悔来到清华，珍惜一切的历史，因为没有它们，我也许就不是现在的我，有着自己想法的我。我也许就在安逸的生活中变得堕落。它们不完美甚至给我痛苦，但是我还是珍惜，珍惜这里的朋友，这里的一草一木。也许这就叫做爱。我会变得更好，我会挂念我的满目苍夷的祖国母亲。 我会回来告诉你我学到的一切，我会给你和其他儿女真正的幸福，一定的！</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-08T02:02:18.000Z"><a href="/2013/10/08/2013-05-21-6/">10月 8 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/08/2013-05-21-6/">Java Card 认证过程</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在SCP02的规则下打开安全通道的流程大致如下：<br>显式打开安全通道由两条命令来完成：<br>1，INITIALIZE UPDATE<br>2，EXTERNAL AUTHENTICATE<br>具体命令解释如下：<br>1，INITIALIZ E UPDATE:80 50 00 00 08 XX XX XX XX XX XX XX XX<br>解释下这条命令，这条命令实际上就是向智能卡送入一个随机数（8个XX），这个随机数产生的规则由主机程序自己定义。GP规范中称其为Host Challange<br>智能卡收到这条命令之后就会返回28个字节的响应数据，返回的数据包括：Key diversification(10Bytes)|key information(2Bytes)|</p>
<h1>sequence Counter(2Bytes)|card challenge(6bytes)|card cryptogram(8BYtes),参考下面的实例。</h1>
<p>exchangeapdu “0x80 0x50 0x00 0x00 0x08 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08”<br>SEND -> HEADER: 80 50 00 00 Lc = 008d</p>
<h2>0 1 2 3 4 5 6 7 8 9 A B C D E F</h2>
<p>00| 01 02 03 04 05 06 07 08 </p>
<p>//host challenge: 01 02 03 04 05 06 07 08<br>RECEIVE -> STATUS: 611C<br>SEND -> GET RESPONSE<br>HEADER: 80 C0 00 00 Le = 028d<br>ECEIVE -> STATUS: 9000</p>
<h2>0 1 2 3 4 5 6 7 8 9 A B C D E F</h2>
<p>00| 00 00 72 95 71 32 36 00 68 68 FF 02 00 08 8B 32<br>01| 0E C6 0E 9B F5 A6 DB F1 B3 FE B8 75<br>//以上这段是智能卡在收到Host Challenge之后的Response。<br>//Key diversification: 00 00 72 95 71 32 36 00 68 68<br>//key information: FF 02<br>//sequence Counter: 00 08<br>//card challenge: 8B 32 0E C6 0E 9B</p>
<h1>//card cryptogram: F5 A6 DB F1 B3 FE B8 75</h1>
<p>首先外部应用程序需要认证智能卡，也就是根据智能卡传回的数据和自己产生的Host Challenge以及应用程序事先应该知道的静态KEY<br>按照一定的规则计算出一个密文出来和卡返回的card cryptogram，进行比较，如果一致的那说明卡通过了外部应用程序的认证。<br>Host根据卡返回的数据校验card cryptogram的过程如下：<br>首先需要根据静态的Key(下面计算过程中的静态Key全部是0x40 0x41 0x42 0x43 0x44 0x45 0x46 0x47 0x48 0x49 0x4a 0x4b 0x4c 0x4d 0x4e 0x4f)<br>产生一套SessionKey,包括C-MAC Session Key，R-MAC Session Key，S-ENC Session Key，S-DEK Session Key<br>这4种SessionKey。<br>按照SCP02的规则产生Session Keys的过程如下：<br>step1:  Generating the Secure Channel C-MAC session keys<br>  Derivation Data = Constant(2bytes) | Sequence Counter(2bytes) | 00 00…00(12bytes)<br>      = 01 01 00 08 00 00 00 00 00 00 00 00 00 00 00 00<br>  C-MAC Session Key = 3DES-CBC[S-MAC](Derivation Data) = 01 5a 6c 21 17 aa ae 94 57 61 4e 5d af 04 29 b9<br>step2: Generating the Secure Channel R-MAC session keys<br>  Derivation Data = Constant(2bytes) | Sequence Counter(2bytes) | 00 00…00(12bytes)<br>      = 01 02 00 08 00 00 00 00 00 00 00 00 00 00 00 00<br>  R-MAC Session Key = 3DES-CBC[S-MAC](Derivation Data) = a4 82 e6 d5 a5 d3 83 13 0b b2 71 a8 57 8f 3b 16<br>step3: Generating the Secure Channel encryption session keys<br>  Derivation Data = Constant(2bytes) | Sequence Counter(2bytes) | 00 00…00(12bytes)<br>      = 01 82 00 08 00 00 00 00 00 00 00 00 00 00 00 00<br>  S-ENC Session Key = 3DES-CBC[S-MAC](Derivation Data) = 64 0d 58 ca 61 ad 53 ba bb e5 48 36 8d 81 da 20<br>step4: Generating the Secure Channel data encryption session keys<br>  Derivation Data = Constant(2bytes) | Sequence Counter(2bytes) | 00 00…00(12bytes)<br>      = 01 81 00 08 00 00 00 00 00 00 00 00 00 00 00 00<br>  S-DEK Session Key = 3DES-CBC[S-MAC](Derivation Data) = b4 f7 5c e0 a9 5e a3 f8 6b bd 05 1c b7 7c 0f ae<br>在SCP02规则下计算Card Authentication Cryptogram的过程如下：<br>  ICV = 00 00 00 00 00 00 00 00<br>  Derivation Data = 8bytes Host Challange | 2bytes Sequence Counter | 6bytes Card Challange | 80 00 00 00 00 00 00 00<br>      = 01 02 03 04 05 06 07 08 00 08 8B 32 0E C6 0E 9B 80 00 00 00 00 00 00 00<br>  Card Cryptogram = 3DES-CBC[S-ENC Session Key | ICV](Derivation Data)<br>      = F5 A6 DB F1 B3 FE B8 75<br>//Host 计算出来自己的Card Cryptogram再去和卡传回来的比较，就完成了外部程序认证卡的过程。<br>Host计算出来的Card Cryptogram和卡传回来的是一致的，第一步完成了！<br>接下来卡还要认证外部应用程序，外部应用程序同样根据卡传回来的数据和Host Challenge计算一个Host Cryptogram传给卡，卡内部<br>会来校验传给卡的数据的合法性的<br>看看怎样来计算Host Authentication Cryptogram，其过程如下：<br>  ICV = 00 00 00 00 00 00 00 00<br>  Derivation Data = 2bytes Sequence Counter | 6bytes Card Challange | 8bytes Host Challange | 80 00 00 00 00 00 00 00<br>      = 00 08 8B 32 0E C6 0E 9B 01 02 03 04 05 06 07 08 80 00 00 00 00 00 00 00<br>  Host Cryptogram = 3DES-CBC[S-ENC Session Key | ICV](Derivation Data)<br>      = b9 8d e2 87 b7 7f 7d 30<br>计算好了Host Cryptogram之后，由于传给卡的数据需要带MAC校验值，下面看看C-MAC的计算规则。<br>HOST把Host Cryptogram传送给智能卡是通过命令EXTERNAL AUTHENTICATE来实现的。<br>其命令结构是：APDU Header | Host Cryptogram(8Bytes) | MAC(8Bytes)<br>   其中APDU Header = 84 82 00 00 10<br>接着就需要计算C-MAC值了，其过程如下：<br>  ICV = 00 00 00 00 00 00 00 00<br>  Derivation Data = APDU Header | Host Cryptogram(Data Filed) | (padding value)<br>      = 84 82 00 00 10 b9 8d e2 87 b7 7f 7d 30 80 00 00<br>  把Derivation Data分割为2个部分：DerivationData_lefthalf = 84 82 00 00 10 b9 8d e2<br>          DerivationData_righthalf= 87 b7 7f 7d 30 80 00 00<br>  ICV1 = DES-CBC<a href="DerivationData\_lefthalf">first half of C-MAC Session Key | ICV</a><br>   = B8 01 83 80 5F 24 DF 56<br>  MAC = 3DES-CBC<a href="DerivationData\_righthalf">C-MAC Session Key | ICV1</a><br>   = 33 7B 1E E8 E3 C8 9A DA</p>
<h1>计算好了MAC值，就可以把Host Challenge 和 MAC一起通过如下命令发送到智能卡验证是否成功！</h1>
<p>exchangeapdu “0x84 0x82 0x00 0x00 0x10 0xb9 0x8d 0xe2 0x87 0xb7 0x7f 0x7d 0x30 0x33 0x7B 0x1E 0xE8 0xE3 0xC8 0x9A 0xDA”<br>SEND -> HEADER: 84 82 00 00 Lc = 016d</p>
<h2>0 1 2 3 4 5 6 7 8 9 A B C D E F</h2>
<p>00| B9 E2 87 B7 7F 7D 30 33 7B 1E E8 E3 C8 9A DA </p>
<h1>RECEIVE -> STATUS: 9000</h1>
<p>打开安全通道成功</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-08T02:02:18.000Z"><a href="/2013/10/08/2013-05-17-5/">10月 8 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/08/2013-05-17-5/">MFD40 DATA LOG</a></h1>
  

    </header>
    <div class="entry">
      
        <p>commandSELECT_PICC ———————— </p>
<p>APDU >>>: 90 5A 00 00 03 00 00 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 00 </p>
<p>doDESFireAutenticate ————————</p>
<p>keyNo 00 </p>
<p>keyValue 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 </p>
<p>APDU >>>: 90 0A 00 00 01 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: FF 75 E8 C7 F5 FF 32 2B 91 AF </p>
<p>RndA 00 00 00 00 00 00 00 00 </p>
<p>ERndB FF 75 E8 C7 F5 FF 32 2B </p>
<p>RndB CF AD C5 31 68 EE 5A 52 </p>
<p>RndB1 AD C5 31 68 EE 5A 52 CF </p>
<p>dkNo 00 00 00 00 00 00 00 00 AD C5 31 68 EE 5A 52 CF </p>
<p>EdkNo 8C A6 4D E9 C1 B1 23 A7 A6 57 37 A3 8B 5F E8 56 </p>
<p>APDU >>>: 90 AF 00 00 10 8C A6 4D E9 C1 B1 23 A7 A6 57 37 A3 8B 5F E8 56 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 8C A6 4D E9 C1 B1 23 A7 91 00 </p>
<p>encRndA1 8C A6 4D E9 C1 B1 23 A7 </p>
<p>RndA1 00 00 00 00 00 00 00 00 </p>
<p>RndA 00 00 00 00 00 00 00 00 </p>
<p>SessionKey 00 00 00 00 CF AD C5 31 </p>
<p>commandFORMAT_PICC ———————— </p>
<p>APDU >>>: 90 FC 00 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 00 </p>
<p>commandSELECT_APPLICATION 0x01 ———————— </p>
<p>APDU >>>: 90 CA 00 00 05 01 00 00 0F 01 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 00 </p>
<p>commandSELECT_APPLICATION 0x01 ———————— </p>
<p>APDU >>>: 90 5A 00 00 03 01 00 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 00 </p>
<p>doDESFireAutenticate ————————</p>
<p>keyNo 00 </p>
<p>keyValue 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 </p>
<p>APDU >>>: 90 0A 00 00 01 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: A4 0E 38 CC 6E 5B 44 38 91 AF </p>
<p>RndA 00 00 00 00 00 00 00 00 </p>
<p>ERndB A4 0E 38 CC 6E 5B 44 38 </p>
<p>RndB 75 59 2D E8 36 D8 26 1F </p>
<p>RndB1 59 2D E8 36 D8 26 1F 75 </p>
<p>dkNo 00 00 00 00 00 00 00 00 59 2D E8 36 D8 26 1F 75 </p>
<p>EdkNo 8C A6 4D E9 C1 B1 23 A7 57 56 3F 77 4C FE E7 60 </p>
<p>APDU >>>: 90 AF 00 00 10 8C A6 4D E9 C1 B1 23 A7 57 56 3F 77 4C FE E7 60 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 8C A6 4D E9 C1 B1 23 A7 91 00 </p>
<p>encRndA1 8C A6 4D E9 C1 B1 23 A7 </p>
<p>RndA1 00 00 00 00 00 00 00 00 </p>
<p>RndA 00 00 00 00 00 00 00 00 </p>
<p>SessionKey 00 00 00 00 75 59 2D E8 </p>
<p>commandCHANGE_KEY_VALUE ———————— </p>
<p>KeyNo 00 </p>
<p>sessionKey 00 00 00 00 75 59 2D E8 </p>
<p>newKey FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF </p>
<p>crcBlock 37 CB </p>
<p>newKey_crcBlock FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 37 CB </p>
<p>pKeyData FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 37 CB 00 00 00 00 00 00 </p>
<p>Block1 FF FF FF FF FF FF FF FF </p>
<p>Block2 FF FF FF FF FF FF FF FF </p>
<p>Block3 37 CB 00 00 00 00 00 00 </p>
<p>xB1 FF FF FF FF FF FF FF FF </p>
<p>DxB1 48 2A C1 3C 95 84 59 61 </p>
<p>xB1corB2 B7 D5 3E C3 6A 7B A6 9E </p>
<p>xB2corB3 2A 73 92 5C F7 93 AC 07 </p>
<p>DxB3 98 ED 39 11 3D DF FD 56 </p>
<p>DxB1_DxB2_DxB3 48 2A C1 3C 95 84 59 61 1D B8 92 5C F7 93 AC 07 98 ED 39 11 3D DF FD 56 </p>
<p>APDU >>>: 90 C4 00 00 19 00 48 2A C1 3C 95 84 59 61 1D B8 92 5C F7 93 AC 07 98 ED 39 11 3D DF FD 56 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 00 </p>
<p>doDESFireAutenticate ————————</p>
<p>keyNo 00 </p>
<p>keyValue FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF </p>
<p>APDU >>>: 90 0A 00 00 01 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 99 9C A5 60 AC 7F 3E 13 91 AF </p>
<p>RndA 00 00 00 00 00 00 00 00 </p>
<p>ERndB 99 9C A5 60 AC 7F 3E 13 </p>
<p>RndB 9C AC C6 3C 6D 88 96 DD </p>
<p>RndB1 AC C6 3C 6D 88 96 DD 9C </p>
<p>dkNo 00 00 00 00 00 00 00 00 AC C6 3C 6D 88 96 DD 9C </p>
<p>EdkNo CA AA AF 4D EA F1 DB AE E5 02 E8 DF 32 65 44 71 </p>
<p>APDU >>>: 90 AF 00 00 10 CA AA AF 4D EA F1 DB AE E5 02 E8 DF 32 65 44 71 00 </p>
<p>APDU \&lt;\&lt;\&lt;: CA AA AF 4D EA F1 DB AE 91 00 </p>
<p>encRndA1 CA AA AF 4D EA F1 DB AE </p>
<p>RndA1 00 00 00 00 00 00 00 00 </p>
<p>RndA 00 00 00 00 00 00 00 00 </p>
<p>SessionKey 00 00 00 00 9C AC C6 3C </p>
<p>commandCHANGE_KEY_VALUE ———————— </p>
<p>KeyNo 00 </p>
<p>sessionKey 00 00 00 00 9C AC C6 3C </p>
<p>newKey 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 </p>
<p>crcBlock 37 49 </p>
<p>newKey_crcBlock 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 37 49 </p>
<p>pKeyData 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 37 49 00 00 00 00 00 00 </p>
<p>Block1 00 00 00 00 00 00 00 00 </p>
<p>Block2 00 00 00 00 00 00 00 00 </p>
<p>Block3 37 49 00 00 00 00 00 00 </p>
<p>xB1 00 00 00 00 00 00 00 00 </p>
<p>DxB1 3C 37 A5 45 D4 CE 35 0C </p>
<p>xB1corB2 3C 37 A5 45 D4 CE 35 0C </p>
<p>xB2corB3 EA FC 15 91 54 4F C9 11 </p>
<p>DxB3 5D E8 6E 74 AA 64 E8 38 </p>
<p>DxB1_DxB2_DxB3 3C 37 A5 45 D4 CE 35 0C DD B5 15 91 54 4F C9 11 5D E8 6E 74 AA 64 E8 38 </p>
<p>APDU >>>: 90 C4 00 00 19 00 3C 37 A5 45 D4 CE 35 0C DD B5 15 91 54 4F C9 11 5D E8 6E 74 AA 64 E8 38 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 00 </p>
<hr>
<p>commandSELECT_PICC ———————— </p>
<p>APDU >>>: 90 5A 00 00 03 00 00 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 00 </p>
<p>doDESFireAutenticate ————————</p>
<p>keyNo 00 </p>
<p>keyValue 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 </p>
<p>APDU >>>: 90 0A 00 00 01 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 11 70 A5 65 E7 5E 62 DA 91 AF </p>
<p>RndA 00 00 00 00 00 00 00 00 </p>
<p>ERndB 11 70 A5 65 E7 5E 62 DA </p>
<p>RndB 03 07 FF 8A 1E C4 CB 5F </p>
<p>RndB1 07 FF 8A 1E C4 CB 5F 03 </p>
<p>dkNo 00 00 00 00 00 00 00 00 07 FF 8A 1E C4 CB 5F 03 </p>
<p>EdkNo 8C A6 4D E9 C1 B1 23 A7 AA 39 C4 87 D0 7E 90 B5 </p>
<p>APDU >>>: 90 AF 00 00 10 8C A6 4D E9 C1 B1 23 A7 AA 39 C4 87 D0 7E 90 B5 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 8C A6 4D E9 C1 B1 23 A7 91 00 </p>
<p>encRndA1 8C A6 4D E9 C1 B1 23 A7 </p>
<p>RndA1 00 00 00 00 00 00 00 00 </p>
<p>RndA 00 00 00 00 00 00 00 00 </p>
<p>SessionKey 00 00 00 00 03 07 FF 8A </p>
<p>commandFORMAT_PICC ———————— </p>
<p>APDU >>>: 90 FC 00 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 00 </p>
<p>commandSELECT_APPLICATION 0x01 ———————— </p>
<p>APDU >>>: 90 CA 00 00 05 01 00 00 0F 01 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 00 </p>
<p>commandSELECT_APPLICATION 0x01 ———————— </p>
<p>APDU >>>: 90 5A 00 00 03 01 00 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 00 </p>
<p>doDESFireAutenticate ————————</p>
<p>keyNo 00 </p>
<p>keyValue 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 </p>
<p>APDU >>>: 90 0A 00 00 01 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: F6 01 FB 1E 22 46 43 04 91 AF </p>
<p>RndA 00 00 00 00 00 00 00 00 </p>
<p>ERndB F6 01 FB 1E 22 46 43 04 </p>
<p>RndB B4 2B F7 F2 34 9F 67 69 </p>
<p>RndB1 2B F7 F2 34 9F 67 69 B4 </p>
<p>dkNo 00 00 00 00 00 00 00 00 2B F7 F2 34 9F 67 69 B4 </p>
<p>EdkNo 8C A6 4D E9 C1 B1 23 A7 48 28 19 77 C0 D9 C6 E8 </p>
<p>APDU >>>: 90 AF 00 00 10 8C A6 4D E9 C1 B1 23 A7 48 28 19 77 C0 D9 C6 E8 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 8C A6 4D E9 C1 B1 23 A7 91 00 </p>
<p>encRndA1 8C A6 4D E9 C1 B1 23 A7 </p>
<p>RndA1 00 00 00 00 00 00 00 00 </p>
<p>RndA 00 00 00 00 00 00 00 00 </p>
<p>SessionKey 00 00 00 00 B4 2B F7 F2 </p>
<p>commandCHANGE_KEY_VALUE ———————— </p>
<p>KeyNo 00 </p>
<p>sessionKey 00 00 00 00 B4 2B F7 F2 </p>
<p>newKey 02 02 02 02 02 02 02 02 02 02 02 02 02 02 02 02 </p>
<p>crcBlock 97 EF </p>
<p>newKey_crcBlock 02 02 02 02 02 02 02 02 02 02 02 02 02 02 02 02 97 EF </p>
<p>pKeyData 02 02 02 02 02 02 02 02 02 02 02 02 02 02 02 02 97 EF 00 00 00 00 00 00 </p>
<p>Block1 02 02 02 02 02 02 02 02 </p>
<p>Block2 02 02 02 02 02 02 02 02 </p>
<p>Block3 97 EF 00 00 00 00 00 00 </p>
<p>xB1 02 02 02 02 02 02 02 02 </p>
<p>DxB1 20 EE B7 40 D8 DB D2 FB </p>
<p>xB1corB2 22 EC B5 42 DA D9 D0 F9 </p>
<p>xB2corB3 99 0F B0 41 AB 1E 43 CB </p>
<p>DxB3 70 B5 DC DE 61 2A 41 86 </p>
<p>DxB1_DxB2_DxB3 20 EE B7 40 D8 DB D2 FB 0E E0 B0 41 AB 1E 43 CB 70 B5 DC DE 61 2A 41 86 </p>
<p>APDU >>>: 90 C4 00 00 19 00 20 EE B7 40 D8 DB D2 FB 0E E0 B0 41 AB 1E 43 CB 70 B5 DC DE 61 2A 41 86 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 00 </p>
<p>doDESFireAutenticate ————————</p>
<p>keyNo 00 </p>
<p>keyValue 02 02 02 02 02 02 02 02 02 02 02 02 02 02 02 02 </p>
<p>APDU >>>: 90 0A 00 00 01 00 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 7D 26 C0 7B C9 D3 9D 43 91 AF </p>
<p>RndA 00 00 00 00 00 00 00 00 </p>
<p>ERndB 7D 26 C0 7B C9 D3 9D 43 </p>
<p>RndB C4 6D F3 B6 33 1F 5A 5C </p>
<p>RndB1 6D F3 B6 33 1F 5A 5C C4 </p>
<p>dkNo 00 00 00 00 00 00 00 00 6D F3 B6 33 1F 5A 5C C4 </p>
<p>EdkNo C4 AF 51 BD 0A 0F 8A DD 03 EA 58 A9 C5 BD E9 77 </p>
<p>APDU >>>: 90 AF 00 00 10 C4 AF 51 BD 0A 0F 8A DD 03 EA 58 A9 C5 BD E9 77 00 </p>
<p>APDU \&lt;\&lt;\&lt;: 91 AE</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-08T02:02:18.000Z"><a href="/2013/10/08/2013-05-15-4/">10月 8 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/08/2013-05-15-4/">瞧一下咱们公交卡是如何制造出来的</a></h1>
  

    </header>
    <div class="entry">
      
        <p>三种材料<br>天线<br>胶水<br>芯片先准备</p>
<p><img src="https://writingsio.s3.amazonaws.com/attachments/51935c2d4017a4b104000109/79774642d3cee93d97c2833156e4971d/20090201_bc97da2a098be44e9c10DIbBDbugK9K4.jpg" alt=""></p>
<p>准备好了 我们由系统集成公司方案指导下 完成一个系统的档案，决定使用什么芯片是最核心的 大家可以看看别的城市使用的是什么芯片<br>目前国内曾经用过的公交卡（非接触卡）大概有这么几种<br>Philps的S50（8K位）、S70（32K位）；<br>摩托罗拉的TYPE　b卡（南京用过，型号忘记了），后来，摩托罗拉的IC卡事业部卖给了三星；<br>上海地方标准的ISO14443Type a 卡:复旦微电子了FM11F08SH（8K位）和FM11F32SH（32K位）<br>，另外华虹也有8K位的上海标准的Type a卡；<br>SONY FELICA 卡，也就是所谓的ISO14443 typeC卡<br>比较特殊一点的是：单程票，目前只有上海和广州用，上海用的是复旦微电子的FM11RF005（0.5K位），广州用的MF0 IC U1X(Ultralight)，将来北京也可能用MF0 IC U1X(Ultralight)，<br>其中，二、三家国内厂商生产兼容Philps的S50（8K位）的卡，有复旦微电子的FM11F08，贝岭（型号忘记了，想了解大家可以查一下）<br>北京 Philps的S50（8K位）、S70（32K位）<br>上海、苏州、无锡 复旦微电子了FM11F08SH（8K位）和FM11F32SH（32K位，用作联名卡）、FM11RF005（0.5K位），<br>深圳 深圳通 SONY 的TYPEC<br>广州 S50（8K位）、<br>香港 八达通 SONY 的TYPEC<br>台湾 悠游卡 （就是SONY FELICA 卡)<br>至于其它地区？<br>你想了解哪里，告诉我，我可以帮你查，通常都是Philps的S50（8K位)或是国内的兼容卡（上面我已经说过）<br>上海一卡通 复旦FM11RF08SH 华虹也有该芯片 无锡，阜阳等城市也采用<br>上海地铁卡 复旦FM11RF005SH 不是华虹SHC1102<br>北京一卡通 MF1 PHILIPS S70 城市公园门票（属于一卡通公司管理）复旦FM11RF08<br>香港八达通 索尼Felica<br>深圳一卡通 索尼Felica 以前是Felica，但现在已经开始发行新型Type A CPU予以取代<br>广州一卡通 MF1 PHILIPS S50/S70<br>广州地铁卡 AT88RF020 新的采购合同已经开始使用Mifare Ultralight 产品予以取代，地铁的储值票使用复旦FM11RF32<br>深广高速（是否指广深铁路？） MIFARE Ultralight<br>南京一卡通 MIFARE DESFire （以前是Motorola TypeB,现在是Mifare Desfire，但斗胆预测在不久将来改为TypeA 的CPU卡）苏州一卡通 MIFARE proX<br>大连一卡通 MIFARE proX<br>沈阳一卡通 三星CPU<br>大家可以知道其中使用做多的一种卡是  Mifare S50<br>PHILIPS Mifare 1 芯片型号：MFRC530 </p>
<p>太原\北京燕山\山东东营\柳州\云南开远\南宁\泸州\宁波\福建三明\<br>安徽合肥\广西桂林\山东济宁\青海西宁\吉林延\山西大同\江苏常州\贵州贵阳\江苏镇江\浙江湖州\<br>湖南长沙\江西南昌\四川攀枝花\江苏徐州\山东潍坊\辽宁营口\河南新乡\吉林长春\湖北襄樊\浙江衢州\ 苏州\宜春\景德镇\即墨\南通\绍兴\厦门\石家庄炼油厂\台州路桥\云南大理\通化\遵义\东莞\   </p>
<p>到这里聪明的人大概可以从 淘宝上查到一张白卡的价格了 但是成本可不光卡的成本哦  </p>
<p>我们上设备去 </p>
<p><img src="https://writingsio.s3.amazonaws.com/attachments/51935c8b4017a4b10400010a/4b413af0791f55a20bc67980cd7b57e9/20090201_885f90bc3866b86438ce7s6t7Dvslw7D.jpg" alt=""></p>
<p><img src="https://writingsio.s3.amazonaws.com/attachments/51935ca84017a4b10400010b/6dfc7bba92fdade47b6e5f2548c5f188/20090201_698f34f20e073b1ef0ed3K1YU1yB3111.jpg" alt=""></p>
<p><img src="https://writingsio.s3.amazonaws.com/attachments/51935cc64017a456a1000256/d4187bb5d156b723b0760c582930d07f/20090201_340489c2c50ac92d1f13NNnwrh2TTpfh.jpg" alt=""></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-08T02:02:18.000Z"><a href="/2013/10/08/2013-05-15-3/">10月 8 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/08/2013-05-15-3/">如何读取NFC手机钱包的余额</a></h1>
  

    </header>
    <div class="entry">
      
        <p>// select PSF (1PAY.SYS.DDF01) /*———————————————————————————*/<br>beijing.Util.log(&quot;select file: tag.selectByName(DFN_PSE)&quot;);<br>if (tag.selectByName(DFN_PSE).isOkey()) {<br>protected final static byte[] DFN_PSE = { (byte) ‘1’, (byte) ‘P’,<br>(byte) ‘A’, (byte) ‘Y’, (byte) ‘.’, (byte) ‘S’, (byte) ‘Y’,<br>(byte) ‘S’, (byte) ‘.’, (byte) ‘D’, (byte) ‘D’, (byte) ‘F’,<br>(byte) ‘0’, (byte) ‘1’, }; //1PAY.SYS.DDF01<br>name = DFN_PSE;<br>ByteBuffer buff = ByteBuffer.allocate(name.length + 6);<br>buff.put((byte) 0x00); // CLA Class<br>buff.put((byte) 0xA4); // INS Instruction<br>buff.put((byte) 0x04); // P1 Parameter 1 SELECT by NAME<br>buff.put((byte) 0x00); // P2 Parameter 2<br>buff.put((byte) name.length); // Lc<br>buff.put(name); buff.put((byte) 0x00); // Le<br>SELECT命令参考<br>第1部分电子钱包电子存折应用卡片规范 之<br>  表33 SELECT 命令报文<br>  表34 SELECT 命令引用控制参数</p>
<h1>如果返回结果结尾是 0x9000  ，就SELECT成功</h1>
<p>SFI_EXTRA_LOG = 4;<br>// read card info file, binary (4)<br>/*———————————————————————————————*/</p>
<h1>INFO = tag.readBinary(SFI_EXTRA_LOG);</h1>
<p>SFI_EXTRA_CNT = 5;<br>// read card operation file, binary (5)<br>/*———————————————————————————————*/<br>CNT = tag.readBinary(SFI_EXTRA_CNT);<br>public Response readBinary(int sfi) {<br>final byte[] cmd = { (byte) 0x00, // CLA Class<br>(byte) 0xB0, // INS Instruction<br>(byte) (0x00000080 | (sfi &amp; 0x1F)), // P1 Parameter 1<br>(byte) 0x00, // P2 Parameter 2<br>(byte) 0x00, // Le<br>};<br>CNT = tag.readBinary(SFI_EXTRA_CNT);<br>参考：<br>第1部分电子钱包电子存折应用卡片规范 之 </p>
<h1>表25 READ BINARY 命令报文</h1>
<p>读余额之前的操作<br>// select Main Application<br>byte[] DFI_EP = { (byte) 0x10, (byte) 0x01 };<br>/*———————————————————————————————*/<br>if (tag.selectByID(DFI_EP).isOkey()) {<br>public Response selectByID(byte[] name) {<br>ByteBuffer buff = ByteBuffer.allocate(name.length + 6);<br>buff.put((byte) 0x00); // CLA Class<br>buff.put((byte) 0xA4); // INS Instruction<br>buff.put((byte) 0x00); // P1 Parameter 1 SELECT by ID<br>buff.put((byte) 0x00); // P2 Parameter 2<br>buff.put((byte) name.length); // Lc<br>buff.put(name); buff.put((byte) 0x00); // Le</p>
<h1>return new Response(transceive(buff.array()));</h1>
<p>读余额<br>CASH = tag.getBalance(true);<br>public Response getBalance(boolean isEP) {<br>final byte[] cmd = { (byte) 0x80, // CLA Class<br>(byte) 0x5C, // INS Instruction<br>(byte) 0x00, // P1 Parameter 1<br>(byte) (isEP ? 2 : 1), // P2 Parameter 2<br>(byte) 0x04, // Le<br>};<br>参考：<br><a href="http://blog.csdn.net/jennyvenus/article/details/4183994" target="_blank">http://blog.csdn.net/jennyvenus/article/details/4183994</a><br>//Get Balance                       (defined by PBOC)<br>80 5C 00 02 04<br>PBOC 第2部分(电子钱包_电子存折应用规范)<br>表2 命令的类别字节和指令字节<br>读余额（GET BALANCE）<br>‘80’ ‘5C’ ‘00’ ‘0X’</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 NG
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>