<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ISO8583协议-银行交易标准 | NG's Blog</title>
  <meta name="author" content="NG">

  
  <meta name="description" content="ISO8583包（简称8583包）是一个国际标准的包格式，最多由128个字段域组成，每个域都有统一的规定，并有定长与变长之分。      8583包前面一段为位图，用来确定包的字段域组成情况。      其中位图是8583包的灵魂，它是打包解包确定字段域的关键， 而了解每个字段域的属性则是填写数据的基础。">
  
  

  <link rel="alternate" href="/atom.xml" title="NG's Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>

<body>
  <header id="header" class="inner"><nav>
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
</nav></header>
  <div id="content" class="inner"><article class="post">
  
  <header>
    
  
    <h1 class="title">ISO8583协议-银行交易标准</h1>
  

    <time datetime="2013-10-08T02:02:18.000Z">
  <span class="day">8</span><span class="month">10月</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>ISO8583包（简称8583包）是一个国际标准的包格式，最多由128个字段域组成，每个域都有统一的规定，并有定长与变长之分。<br>      8583包前面一段为位图，用来确定包的字段域组成情况。<br>      其中位图是8583包的灵魂，它是打包解包确定字段域的关键， 而了解每个字段域的属性则是填写数据的基础。<br><a id="more"></a><br>1、 位图描述如下：<br>位图位置：1<br>格式：定长<br>类型：B16（二进制16位，16*8=128bit）<br>描述：<br>    如将位图的第一位设为‘1’，表示使用扩展位图（128个域），否则表示只使用基本位图（64个域）。<br>    如使用某数据域，应在位图中将相应的位设位‘1’，如使用41域，需将位图的41位设为‘1’。<br>选用条件：如使用65到128域，需设位图域第一位为‘1’  </p>
<p>2、每个域的定义如下：<br>typedef struct ISO8583<br>{<br>     int bit_flag; /*域数据类型0 — string, 1 — int, 2 — binary*/<br>     char *data_name; /*域名*/<br>     int length; /*数据域长度*/<br>     int length_in_byte;/*实际长度（如果是变长）*/<br>     int variable_flag; /*是否变长标志0：否 2：2位变长, 3：3位变长*/<br>     int datatyp; /*0 — string, 1 — int, 2 — binary*/<br>     char *data; /*存放具体值*/<br>     int attribute; /*保留*/<br>} ISO8583;</p>
<p>ISO8583 Tbl8583[128] =<br>{<br>/* FLD 1 */ {0,“BIT MAP,EXTENDED ”, 8, 0, 0, 2, NULL,0},<br>/* FLD 2 */ {0,“PRIMARY ACCOUNT NUMBER ”, 22, 0, 2, 0, NULL,0},<br>/* FLD 3 */ {0,“PROCESSING CODE ”, 6, 0, 0, 0, NULL,0},<br>/* FLD 4 */ {0,“AMOUNT, TRANSACTION ”, 12, 0, 0, 1, NULL,0},<br>/* FLD 5 */ {0,“NO USE ”, 12, 0, 0, 0, NULL,0},<br>/* FLD 6 */ {0,“NO USE ”, 12, 0, 0, 0, NULL,0},<br>/* FLD 7 */ {0,“TRANSACTION DATE AND TIME ”, 10, 0, 0, 0, NULL,0},<br>/* FLD 8 */ {0,“NO USE ”, 8, 0, 0, 0, NULL,0},<br>/* FLD 9 */ {0,“NO USE ”, 8, 0, 0, 0, NULL,0},<br>/* FLD 10 */ {0,“NO USE ”, 8, 0, 0, 0, NULL,0},<br>/* FLD 11 */ {0,“SYSTEM TRACE AUDIT NUMBER ”, 6, 0, 0, 1, NULL,0},<br>/* FLD 12 */ {0,“TIME, LOCAL TRANSACTION ”, 6, 0, 0, 0, NULL,0},<br>/* FLD 13 */ {0,“DATE, LOCAL TRANSACTION ”, 4, 0, 0, 0, NULL,0},<br>/* FLD 14 */ {0,“DATE, EXPIRATION ”, 4, 0, 0, 0, NULL,0},<br>/* FLD 15 */ {0,“DATE, SETTLEMENT ”, 4, 0, 0, 0, NULL,0},<br>/* FLD 16 */ {0,“NO USE ”, 4, 0, 0, 0, NULL,0},<br>/* FLD 17 */ {0,“DATE, CAPTURE ”, 4, 0, 0, 0, NULL,0},<br>/* FLD 18 */ {0,“MERCHANT&#39;S TYPE ”, 4, 0, 0, 0, NULL,0},<br>/* FLD 19 */ {0,“NO USE ”, 3, 0, 0, 0, NULL,0},<br>/* FLD 20 */ {0,“NO USE ”, 3, 0, 0, 0, NULL,0},<br>/* FLD 21 */ {0,“NO USE ”, 3, 0, 0, 0, NULL,0},<br>/* FLD 22 */ {0,“POINT OF SERVICE ENTRY MODE ”, 3, 0, 0, 0, NULL,0},<br>/* FLD 23 */ {0,“NO USE ”, 3, 0, 0, 0, NULL,0},<br>/* FLD 24 */ {0,“NO USE ”, 3, 0, 0, 0, NULL,0},<br>/* FLD 25 */ {0,“POINT OF SERVICE CONDITION CODE ”, 2, 0, 0, 0, NULL,0},<br>/* FLD 26 */ {0,“NO USE ”, 2, 0, 0, 0, NULL,0},<br>/* FLD 27 */ {0,“NO USE ”, 1, 0, 0, 0, NULL,0},<br>/* FLD 28 */ {0,“field27 ”, 6, 0, 0, 0, NULL,0},<br>/* FLD 29 */ {0,“NO USE ”, 8, 0, 1, 0, NULL,0},<br>/* FLD 30 */ {0,“NO USE ”, 8, 0, 1, 0, NULL,0},<br>/* FLD 31 */ {0,“NO USE ”, 8, 0, 1, 0, NULL,0},<br>/* FLD 32 */ {0,“ACQUIRER INSTITUTION ID. CODE ”, 11, 0, 2, 0, NULL,0},<br>/* FLD 33 */ {0,“FORWARDING INSTITUTION ID. CODE ”, 11, 0, 2, 0, NULL,0},<br>/* FLD 34 */ {0,“NO USE ”, 28, 0, 2, 0, NULL,0},<br>/* FLD 35 */ {0,“TRACK 2 DATA ”, 37, 0, 2, 0, NULL,0},<br>/* FLD 36 */ {0,“TRACK 3 DATA ”,104, 0, 3, 0, NULL,0},<br>/* FLD 37 */ {0,“RETRIEVAL REFERENCE NUMBER ”, 12, 0, 0, 0, NULL,0},<br>/* FLD 38 */ {0,“AUTH. IDENTIFICATION RESPONSE ”, 6, 0, 0, 0, NULL,0},<br>/* FLD 39 */ {0,“RESPONSE CODE ”, 2, 0, 0, 0, NULL,0},<br>/* FLD 40 */ {0,“NO USE ”, 3, 0, 0, 0, NULL,0},<br>/* FLD 41 */ {0,“CARD ACCEPTOR TERMINAL ID. ”, 8, 0, 0, 0, NULL,0},<br>/* FLD 42 */ {0,“CARD ACCEPTOR IDENTIFICATION CODE ”, 15, 0, 0, 0, NULL,0},<br>/* FLD 43 */ {0,“CARD ACCEPTOR NAME LOCATION ”, 40, 0, 0, 0, NULL,0},<br>/* FLD 44 */ {0,“ADDITIONAL RESPONSE DATA ”, 25, 0, 2, 0, NULL,0},<br>/* FLD 45 */ {0,“NO USE ”, 76, 0, 2, 0, NULL,0},<br>/* FLD 46 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 47 */ {0,“field47 ”,999, 0, 3, 0, NULL,0},<br>/* FLD 48 */ {0,“ADDITIONAL DATA —- PRIVATE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 49 */ {0,“CURRENCY CODE,TRANSACTION ”, 3, 0, 0, 0, NULL,0},<br>/* FLD 50 */ {0,“CURRENCY CODE,SETTLEMENT ”, 3, 0, 0, 0, NULL,0},<br>/* FLD 51 */ {0,“NO USE ”, 3, 0, 0, 0, NULL,0},<br>/* FLD 52 */ {0,“PERSONAL IDENTIFICATION NUMBER DATA ”, 8, 0, 0, 2, NULL,0},<br>/* FLD 53 */ {0,“SECURITY RELATED CONTROL INformATION”, 16, 0, 0, 0, NULL,0},<br>/* FLD 54 */ {0,“ADDITIONAL AMOUNTS ”,120, 0, 3, 0, NULL,0},<br>/* FLD 55 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 56 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 57 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 58 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 59 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 60 */ {0,“NO USE ”, 5, 0, 3, 0, NULL,0},<br>/* FLD 61 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 62 */ {0,“NO USE ”, 11, 0, 3, 0, NULL,0},<br>/* FLD 63 */ {0,“NO USE ”, 11, 0, 3, 0, NULL,0},<br>/* FLD 64 */ {0,“MESSAGE AUTHENTICATION CODE FIELD ”, 8, 0, 0, 2, NULL,0},<br>/* FLD 65 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 66 */ {0,“NO USE ”, 1, 0, 0, 0, NULL,0},<br>/* FLD 67 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 68 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 69 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 70 */ {0,“SYSTEM MANAGEMENT INformATION CODE ”, 3, 0, 0, 0, NULL,0},<br>/* FLD 71 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 72 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 73 */ {0,“NO USE ”, 6, 0, 0, 0, NULL,0},<br>/* FLD 74 */ {0,“NUMBER OF CREDITS ”, 10, 0, 0, 0, NULL,0},<br>/* FLD 75 */ {0,“REVERSAL NUMBER OF CREDITS ”, 10, 0, 0, 0, NULL,0},<br>/* FLD 76 */ {0,“NUMBER OF DEBITS ”, 10, 0, 0, 0, NULL,0},<br>/* FLD 77 */ {0,“REVERSAL NUMBER OF DEBITS ”, 10, 0, 0, 0, NULL,0},<br>/* FLD 78 */ {0,“NUMBER OF TRANSFER ”, 10, 0, 0, 0, NULL,0},<br>/* FLD 79 */ {0,“REVERSAL NUMBER OF TRANSFER ”, 10, 0, 0, 0, NULL,0},<br>/* FLD 80 */ {0,“NUMBER OF INQUIRS ”, 10, 0, 0, 0, NULL,0},<br>/* FLD 81 */ {0,“AUTHORIZATION NUMBER ”, 10, 0, 0, 0, NULL,0},<br>/* FLD 82 */ {0,“NO USE ”, 12, 0, 0, 0, NULL,0},<br>/* FLD 83 */ {0,“CREDITS,TRANSCATION FEEAMOUNT ”, 12, 0, 0, 0, NULL,0},<br>/* FLD 84 */ {0,“NO USE ”, 12, 0, 0, 0, NULL,0},<br>/* FLD 85 */ {0,“DEBITS,TRANSCATION FEEAMOUNT ”, 12, 0, 0, 0, NULL,0},<br>/* FLD 86 */ {0,“AMOUNT OF CREDITS ”, 16, 0, 0, 0, NULL,0},<br>/* FLD 87 */ {0,“REVERSAL AMOUNT OF CREDITS ”, 16, 0, 0, 0, NULL,0},<br>/* FLD 88 */ {0,“AMOUNT OF DEBITS ”, 16, 0, 0, 0, NULL,0},<br>/* FLD 89 */ {0,“REVERSAL AMOUNT OF DEBITS ”, 16, 0, 0, 0, NULL,0},<br>/* FLD 90 */ {0,“ORIGINAL DATA ELEMENTS ”, 42, 0, 0, 0, NULL,0},<br>/* FLD 91 */ {0,“FILE UPDATE CODE ”, 1, 0, 0, 0, NULL,0},<br>/* FLD 92 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 93 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 94 */ {0,“SERVICE INDICATOR ”, 7, 0, 0, 0, NULL,0},<br>/* FLD 95 */ {0,“REPLACEMENT AMOUNTS ”, 42, 0, 0, 0, NULL,0},<br>/* FLD 96 */ {0,“NO USE ”, 8, 0, 0, 0, NULL,0},<br>/* FLD 97 */ {0,“AMOUNT OF NET SETTLEMENT ”, 16, 0, 0, 0, NULL,0},<br>/* FLD 98 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 99 */ {0,“SETTLEMENT INSTITUTION ID ”, 11, 0, 2, 0, NULL,0},<br>/* FLD 100 */ {0,“RECVEING INSTITUTION ID ”, 11, 0, 2, 0, NULL,0},<br>/* FLD 101 */ {0,“FILENAME ”, 17, 0, 2, 0, NULL,0},<br>/* FLD 102 */ {0,“ACCOUNT IDENTIFICATION1 ”, 28, 0, 2, 0, NULL,0},<br>/* FLD 103 */ {0,“ACCOUNT IDENTIFICATION2 ”, 28, 0, 2, 0, NULL,0},<br>/* FLD 104 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 105 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 106 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 107 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 108 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 109 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 110 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 111 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 112 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 113 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 114 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 115 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 116 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 117 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 118 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 119 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 120 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 121 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 122 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 123 */ {0,“NEW PIN DATA ”, 8, 0, 3, 2, NULL,0},<br>/* FLD 124 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 125 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 126 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 127 */ {0,“NO USE ”,999, 0, 3, 0, NULL,0},<br>/* FLD 128 */ {0,“MESSAGE AUTHENTICATION CODE FIELD ”, 8, 0, 0, 2, NULL,0},<br>}; </p>
<p>３、变长，定长域说明<br>如第二域：域名为主帐号，<br>数据类型为string<br>长度为22（是长长度不得超过此数）<br>是个２位变长域<br>由于是２位变长，在打包时需在数据域前加上数据的实际长度，如为１９位，则表示为：<br>１９＋数据值（即前两位为长度）<br>如第三域：域名为处理码，<br>数据类型为string<br>长度为６<br>是个定长域<br>必须填满６位。  </p>
<p>附A:ISO8583各域段的说明<br>1，信息类型（message type）定义<br>位图位置：－<br>格式：定长<br>类型：N4<br>描述：<br>数据包的第一部分，定义数据包的类型。<br>数据类型由数据包的发起者设定，应遵循以下要求：<br>数据包开始部分必须是信息类型；<br>对不支持的信息类型能给出拒绝应答。<br>0100授权交易<br>0110授权交易答复<br>0200金融交易<br>0210金融交易答复<br>0240查询交易<br>0250查询交易答复<br>0400冲正交易<br>0410冲正交易答复<br>0800管理交易<br>0810管理交易答复<br>2，位图(Bit Map) - 基本位图和扩展位图<br>位图位置：1<br>格式：定长<br>类型：B16<br>描述：<br>如将位图的第一位设为‘1’，表示使用扩展位图，否则表示只使用基本位图。<br>如使用某数据域，应在位图中将相应的位设位‘1’，如使用41域，需将位图的41位设为‘1’。<br>选用条件：如使用65到128域，需设位图域为‘1’<br>3、Bit02主帐号(Primary Account Number)</p>
<p>位图位置：02<br>格式：变长,LLVAR<br>类型：N..22<br>描述：<br>唯一的确认一个用户交易的基本帐号。<br>由于银行电子服务系统涉及多个应用系统，而帐号长度最多为22位，故将原标准的19长度改为22位。<br>4、Bit03 处理代码 （Processing Code）<br>位图位置：03<br>格式：定长<br>类型：N6<br>描述：用于描述交易对客户帐户造成何种影响的代码。<br>处理代码和信息码一起可唯一定义一种交易的类型。<br>处理代码由以下三部分组成：<br>位置描述<br>1－2交易动作码<br>3－4付出帐户类型，用于借记类，如查询、代收费、转场交易。<br>5－6收入帐户类型，用于代收费、转帐等。<br>其中：<br>ff : 付出帐户<br>tt： 收入帐户<br>* 视主机而定<br>5，Bit04 交易金额 （Amount, Transaction）<br>位图位置：04<br>格式：定长<br>类型：N12<br>描述：帐户人要求交易的交易金额，不含任何处理和交易费用。<br>金额的表示和货币代码有关，应能表示相应货币的最小单位。参ISO4217有关货币代码定义。<br>如“000000000100”用于表示美元，表示1.00元；如用于表示意大利货币，则表示100里拉。<br>对于查询等交易，应设交易金额为“000000000000”。<br>6，Bit06交易日期和时间（Transmission Date and Time）<br>位图位置：07<br>格式：定长，MMDDhhmmss<br>类型：N10<br>描述：本地交易日期和时间<br>7，Bit11系统跟踪号（Systems Trace Audit Number)<br>位图位置：11<br>格式：定长<br>类型：N6<br>描述：终端交易的跟踪号码。<br>交易发起终端填写，和“交易日期、时间”、信息类型等合在一起可唯一定义某一个终端的唯一一笔交易。即是说，在同一天，对一终端，同一类交易的系统跟踪号应保证不同。系统跟踪号在交易过程中不能修改。使用此域来匹配请求和通知类交易的返回。<br>应用系统使用此域来检查收到的授权、金融、自动冲正、结算、管理和网管等类交易的应答包是否是其请求包的应答。<br>系统跟踪号不用于匹配自动冲正交易，也不用于在预授权消费时匹配前面的预授权交易。参90域。<br>对于银行电子服务系统，其系统跟踪号是交易流水号。<br>8，Bit12本地交易时间（Time ,Local Transaction）<br>位图位置：12<br>格式：定长，hhmmss<br>类型：N6<br>描述：交易在终端上发生的时间。<br>本地交易时间在交易处理过程中不能改变。在自动冲正，存贮转发时，本地交易时间不能改变。<br>9，Bit13本地交易日期(Date ,Local Transaction)<br>位图位置：13<br>格式：定长,MMDD<br>类型：N4<br>描述：交易在终端上发生的时间。<br>本地交易时间不能改变，在自动冲正、存储转发交易时，本地交易时间也不能改变。<br>10，Bit14有效期(Date ,Expiration)<br>位图位置：14<br>格式：定长,YYMM<br>类型：N4<br>描述：卡的有效期，年年月月<br>由于卡类写磁格式不同，收单行可能提不出卡的有效期，授权机构从卡的二磁道中提取卡的有效期。如卡无二磁道，收单行应要求手工录入卡的有效期。<br>选用条件：100、200、400等交易如没有2、3磁道时，一定要有此域。<br>11，Bit15结算日期(Date ,Settlement)<br>位图位置：15<br>格式：定长，MMDD<br>类型：N4<br>描述：<br>银行电子服务系统和主机结算的时间，格式月月日日。<br>结帐日期前发生的交易参加当天结算。<br>在结算时，结帐日期也用于计算处理、交易费用。<br>12，Bit17获取日期(Date ,Capture)<br>位图位置：17<br>格式：定长，MMDD<br>类型：N4<br>描述：从主机获取交易的记帐日期。通常用于主机和商户清算。<br>13，Bit18商户类型（Merchant&#39;s Type）<br>位图位置：18<br>格式：定长<br>类型：N4<br>描述：定义商户产品和服务类型的代码<br>商户类型用于金融、授权交易，用于指定服务点的类型。它主要有以下用途：<br>决定预授权交易得到确认的最长时间；<br>控制合法限额；<br>为交易授权处理，控制网络操作规则；<br>欺诈检测；<br>用于商户分类报表；<br>交易费用处理。<br>根据ISO8583标准，应使用相应的国家标准。<br>商户类型代码表如下：<br>商户类型代码行业类型说明<br>4215邮递服务<br>4511民航<br>4722旅游<br>4782过桥费<br>4789其他运输服务<br>4614电信服务<br>5542加油站<br>5812餐馆<br>5999购物<br>6010金融机构－人工现金支付<br>6011金融机构－自动现金支付<br>6012金融机构－各类服务<br>7011酒店、旅馆<br>7299各类个人服务：洗衣、美容、<br>7399各类商业服务：停车场、租车、广告、其他服务<br>7699各类维修服务：维修、洗车、拖车<br>7996娱乐：电影、剧院、体育、游戏<br>8099医疗服务<br>8111法律服务<br>8999各类专业服务：会计、教育、装修、工程<br>选用条件：服务点终端发起的交易一定要有此域。<br>14，Bit22服务点输入方式(Point-of-Service Entry Mode)<br>位图位置：22<br>格式：定长<br>类型：N3<br>描述：在服务终端上定义PIN和PAN的输入方式。<br>服务点输入方式包含以下两个方面组合而成：<br>位置描述<br>1－2在服务终端上PAN有效期输入方式<br>3－3在服务终端上PIN的输入方式<br>PAN的输入方式编码如下：<br>PAN输入方式描述<br>00不知<br>01手工<br>02读磁卡<br>03条码扫描仪（BAR）<br>04光学符号阅读器（OCR）<br>05集成电路卡（IC卡）<br>PIN的输入方式编码如下：<br>PIN输入方式描述<br>0不知<br>1终端能接收PIN<br>2终端不能接收PIN<br>选用条件：服务点终端发起的交易一定要有此域。<br>15，Bit25服务点类型代码(Point-of-Service Condition Code)<br>位图位置：25<br>格式：定长<br>类型：N2<br>描述：定义交易发生的服务点类型<br>用法说明：下面是CYBERBANK支持的服务点条件代码。<br>服务点条件代码服务点终端类型<br>2自动柜员机（ATM）<br>10银行终端（10）<br>14POS<br>20电话银行<br>16，Bit32收单机构标识码(Acquirer institution Identification)<br>位图位置：32<br>格式：LLVAR<br>类型：N..11<br>描述：在金融交易中此域表示交易发生的银行机构的标识码<br>应答数据包必须和请求数据包此域相同。<br>17,Bit3向前机构标识码(Forwarding Institution Identification Code)<br>位图位置：33<br>格式：LLVAR<br>类型：N..11<br>描述：在金融交易中此域表示帐户所在的银行机构的标识码<br>在网管交易800/810中，本域含有交易发起机构的代码。<br>应答数据包必须和请求数据包此域相同。<br>18，Bit35二磁道数据(Track 2 Data)<br>位图位置：35<br>格式：LLVAR<br>类型：Z..37<br>描述：写在卡二磁道的数据。数据组成遵循ISO7811－1985标准，数据中包含域分隔符，但不包含卡启始、结束符、LRC等。<br>收卡行应检测卡的二磁道是否符合国际标准。<br>为支持国际交换收单行应将二磁道中的分隔符换为“＝”。除此外不能对二磁道数据进行任何修改，如修改PAN的校验字、有效期、服务码等。<br>19，Bit36三磁道数据(Track 3 Data)<br>位图位置：36<br>格式：LLLVAR<br>类型：Z…104<br>描述：写在卡三磁道的数据。数据应组成遵循ISO4909标准，数据中包含域分隔符，但不包含卡启始、结束符、LRC等。<br>注意：长度说明为3位数字长。<br>20，Bit37检索索引号(Retrieval Reference Number)<br>位图位置：37<br>格式：定长<br>类型：AN12<br>描述：检索索引号用来在任何时间标识一个金融、授权、自动冲正交易。<br>检索索引号不要求打印在持卡人的帐单上。它的主要目的是在收单行和授权行之间定义一个数据项用于跟踪和检索交易。授权机构可以将检索索引号打印在客户的对帐单上。<br>检索索引号由收单行分配。<br>选用条件：可包含在收单机构的交易请求中。如在交易请求中有，则应答数据中一定应原样返回。<br>21，Bit38授权码(Authorization Identification)<br>位图位置：38<br>格式：定长<br>类型：AN6<br>描述：交易授权机构返回的返回代码。<br>授权码用于在服务点终端上信用卡授权；<br>授权机构按网络操作规定，可选使用本域。<br>22，Bit39返回码(Response Code)<br>位图位置：39<br>格式：定长<br>类型：AN2<br>描述：对一交易定义其处理结果的编码。<br>返回码用于说明授权机构对金融（授权）交易的处理状态；也用来指明自动冲正交易的冲正原因；还用来指出目标主机已接收到文件修改、结算、管理、网管等交易请求。<br>返回码应尽可能准确，应尽可能描述清楚所遇到的问题和状态。网络交换主机、收单行主机有可能会按不同的返回码收取不同的交易处理费用，并执行不同的处理过程。<br>23，Bit41收卡单位终端标识码(Card Acceptor Terminal Identification)<br>位图位置：41<br>格式：定长<br>类型：ANS8<br>描述：定义在收单单位中定义一个服务终端的标识码，在同一商户中服务终端标识码应唯一。<br>24，Bit42收卡商户定义码(Card Acceptor Identification Code)<br>位图位置：42<br>格式：定长<br>类型：ANS15<br>描述：在本地和网络中定义交易单位（商户）的编码。<br>25，Bit43收卡商户位置(Card Acceptor Location)<br>位图位置：43<br>格式：定长<br>类型：ANS40<br>描述：在本地和网络中定义收卡单位（商户）的国家、省。城市等。<br>选用条件：如对外卡网络，一定要包含此域。<br>26，Bit44附加返回数据(Additional ResponseData)<br>位图位置：44<br>格式：LLVAR<br>类型：ANS..25<br>描述：在金融（授权）交易中授权机构返回的其他信息。<br>27，Bit48附加数据-私用(Additional Data-Private)<br>位图位置：48<br>格式：LLLVAR<br>类型：ANS…999<br>描述：银行电子服务系统使用此域作以下用途：<br>存放批量查询的返回数据<br>其格式与输出格式表对应<br>28，Bit49交易货币代码(Currency Code,Transaction)<br>位图位置：49<br>格式：定长<br>类型：AN3<br>描述：按ISO4217定义的交易货币代码，用来表示“交易金额”（field04）所用的货币种类。<br>交易货币代码是指在收单单位进行交易所用的交易种类。<br>29，Bit50结算货币代码(Currency Code,Settlement)<br>位图位置：50<br>格式：定长<br>类型：AN3<br>描述：按ISO4217定义的结算货币代码，用来表示结算金额、结算处理费、结算交易费等所用的货币种类。<br>结算货币代码是指在进行结算和清算过程中所用的货币种类。<br>30，Bit52用户密码(PIN)数据(PIN Data)<br>位图位置：52<br>格式：定长<br>类型：B16<br>描述：用户在服务终端上交易用于识别用户合法性的一些数字。<br>PIN在分行主机用分行主机密钥按ANSIX9.8标准加密，形成密文块。<br>选用条件：如果在终端上输入了密码，就需要此域。<br>31，Bit53密码相关控制信息(Security Related Control)<br>位图位置：53<br>格式：定长<br>类型：AN16<br>描述：本域提供有关密码块的附加信息，用于指出用于PIN计算的PIN key，用于MAC计算的MAC key。<br>本域格式如下表所示：<br>0－1格式代码2N“20”<br>2－3PIN加密算法2N“01”：DES<br>4－5密文块格式2N“01”:ANSI<br>6PIN密钥索引1N‘1’或‘2’<br>7MAC密钥索引1N‘1’或‘2’<br>8－11MAC检查数据4B<br>12－15填充4N<br>在BOC信用卡网络中PIN和MAC各使用两个密钥—-‘1’号和‘2’密钥，交易中计算PIN和MAC时只能各用某一个KEY，同时需将所用的KEY索引号填写此域。<br>选用条件：如果有PIN域或MAC域，一定需有此域。<br>32，Bit54附加金额(Additional Amounts)<br>位图位置：54<br>格式：LLLVAR<br>类型：ANS…120<br>描述：此域由授权行主机将客户的余额返回给收单终端，以显示或打印在客户回单上。<br>在此域中最多可有6个余额返回，每个余额返回格式如下：<br>位置描述<br>0－1处理码3－4或5－6位定义的帐号类型<br>2－3金额类型：01－帐户金额<br>02－可用金额<br>03－拥有金额<br>04－应付金额<br>40－可用取款限额<br>56－可用转帐限额<br>4－6金额的货币代码<br>7‘D’－借记金额，’C’－贷记金额<br>8－19余额数目<br>六个余额中必须返回可用余额，在ATM、POS上显示可用余额<br>33，Bit64信息确认码(MAC)<br>位图位置：64<br>格式：定长<br>类型：B16<br>描述：数据包的最后一个域，用于验证信息来源的合法性，以及数据包中数据是否未被篡改。<br>MAC的计算参ANSIX.99,(最后八字节未满八位者左补零，右补零？)<br>为提高效率，在发送者和接收者之间，只有以下一些重要的域参加MAC的计算。数据包中如果存在以下数据域，它们将参加MAC的计算。<br>位图域名<br>2基本帐号<br>3处理代码<br>4交易金额<br>11系统跟踪号<br>12本地交易时间<br>13本地交易日期<br>32收单机构代码<br>38授权码<br>39返回码<br>41收单终端代码<br>49交易货币代码<br>95替换金额<br>选用条件：只使用了1－64域的数据包使用此域。<br>34，Bit70管理信息码(System Management Indormation Code)<br>位图位置：70<br>格式：定长<br>类型：N3<br>描述：<br>用于定义和维护银行电子服务系统内部通讯网络状态和应用工作状态。<br>网络管理信息代码用于管理清算日期“cutoff”，通讯“sign on/sign off”，“key exchange”等。<br>支持以下一些网络管理信息码<br>NMIC网络管理信息码动作<br>001签到(Sign on)<br>002签退(Sign off)<br>101交换密钥(Key exchange)<br>201结帐日期切换(Cutoff)<br>202结帐日期切换完成<br>301测试(Echo test)<br>35，Bit74贷记交易笔数(Transaction Number)<br>位图位置：74<br>格式：定长<br>类型：N10<br>描述：贷记金融交易总的成功交易次数<br>CYBERBANK软件在收到如下一个处理代码时会增加贷记交易次数。<br>交易码交易服务<br>00贷记，购物与服务<br>01贷记，取现<br>02贷记，调整(客户调整)<br>36，Bit75贷记自动冲正交易笔数(Credits,Reversal Number)<br>位图位置：75<br>格式：定长<br>类型：N10<br>描述：贷记收单行自动冲正、“ChargeBack&quot;等交易总的交易次数<br>CYBERBANK软件在收到如下一个处理代码时会增加贷记自动冲正交易笔数<br>交易码交易服务<br>20贷记，退货<br>21贷记，存款<br>22贷记，调整（客户修改）<br>37，Bit76借记交易笔数(Debits,Number)<br>位图位置：76<br>格式：定长<br>类型：N10<br>描述：借记金融交易总的成功交易次数<br>CYBERBANK软件在收到如下一个处理代码时会增加借记交易次数。<br>交易码交易服务<br>00借记，购物与服务<br>01借记，取现<br>02借记，调整(客户调整)<br>38，Bit77借记自动冲正交易笔数(Debits,Reversal Number)<br>位图位置：77<br>格式：定长<br>类型：N10<br>描述：借记收单行自动冲正、“ChargeBack&quot;等交易总的交易次数<br>CYBERBANK软件在收到如下一个处理代码时会增加借记重发交易次数，并在清算表报中反映。<br>交易码交易服务<br>20借记(!!!)，退货<br>21借记，存款<br>22借记，调整（客户修改）<br>39，Bit78转帐交易笔数(Transfers,Number)<br>位图位置：78<br>格式：定长<br>类型：N10<br>描述：转帐的交易总次数。<br>系统在收到如下一个处理代码的金融交易时会增加转帐交易的次数。<br>交易码交易服务<br>40客户相关帐户间转帐<br>40，Bit79转帐自动冲正交易笔数(Transfers,Reversal Number)<br>位图位置：79<br>格式：定长<br>类型：N10<br>描述：转帐的自动冲正交易总次数。<br>系统在收到如下一个处理代码的自动冲正交易时会增加转帐自动冲正交易的次数。<br>交易码交易服务<br>40客户相关帐户间转帐<br>41，Bit80查询交易笔数(Inquiries,Number)<br>位图位置：80<br>格式：定长<br>类型：N10<br>描述：成功的查询交易次数。<br>系统软件在收到如下一个处理代码时会增加查询交易次数。<br>交易码交易服务<br>30查询可用金额<br>42，Bit81授权交易笔数(Authorization,Number)<br>位图位置：81<br>格式：定长<br>类型：N10<br>描述：成功的授权交易总额<br>在收到一个授权交易时系统将授权交易笔数加一。<br>43，Bit83贷记交易费金额(Credits,Transaction FeeAmount)<br>位图位置：83<br>格式：定长<br>类型：N12<br>描述：净交易费用，如交易金额为正。<br>44，Bit85借记交易费金额(Debits,Transaction FeeAmount)<br>位图位置：85<br>格式：定长<br>类型：N12<br>描述：净交易费用，如交易金额为负。<br>45，Bit86贷记交易金额(Credits,Amount)<br>位图位置：86<br>格式：定长<br>类型：N16<br>描述：贷记金融交易总的交易金额，不含任何费用。<br>系统在收到如下一个处理代码时会增加贷记交易金额，并在清算表报中反映。<br>交易码交易服务<br>20贷记，退货<br>21贷记，存款<br>22贷记，调整（客户修改）<br>46，Bit87贷记自动冲正金额(Credits,Reversal Amount)<br>位图位置：87<br>格式：定长<br>类型：N16<br>描述：信用卡自动冲正交易的总金额，不含任何费用。<br>47，Bit88借记交易金额(Debits,Amount)<br>位图位置：88<br>格式：定长<br>类型：N16<br>描述：借记金融交易总的交易金额，不含任何费用。<br>系统在收到如下一个处理代码时会增加借记交易金额，并在清算表报中反映。<br>交易码交易服务<br>00借记，购物与服务<br>01借记，取现<br>02借记，调整(客户调整)<br>48，Bit89借记自动冲正交易金额(Debits,Reversal Amount)<br>位图位置：89<br>格式：定长<br>类型：N16<br>描述：借记自动冲正交易的总金额，不含任何费用。<br>49，Bit90原交易的数据元素(Original Data Elements)<br>位图位置：90<br>格式：定长<br>类型：N42<br>描述：存放原交易的一些数据，用于修改或自动冲正。<br>数据由以下五部分组成：<br>位置描述<br>1－4信息类型码<br>设为原交易的信息类型代码<br>5－10系统跟踪号<br>原交易系统跟踪号<br>11－20交易日期和时间<br>原交易的交易日期和时间<br>21－31原收单机构<br>原交易的收单机构<br>不足11位的机构代码，左补‘0’<br>32－42原向前机构<br>原交易的收单机构<br>不足11位的机构代码，左补‘0’<br>50，Bit91文件修改编码(File Update Code)<br>位图位置：91<br>格式：定长<br>类型：AN1<br>描述：用此域指示某文件怎样维护。<br>CYBERBANK支持以下一些修改代码：<br>1增加记录<br>2改变记录<br>3删除记录<br>5查询<br>7增加文件<br>选用条件：<br>51，Bit94服务指示码(Service Indicator)<br>位图位置：94<br>格式：定长<br>类型：AN7<br>描述：指示文件修改服务。<br>选用条件：<br>52，Bit95代替金额(Replacement Amounts)<br>位图位置：95<br>格式：定长<br>类型：N42!!!<br>描述：客户修改或部分取消已完成的交易，最后实际发生的交易金额，<br>交易的原交易金额存放在90域。<br>本域由以下4部分组成<br>Sub-ElementAmountAttribute<br>交易实际金额N12<br>结算实际金额N12<br>实际交易费用X＋N8<br>实际结算费用X＋N8<br>53，Bit97净结算金额(Net Settlement Amount)<br>位图位置：97<br>格式：定长<br>类型：X+N16<br>描述：此域为净结帐金额。<br>502交易中用于发送当天的净结算金额<br>例：“C0000000020000000”，表示贷方（‘＋’？）200000.00元。<br>“D0000000020000000”，表示借方（‘－’？）200000.00元。<br>54，Bit99结算机构码(Settlement Institution Identification)<br>位图位置：99<br>格式：LLVAR<br>类型：N..11<br>描述：此域存放接收清算信息的机构代码。<br>返回数据包此域必须和请求数据包一致。<br>55，Bit100接收机构码（Receiving Institution Identification)<br>位图位置：100<br>格式：LLVAR<br>类型：N..11<br>描述：金融交易此域存放授权机构代码。<br>网管类交易，800/820交易，此域存放请求的目的机构代码。<br>返回数据包此域必须和请求数据包一致。<br>56，Bit101文件名(FileName)<br>位图位置：101<br>格式：LLVAR<br>类型：ANS..17<br>描述：发送机构设置的文件名。<br>57，Bit102帐号1(Account Identification1)<br>位图位置：102<br>格式：LLVAR<br>类型：ANS..28<br>描述：一个特定的客户帐号。帐号1用来描述受借记、转出、支付等交易影响的帐户。<br>选用条件：转帐时使用。<br>58，Bit103帐号2(Account Identiication2)<br>位图位置：103<br>格式：LLVAR<br>类型：ANS..28<br>描述：交易的补充信息，如：第二货币号、利率代码、起止日期等。<br>定义如下表<br>0000000000000000000000000000000000000000000000000<br>位置长度描述<br>00－2122帐户<br>22－276发卡机构号<br>如果此域存在，将按此机构代码作为路由信息。<br>选用条件：机构间转帐时使用。<br>60，Bit123新密码数据(New PIN Data)<br>位图位置：123<br>格式：LLLVAR<br>类型：B…16<br>描述：修改密码交易时存放新密码。<br>格式参考52域<br>选用条件：修改密码交易时必须有此域。<br>61，Bit128信息确认码(MAC)<br>位图位置：128<br>格式：定长<br>类型：B16<br>描述：数据包的最后一个域，用于验证信息来源的合法性，以及数据包中数据是否未被篡改。<br>MAC的计算参ANSIX.99<br>为提高效率，在发送者和接收者之间，只有以下一些重要的域参加MAC的计算。数据包中如果存在以下数据域，它们将参加MAC的计算。<br>位图域名<br>2基本帐号<br>3处理代码<br>4交易金额<br>11系统跟踪号<br>12本地交易时间<br>13本地交易日期<br>32收单机构代码<br>38授权码<br>39返回码<br>41收单终端代码<br>49交易货币代码<br>95替换金额<br>选用条件：使用65－128数据域的数据包需使用此域。 </p>
<p>消费交易实例:</p>
<p>消费交易，需要上送交易类型，卡号等等，定义如下<br>卡号 第2域 LLVAR BCD 5309987876545342<br>交易类型 第3域 长度6 BCD 900000<br>金额 第4域 长度12 BCD 100分<br>时间 第7域 长度8 BCD 20030802<br>2磁道信息 第35域 LLVAR ASCII 123456<br>3磁道信息 第36域 LLLVAR BCD 123456001<br>商户号 第41域 LLVAR ASCII 98765432<br>好了我们现在开始打包，首先按照长度和类型把上面的数据处理一下<br>卡号 165309987876545342<br>交易类型 900000<br>金额 000000000100<br>时间 20030802<br>2磁道 06313233343536<br>3磁道 0009123456001<br>商户号 083938373635343332<br>接下来我们按照域信息生成位图<br>因为有第2域，所以第二个位置是1，由第三域，所以第三个位置<br>是1，。。。<br>依此类推得到一串数字<br>0111 0010 0000 0000 0000 0000 0000 0000 0011 0000 1000 0000 0000 0000 0000 0000<br>转换过来，就是<br>72 00 00 00 30 80 00 00 这个就是BITMAP了<br>然后把上面的数据按照BITMAP+每个域的内容，依次排列<br>就得到这个包的内容了<br>7200000030800000165309987876545342900000000000000100<br>20030802063132333435360009123456001083938373635343332<br>前头再加上TPDU和MSGID就是最后的数据包</p>
<p>c++源代码:</p>
<p>\<bank8583.h\>:   </p>
<p>  #ifndef   __BANK_8583_H__<br>  #define   __BANK_8583_H__   </p>
<p>  #pragma   warning(   disable   :   4786)<br>  //identifier   was   truncated   to   ‘number’   characters   in   the   debug   information<br>  #include   “tchar.h”<br>  #include   “ttrace.h”<br>  #include   “basedef.h”<br>  #include   “public.h”<br>  #include   \<vector\><br>  #include   \<map\><br>  #include   \<list\><br>  using   namespace   std;   </p>
<p>  #include   “tsock.h”<br>  using   namespace   STDNS;   </p>
<p>  #define   F8583T_STR   0<br>  #define   F8583T_INT   1<br>  #define   F8583T_BIN   2<br>  typedef   struct   tagISO8583_FIELD<br>  {<br>  int   bit_flag;   //域数据类型0   —   string,   1   —   int,   2   —   binary<br>  char   *data_name;   //域名<br>  int   length;   //数据域长度<br>  int   length_in_byte;//实际长度（如果是变长）<br>  int   variable_flag;   //是否变长标志0：否   2：2位变长,3：3位变长<br>  int   datatyp;   //0   —   string,   1   —   int,   2   —   binary<br>  char   *data;   //存放具体值<br>  int   attribute;   //保留<br>  }   ISO8583_FIELD;<br>  void   Get8583Field(   int   index,   ISO8583_FIELD**   ppField   );<br>  void   Set8583ValidFields(   BYTE*   pindex   );   </p>
<p>  typedef   struct   tagTRADE_8583<br>  {<br>  const   char*   name;<br>  DWORD bankcode;<br>  BYTE bm[128];<br>  }TRADE_8583;   </p>
<p>  typedef   struct   tagTRADE_8583_DEF<br>  {<br>  DWORD   tcode;<br>  TRADE_8583   req;<br>  TRADE_8583   ans;<br>  }TRADE_8583_DEF;<br>  BOOL   Set8583TradeInfo(   TRADE_8583_DEF*   pInfo   );   </p>
<p>  typedef   vector\<BYTE\>   PACK_8583_ITEM;   </p>
<p>  class   Pack8583<br>  {<br>  public:<br>  Pack8583(   BOOL   bCompressInt   =   FALSE);<br>  virtual   ~Pack8583();<br>  BOOL   Init(DWORD   tcode);<br>  int   SetReqField(int   field,char*   buf,int   len);<br>  BOOL   BuildReqPack(   vector\<BYTE\>&amp;   A,   BOOL   bForceFillAll   =   TRUE   );<br>  BOOL   GetReqPackItem(   int   index,   PACK_8583_ITEM&amp;   item);   </p>
<p>  DWORD   GetReqBankCode();<br>  DWORD   GetAnsBankCode();<br>  //-1   package   is   not   full<br>  //-2   any   field   is   not   exist<br>  //-3   LVAR,LLVAR,LLLVAR的长度不是DIGIT<br>  //-4   LVAR,LLVAR,LLLVAR的长度太大<br>  int   UnPack(BYTE*   pack,int   len);//把缓冲区的数据解包到ansdata里<br>  //0   OK<br>  //1   time   out<br>  //2   recv   error<br>  //-3   LVAR,LLVAR,LLLVAR的长度不是DIGIT<br>  int   UnPack(   TCPSocket&amp;   sock   );//接收解包<br>  BOOL   GetAnsPackItem(   int   index,   PACK_8583_ITEM&amp;   item);   </p>
<p>  PACK_8583_ITEM*   GetFromReq(   int   index   );<br>  PACK_8583_ITEM*   GetFromAns(   int   index   );   </p>
<p>  void   ShowReq();<br>  void   ShowAns();<br>  char   m_recvbuf[1024];<br>  int   m_recvbytes;<br>  protected:<br>  BOOL   m_bCompInt;<br>  int   GetReqPackLen();<br>  BOOL   IsReqFieldValid(int);<br>  BOOL   IsAnsFieldValid(int);<br>  BOOL   IsReqFieldNotFill();   </p>
<p>  void   BuildReqMask(   BYTE*   mask,   BOOL   bext,   BYTE*   bm   );<br>  BOOL   IsReqExtExist();   </p>
<p>  void   MaskToBM(   BYTE*   mask,   BYTE*   bm   );//mask   BYTE[16],bm   BYTE[64]<br>  TRADE_8583_DEF*   m_pTradeDef;<br>  map\&lt;   int,   PACK_8583_ITEM   >   m_reqdata;<br>  map\&lt;   int,   PACK_8583_ITEM   >   m_ansdata;<br>  };   </p>
<p>  #endif</p>
<p>\<bank8583.cpp\>:<br>  #include   “stdafx.h”<br>  #include   \<stdio.h\><br>  #include   \<string.h\><br>  #include   \<assert.h\><br>  #include   “bank/bank8583.h”   </p>
<p>  ISO8583_FIELD   Tbl8583[128]   =<br>  {<br>  /*   FLD   1   */   {0,“BIT   MAP,EXTENDED   ”,   8,   0,   0,   2,   NULL,0},<br>  /*   FLD   2   */   {0,“PRIMARY   ACCOUNT   NUMBER   ”,   22,   0,   2,   1,   NULL,0},<br>  /*   FLD   3   */   {0,“PROCESSING   CODE   ”,   6,   0,   0,   1,   NULL,0},<br>  /*   FLD   4   */   {0,“AMOUNT,   TRANSACTION   ”,   12,   0,   0,   1,   NULL,0},<br>  /*   FLD   5   */   {0,“NO   USE   ”,   12,   0,   0,   1,   NULL,0},<br>  /*   FLD   6   */   {0,“NO   USE   ”,   12,   0,   0,   1,   NULL,0},<br>  /*   FLD   7   */   {0,“TRANSACTION   DATE   AND   TIME   ”,   10,   0,   0,   1,   NULL,0},<br>  /*   FLD   8   */   {0,“NO   USE   ”,   8,   0,   0,   1,   NULL,0},<br>  /*   FLD   9   */   {0,“NO   USE   ”,   8,   0,   0,   1,   NULL,0},<br>  /*   FLD   10   */   {0,“NO   USE   ”,   8,   0,   0,   1,   NULL,0},<br>  /*   FLD   11   */   {0,“SYSTEM   TRACE   AUDIT   NUMBER   ”,   6,   0,   0,   1,   NULL,0},<br>  /*   FLD   12   */   {0,“TIME,   LOCAL   TRANSACTION   ”,   6,   0,   0,   1,   NULL,0},<br>  /*   FLD   13   */   {0,“DATE,   LOCAL   TRANSACTION   ”,   4,   0,   0,   1,   NULL,0},<br>  /*   FLD   14   */   {0,“DATE,   EXPIRATION   ”,   4,   0,   0,   1,   NULL,0},<br>  /*   FLD   15   */   {0,“DATE,   SETTLEMENT   ”,   4,   0,   0,   1,   NULL,0},<br>  /*   FLD   16   */   {0,“NO   USE   ”,   4,   0,   0,   1,   NULL,0},<br>  /*   FLD   17   */   {0,“DATE,   CAPTURE   ”,   4,   0,   0,   1,   NULL,0},<br>  /*   FLD   18   */   {0,“MERCHANT&#39;S   TYPE   ”,   4,   0,   0,   1,   NULL,0},<br>  /*   FLD   19   */   {0,“NO   USE   ”,   3,   0,   0,   1,   NULL,0},<br>  /*   FLD   20   */   {0,“NO   USE   ”,   3,   0,   0,   1,   NULL,0},<br>  /*   FLD   21   */   {0,“NO   USE   ”,   3,   0,   0,   1,   NULL,0},<br>  /*   FLD   22   */   {0,“POINT   OF   SERVICE   ENTRY   MODE   ”,   3,   0,   0,   1,   NULL,0},<br>  /*   FLD   23   */   {0,“NO   USE   ”,   3,   0,   0,   1,   NULL,0},<br>  /*   FLD   24   */   {0,“NO   USE   ”,   3,   0,   0,   1,   NULL,0},<br>  /*   FLD   25   */   {0,“POINT   OF   SERVICE   CONDITION   CODE   ”,   2,   0,   0,   1,   NULL,0},<br>  /*   FLD   26   */   {0,“NO   USE   ”,   2,   0,   0,   1,   NULL,0},<br>  /*   FLD   27   */   {0,“NO   USE   ”,   1,   0,   0,   1,   NULL,0},<br>  /*   FLD   28   */   {0,“field27   ”,   6,   0,   0,   1,   NULL,0},<br>  /*   FLD   29   */   {0,“NO   USE   ”,   8,   0,   1,   1,   NULL,0},<br>  /*   FLD   30   */   {0,“NO   USE   ”,   8,   0,   1,   1,   NULL,0},<br>  /*   FLD   31   */   {0,“NO   USE   ”,   8,   0,   1,   1,   NULL,0},<br>  /*   FLD   32   */   {0,“ACQUIRER   INSTITUTION   ID.   CODE   ”,   11,   0,   2,   1,   NULL,0},<br>  /*   FLD   33   */   {0,“FORWARDING   INSTITUTION   ID.   CODE   ”,   11,   0,   2,   1,   NULL,0},<br>  /*   FLD   34   */   {0,“NO   USE   ”,   28,   0,   2,   0,   NULL,0},<br>  /*   FLD   35   */   {0,“TRACK   2   DATA   ”,   37,   0,   2,   0,   NULL,0},<br>  /*   FLD   36   */   {0,“TRACK   3   DATA   ”,104,   0,   3,   0,   NULL,0},<br>  /*   FLD   37   */   {0,“RETRIEVAL   REFERENCE   NUMBER   ”,   12,   0,   0,   0,   NULL,0},<br>  /*   FLD   38   */   {0,“AUTH.   IDENTIFICATION   RESPONSE   ”,   6,   0,   0,   0,   NULL,0},<br>  /*   FLD   39   */   {0,“RESPONSE   CODE   ”,   2,   0,   0,   0,   NULL,0},<br>  /*   FLD   40   */   {0,“NO   USE   ”,   3,   0,   0,   0,   NULL,0},<br>  /*   FLD   41   */   {0,“CARD   ACCEPTOR   TERMINAL   ID.   ”,   8,   0,   0,   0,   NULL,0},<br>  /*   FLD   42   */   {0,“CARD   ACCEPTOR   IDENTIFICATION   CODE   ”,   15,   0,   0,   0,   NULL,0},<br>  /*   FLD   43   */   {0,“CARD   ACCEPTOR   NAME   LOCATION   ”,   40,   0,   0,   0,   NULL,0},<br>  /*   FLD   44   */   {0,“ADDITIONAL   RESPONSE   DATA   ”,   25,   0,   2,   0,   NULL,0},<br>  /*   FLD   45   */   {0,“NO   USE   ”,   76,   0,   2,   0,   NULL,0},<br>  /*   FLD   46   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   47   */   {0,“field47   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   48   */   {0,“ADDITIONAL   DATA   —-   PRIVATE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   49   */   {0,“CURRENCY   CODE,TRANSACTION   ”,   3,   0,   0,   0,   NULL,0},<br>  /*   FLD   50   */   {0,“CURRENCY   CODE,SETTLEMENT   ”,   3,   0,   0,   0,   NULL,0},<br>  /*   FLD   51   */   {0,“NO   USE   ”,   3,   0,   0,   0,   NULL,0},<br>  /*   FLD   52   */   {0,“PERSONAL   IDENTIFICATION   NUMBER   DATA   ”,   8,   0,   0,   2,   NULL,0},<br>  /*   FLD   53   */   {0,“SECURITY   RELATED   CONTROL   INformATION”,   16,   0,   0,   1,   NULL,0},<br>  /*   FLD   54   */   {0,“ADDITIONAL   AMOUNTS   ”,120,   0,   3,   0,   NULL,0},<br>  /*   FLD   55   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   56   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   57   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   58   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   59   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   60   */   {0,“NO   USE   ”,   5,   0,   3,   0,   NULL,0},<br>  /*   FLD   61   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   62   */   {0,“NO   USE   ”,   11,   0,   3,   0,   NULL,0},<br>  /*   FLD   63   */   {0,“NO   USE   ”,   11,   0,   3,   0,   NULL,0},<br>  /*   FLD   64   */   {0,“MESSAGE   AUTHENTICATION   CODE   FIELD   ”,   8,   0,   0,   2,   NULL,0},<br>  /*   FLD   65   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   66   */   {0,“NO   USE   ”,   1,   0,   0,   1,   NULL,0},<br>  /*   FLD   67   */   {0,“NO   USE   ”,999,   0,   3,   1,   NULL,0},<br>  /*   FLD   68   */   {0,“NO   USE   ”,999,   0,   3,   1,   NULL,0},<br>  /*   FLD   69   */   {0,“NO   USE   ”,999,   0,   3,   1,   NULL,0},<br>  /*   FLD   70   */   {0,“SYSTEM   MANAGEMENT   INformATION   CODE   ”,   3,   0,   0,   1,   NULL,0},<br>  /*   FLD   71   */   {0,“NO   USE   ”,999,   0,   3,   1,   NULL,0},<br>  /*   FLD   72   */   {0,“NO   USE   ”,999,   0,   3,   1,   NULL,0},<br>  /*   FLD   73   */   {0,“NO   USE   ”,   6,   0,   0,   1,   NULL,0},<br>  /*   FLD   74   */   {0,“NUMBER   OF   CREDITS   ”,   10,   0,   0,   1,   NULL,0},<br>  /*   FLD   75   */   {0,“REVERSAL   NUMBER   OF   CREDITS   ”,   10,   0,   0,   1,   NULL,0},<br>  /*   FLD   76   */   {0,“NUMBER   OF   DEBITS   ”,   10,   0,   0,   1,   NULL,0},<br>  /*   FLD   77   */   {0,“REVERSAL   NUMBER   OF   DEBITS   ”,   10,   0,   0,   1,   NULL,0},<br>  /*   FLD   78   */   {0,“NUMBER   OF   TRANSFER   ”,   10,   0,   0,   1,   NULL,0},<br>  /*   FLD   79   */   {0,“REVERSAL   NUMBER   OF   TRANSFER   ”,   10,   0,   0,   1,   NULL,0},<br>  /*   FLD   80   */   {0,“NUMBER   OF   INQUIRS   ”,   10,   0,   0,   1,   NULL,0},<br>  /*   FLD   81   */   {0,“AUTHORIZATION   NUMBER   ”,   10,   0,   0,   1,   NULL,0},<br>  /*   FLD   82   */   {0,“NO   USE   ”,   12,   0,   0,   1,   NULL,0},<br>  /*   FLD   83   */   {0,“CREDITS,TRANSCATION   FEEAMOUNT   ”,   12,   0,   0,   1,   NULL,0},<br>  /*   FLD   84   */   {0,“NO   USE   ”,   12,   0,   0,   1,   NULL,0},<br>  /*   FLD   85   */   {0,“DEBITS,TRANSCATION   FEEAMOUNT   ”,   12,   0,   0,   1,   NULL,0},<br>  /*   FLD   86   */   {0,“AMOUNT   OF   CREDITS   ”,   16,   0,   0,   1,   NULL,0},<br>  /*   FLD   87   */   {0,“REVERSAL   AMOUNT   OF   CREDITS   ”,   16,   0,   0,   1,   NULL,0},<br>  /*   FLD   88   */   {0,“AMOUNT   OF   DEBITS   ”,   16,   0,   0,   1,   NULL,0},<br>  /*   FLD   89   */   {0,“REVERSAL   AMOUNT   OF   DEBITS   ”,   16,   0,   0,   1,   NULL,0},<br>  /*   FLD   90   */   {0,“ORIGINAL   DATA   ELEMENTS   ”,   42,   0,   0,   1,   NULL,0},<br>  /*   FLD   91   */   {0,“FILE   UPDATE   CODE   ”,   1,   0,   0,   0,   NULL,0},<br>  /*   FLD   92   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   93   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   94   */   {0,“SERVICE   INDICATOR   ”,   7,   0,   0,   0,   NULL,0},<br>  /*   FLD   95   */   {0,“REPLACEMENT   AMOUNTS   ”,   42,   0,   0,   0,   NULL,0},<br>  /*   FLD   96   */   {0,“NO   USE   ”,   8,   0,   0,   0,   NULL,0},<br>  /*   FLD   97   */   {0,“AMOUNT   OF   NET   SETTLEMENT   ”,   16,   0,   0,   0,   NULL,0},<br>  /*   FLD   98   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   99   */   {0,“SETTLEMENT   INSTITUTION   ID   ”,   11,   0,   2,   1,   NULL,0},<br>  /*   FLD   100   */   {0,“RECVEING   INSTITUTION   ID   ”,   11,   0,   2,   1,   NULL,0},<br>  /*   FLD   101   */   {0,“FILENAME   ”,   17,   0,   2,   0,   NULL,0},<br>  /*   FLD   102   */   {0,“ACCOUNT   IDENTIFICATION1   ”,   28,   0,   2,   0,   NULL,0},<br>  /*   FLD   103   */   {0,“ACCOUNT   IDENTIFICATION2   ”,   28,   0,   2,   0,   NULL,0},<br>  /*   FLD   104   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   105   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   106   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   107   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   108   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   109   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   110   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   111   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   112   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   113   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   114   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   115   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   116   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   117   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   118   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   119   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   120   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   121   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   122   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   123   */   {0,“NEW   PIN   DATA   ”,   8,   0,   3,   2,   NULL,0},<br>  /*   FLD   124   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   125   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   126   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   127   */   {0,“NO   USE   ”,999,   0,   3,   0,   NULL,0},<br>  /*   FLD   128   */   {0,“MESSAGE   AUTHENTICATION   CODE   FIELD   ”,   8,   0,   0,   2,   NULL,0},<br>  };<br>  void   Get8583Field(   int   index,   ISO8583_FIELD**   ppField   )<br>  {<br>  assert(   index>=1   &amp;&amp;   index   \&lt;=   128   );<br>  *ppField   =   &amp;Tbl8583[index-1];<br>  }<br>BYTE   g_8583ValidFields[16]   =   {0};<br>  void   Set8583ValidFields(   BYTE*   pindex   )<br>  {<br>  memset(   g_8583ValidFields,   0,   sizeof(g_8583ValidFields)   );   </p>
<p>  while(   *pindex   >=   1   &amp;&amp;   *pindex   \&lt;=   128   )<br>  {<br>  int   num   =   (*pindex)-1;<br>  int   n   =   num   /   8;<br>  BYTE   mask   =   0x80;<br>  mask   >>=   num   -   n   *   8;<br>  g_8583ValidFields[n]   |=   mask;<br>  pindex   ++;<br>  }<br>  }<br>  BOOL   IsValidField(   int   index   )<br>  {<br>  if(   index   >=   128   ||   index   \&lt;=   1   )   return   FALSE;<br>  int   num   =   index-1;<br>  int   n   =   num   /   8;<br>  BYTE   mask   =   0x80;<br>  mask   >>=   num   -   n   *   8;<br>  return   (   g_8583ValidFields[n]   &amp;   mask   );<br>  }   </p>
<p>  TRADE_8583_DEF*   g_8583TradeDef   =   NULL;   </p>
<p>  TRADE_8583_DEF*   Get8583TradeInfo(   DWORD   tcode   )<br>  {<br>  if(   g_8583TradeDef   ==   NULL   )<br>  {<br>  printf(&quot;Please   call   [Set8583TradeInfo]   function   first/r/n&quot;);<br>  return   NULL;<br>  }<br>  for(   int   i   =   0;   g_8583TradeDef[i].req.name   !=   NULL;   i   ++   )<br>  {<br>  if(   g_8583TradeDef[i].tcode   &amp;   tcode   )   return   &amp;g_8583TradeDef[i];<br>  }<br>  printf(&quot;   trade   not   find   !   /r/n&quot;);<br>  return   NULL;<br>  }   </p>
<p>  BOOL   Set8583TradeInfo(   TRADE_8583_DEF   *   pDef   )<br>  {<br>  g_8583TradeDef   =   NULL;<br>  for(   int   i   =   0   ;   pDef[i].req.name   !=   NULL   ;   i   ++   )<br>  {<br>  int   j;<br>  for(   j   =   0;   ;   j   ++   )<br>  {//保证所有的域都是声明了的<br>  int   index   =   pDef[i].req.bm[j];<br>  if(   index   >=   128   ||   index   \&lt;=   1   )   break;<br>  if(   !IsValidField(   index   )   )<br>  {<br>  printf(&quot;field[%d]   is   not   valid!/r/n&quot;,index);<br>  return   FALSE;<br>  }<br>  if(!(   Tbl8583[index-1].variable_flag   ==   0   ||<br>  Tbl8583[index-1].variable_flag   ==   1   ||<br>  Tbl8583[index-1].variable_flag   ==   2   ||<br>  Tbl8583[index-1].variable_flag   ==   3   )   )<br>  {<br>  printf(&quot;field[%d]   variable_flag   is   not   a   valid   number!/r/n&quot;,index);<br>  return   FALSE;<br>  }<br>  }<br>  }<br>  g_8583TradeDef   =   pDef;<br>  return   TRUE;<br>  }   </p>
<p>  Pack8583::Pack8583(   BOOL   bCompressInt   )<br>  {<br>  m_pTradeDef   =   NULL;<br>  m_bCompInt   =   bCompressInt;<br>  }   </p>
<p>  Pack8583::~Pack8583()<br>  {<br>  }   </p>
<p>  BOOL   Pack8583::Init(DWORD   tcode)<br>  {<br>  m_pTradeDef   =   Get8583TradeInfo(   tcode   );<br>  if(   m_pTradeDef   ==   NULL   )   return   FALSE;<br>  return   TRUE;<br>  }   </p>
<p>  BOOL   Pack8583::IsReqFieldValid(   int   field   )<br>  {<br>  for(   int   i   =   0   ;;   i   ++)<br>  {<br>  int   findex   =   m_pTradeDef->req.bm[i];<br>  if(   findex   \&lt;   0   ||   findex   >   128   )   break;<br>  if(   field   ==   findex   )   return   TRUE;<br>  }<br>  return   FALSE;<br>  }<br>  BOOL   Pack8583::IsAnsFieldValid(   int   field   )<br>  {<br>  for(   int   i   =   0   ;;   i   ++)<br>  {<br>  int   findex   =   m_pTradeDef->ans.bm[i];<br>  if(   findex   \&lt;   0   ||   findex   >   128   )   break;<br>  if(   field   ==   findex   )   return   TRUE;<br>  }<br>  return   FALSE;<br>  }<br>  BOOL   Pack8583::SetReqField(int   field,char*   buf,int   len)<br>  {<br>  if(   !IsReqFieldValid(   field)   )<br>  {<br>  printf(&quot;field   [%d]   is   not   valid!/r/n&quot;,field);<br>  return   FALSE;<br>  }   </p>
<p>  pair\&lt;   int,   PACK_8583_ITEM   >   item_insert;<br>  pair\&lt;   map\&lt;   int,   PACK_8583_ITEM   >::iterator,   BOOL   >   ret;   </p>
<p>  ISO8583_FIELD   &amp;F   =   Tbl8583[field-1];<br>  if(   F.variable_flag   ==   0   )<br>  {<br>  if(   len   !=   F.length   )<br>  {<br>  printf(&quot;field   [%d]   length   not   match!/r/n&quot;,field);<br>  return   FALSE;<br>  }<br>  }<br>  else<br>  {//1,2,3<br>  int   maxlen   =   0;<br>  if(   F.variable_flag   ==   1   )   maxlen   =   9;<br>  else   if(   F.variable_flag   ==   2   )   maxlen   =   99;<br>  else   if(   F.variable_flag   ==   3   )   maxlen   =   999;<br>  if(   len   >   maxlen   ||   len   \&lt;   0   )<br>  {<br>  printf(&quot;field   [%d]   data   length   out   of   range!/r/n&quot;,field);<br>  return   FALSE;<br>  }<br>  }   </p>
<p>  item_insert.first   =   field;<br>  ret   =   m_reqdata.insert(   item_insert   );<br>  PACK_8583_ITEM   &amp;item   =   ret.first->second;<br>  item.resize(   len   );<br>  memcpy(   &amp;item[0],   buf,   len   );<br>  return   TRUE;<br>  }<br>  PACK_8583_ITEM*   Pack8583::GetFromReq(   int   index   )<br>  {<br>  map\&lt;   int,   PACK_8583_ITEM   >   ::iterator   pos   =   m_reqdata.lower_bound(   index   );<br>  if(   pos   ==   m_reqdata.end()   ||   pos->first   !=   index   )   return   NULL;<br>  return   &amp;pos->second;<br>  }<br>  PACK_8583_ITEM*   Pack8583::GetFromAns(   int   index   )<br>  {<br>  map\&lt;   int,   PACK_8583_ITEM   >   ::iterator   pos   =   m_ansdata.lower_bound(   index   );<br>  if(   pos   ==   m_ansdata.end()   ||   pos->first   !=   index   )   return   NULL;<br>  return   &amp;pos->second;<br>  }   </p>
<p>  int   Pack8583::GetReqPackLen()<br>  {<br>  int   len   =   8;<br>  map\&lt;   int,   PACK_8583_ITEM   >::iterator   p;<br>  for(   p   =   m_reqdata.begin()   ;   p   !=   m_reqdata.end();   ++   p   )<br>  {<br>  int   findex   =   p->first;<br>  int   datalen   =   p->second.size();<br>  if(   m_bCompInt   &amp;&amp;   Tbl8583[findex-1].datatyp   ==   1   )<br>  {<br>  int   flen   =   Tbl8583[findex-1].variable_flag   +   datalen;<br>  len   +=   flen   /   2   +   flen   %   2;<br>  }<br>  else<br>  {<br>  len   +=   Tbl8583[findex-1].variable_flag;<br>  len   +=   datalen;<br>  }<br>  }<br>  if(   IsReqExtExist()   )   len   +=   8;<br>  return   len;<br>  }</p>
<p>C#的转换：</p>
<p>ASCII->string<br>Convert.ToInt32(ASCII);<br>Binary->string<br>Encoding.ASCII.GetString(Binary);</p>
<p>报文数据实例：</p>
<p>msgType：0200 30323030</p>
<p>1域:01110010 00111000 00000000 00010000 00110010 11000000 00010000 00001001</p>
<p>Bitmap:72 38 00 10 32 C0 10 09</p>
<p>2域:166224780001888456 313636323234373830303031383838343536</p>
<p>3域:000200 303030323030</p>
<p>4域:000000000001 303030303030303030303031</p>
<p>7域:0412103355 30343132313033333535</p>
<p>11域:000001 303030303031</p>
<p>12域:103355 313033333535</p>
<p>13域:0412 30343132</p>
<p>28域:C00000000 433030303030303030</p>
<p>35域:00 3030</p>
<p>36域:000 303030</p>
<p>41域:61006566 3631303036353636</p>
<p>42域: 860010030210013 383630303130303330323130303133</p>
<p>52 123456—06123456FFFFFFFF—C4F1029F060CA9B9—43344631303239463036304341394239</p>
<p>61域: 0186224780300001835 30313836323234373830333030303031383335</p>
<p>64域:4635BED3EC4B24C7</p>

    
    
    <footer class="meta">
      
      
      
    </footer>
    
  </div>
  
</article></div>
  <footer id="footer" class="inner"><div class="social alignright">
  
  
  
  
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
</div>
<p>
  
  &copy; 2013 NG
  
</p>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="phasebeam">
  <canvas></canvas>
  <canvas></canvas>
  <canvas></canvas>
</div>
<script src="/js/phasebeam.js"></script>
</body>
</html>